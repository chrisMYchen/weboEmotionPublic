/** 
 * animation-utilities - Animation utilities for Jibo's coordinated expression output
 * @version v2.0.0
 *
 * IFR components: Copyright (c) 2011-2016, IF Robots LLC.  All rights reserved.
 * Other components: Copyright (c) 2012-2016, Jibo, Inc.  All rights reserved.
 *
 * IFR components provided to Jibo, Inc. by IF Robots LLC for use only in the Jibo SDK.
 *
 * All use of the Jibo SDK is subject to the Jibo SDK End User License Agreement (EULA) 
 * distributed herewith.  If you did not receive a copy of the EULA, you may view a
 * copy at https://developers.jibo.com/license.
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.animationUtilities=t()}}(function(){return function t(e,o,n){function i(s,a){if(!o[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){var o=e[s][1][t];return i(o?o:t)},u,u.exports,t,e,o,n)}return o[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,e,o){"use strict";var n=t("../ifr-motion/base/Motion"),i=t("../ifr-motion/base/MotionValidator"),r=t("../ifr-motion/base/MotionTrack"),s=t("../ifr-motion/base/TimestampedBuffer"),a=t("../ifr-motion/base/AccelPlanner"),l=t("./TransitionBuilder"),c=function(t,e,o){l.call(this),this.minTransitionTime=null,this.defaultMaxVelocity=e,this.defaultMaxAccel=o,this.maxVelocityByDOF={},this.maxAccelByDOF={},this.robotInfo=t,this.planner=new a};c.prototype=Object.create(l.prototype),c.prototype.constructor=c,c.prototype.setDefaultLimits=function(t,e){this.defaultMaxVelocity=t,this.defaultMaxAccel=e},c.prototype.setMinTransitionTime=function(t){this.minTransitionTime=t},c.prototype.setLimits=function(t,e,o){for(var n=0;n<t.length;n++)this.maxVelocityByDOF[t[n]]=e,this.maxAccelByDOF[t[n]]=o},c.prototype.generateTransition=function(t,e,o,a){var l,c,u,h,p,d=1/30;for(p=0;p<a.length;p++){if(l=a[p],!this.robotInfo.getDOFInfo(l))throw new Error("Error transitioning, no dofInfo found for "+l);var m=t.get(l,0);if(null==m||Array.isArray(m)&&m.length<1)throw new Error("Error transitioning, no FROM value for "+l)}i.valuesExist(e,a);var f=this.robotInfo.getKinematicInfo().getInterpolatorSet(),g=new n("Transition:"+e.getName()),y=0,_=e.getPoseAtTime(o,f),v=this.robotInfo.getKinematicInfo().getDOFGlobalAlignment();for(v.refineToGloballyClosestTargetPose(t,_,a),p=0;p<a.length;p++)if(l=a[p],this.robotInfo.getDOFInfo(l).isMetric()){c=t.get(l,0),u=t.get(l,1),null===u&&(u=0),h=_.get(l,0);var T=this.defaultMaxAccel;this.maxAccelByDOF[l]&&(T=this.maxAccelByDOF[l]);var O=this.planner.computeWithFixedAccel(u,0,h-c,T)._totalTime;O>y&&(y=O)}this.minTransitionTime&&this.minTransitionTime>y&&(y=this.minTransitionTime);var L={};for(p=0;p<a.length;p++)l=a[p],this.robotInfo.getDOFInfo(l).isMetric()&&(c=t.get(l,0),u=t.get(l,1),null===u&&(u=0),h=_.get(l,0),y>1e-10?L[l]=this.planner.computeWithFixedTime(u,0,h-c,y):L[l]=null);for(p=0;p<a.length;p++){l=a[p],c=t.get(l,0),h=_.get(l,0);var b=new s;b.append(0,c);var S=L[l];if(S)for(var w=d;y>w;){var D=c+S.displacementAtTime(w);b.append(w,D),w+=d}b.append(y,h),g.addTrack(new r(l,b,y))}return g},c.prototype.clone=function(){var t=new c(this.robotInfo,this.defaultMaxVelocity,this.defaultMaxAccel);t.minTransitionTime=this.minTransitionTime;var e,o=Object.keys(this.maxVelocityByDOF);for(e=0;e<o.length;e++)t.maxVelocityByDOF[o[e]]=this.maxVelocityByDOF[o[e]];for(o=Object.keys(this.maxAccelByDOF),e=0;e<o.length;e++)t.maxAccelByDOF[o[e]]=this.maxAccelByDOF[o[e]];return t},e.exports=c},{"../ifr-motion/base/AccelPlanner":62,"../ifr-motion/base/Motion":69,"../ifr-motion/base/MotionTrack":71,"../ifr-motion/base/MotionValidator":72,"../ifr-motion/base/TimestampedBuffer":75,"./TransitionBuilder":5}],2:[function(t,e,o){"use strict";function n(t){for(var e=[],o=t.getOutputs(),n=0;n<o.length;n++)o[n]instanceof m&&(e=e.concat(o[n].getRenderers()));return e}var i=t("../ifr-motion/loaders/AnimationLoader"),r=t("../ifr-motion/base/Motion"),s=t("../ifr-motion/base/AnnotatedMotion"),a=t("../ifr-motion/base/Pose"),l=t("./LinearTransitionBuilderImpl"),c=t("./AccelerationTransitionBuilder"),u=t("./SingleLookatBuilder"),h=t("./timeline/SimpleMotionGenerator"),p=t("./timeline/LoopedMotionGenerator"),d=t("../ifr-core/SLog"),m=t("../animation-visualize/RendererOutput"),f=t("../geometry-info/DOFSet"),g=t("three"),y={},_=new i,v=function(t,e,o,n,i){var r=t;w.trajectory.getAnimation(e,function(t){var e=null;t&&(e=new L(r.timeline,t,null===r.defaultTransition?null:r.defaultTransition.clone(),r.robotInfo,i)),o&&o(e)},n)},T=function(){};T.prototype.init=function(t,e){var o=this;this.timeline=t,this.robotInfo=e,this.defaultTransition=this.createAccelerationTransitionBuilder(3,5),this.defaultTransition.setLimits(e.getBodyDOFNames(),3,5),this.defaultTransition.setLimits(e.getEyeDOFNames(),20,40),this.defaultTransition.setLimits(e.getDOFSet("LED").getDOFs(),10,20),this.blinkBuilder=null,this.blinkInProgress=!1,v(this,e.getConfig().getRobotURL()+"jibo_blink.anim",function(t){t.setTransitionIn(null),t.on(w.AnimationEventType.STOPPED,function(){o.blinkInProgress=!1}),t.on(w.AnimationEventType.CANCELLED,function(){o.blinkInProgress=!1}),o.blinkBuilder=t},!1,"blink");var n={ALL:e.getDOFSet("ALL"),BASE:e.getDOFSet("BASE"),BODY:e.getDOFSet("BODY"),EYE:e.getDOFSet("EYE"),LED:e.getDOFSet("LED"),OVERLAY:e.getDOFSet("OVERLAY"),SCREEN:e.getDOFSet("SCREEN"),EYE_ROOT:e.getDOFSet("EYE_ROOT"),EYE_DEFORM:e.getDOFSet("EYE_DEFORM"),EYE_RENDER:e.getDOFSet("EYE_RENDER"),EYE_TRANSLATE:e.getDOFSet("EYE_TRANSLATE"),EYE_ROTATE:e.getDOFSet("EYE_ROTATE"),EYE_COLOR:e.getDOFSet("EYE_COLOR"),EYE_TEXTURE:e.getDOFSet("EYE_TEXTURE"),OVERLAY_ROOT:e.getDOFSet("OVERLAY_ROOT"),OVERLAY_DEFORM:e.getDOFSet("OVERLAY_DEFORM"),OVERLAY_RENDER:e.getDOFSet("OVERLAY_RENDER"),OVERLAY_TRANSLATE:e.getDOFSet("OVERLAY_TRANSLATE"),OVERLAY_ROTATE:e.getDOFSet("OVERLAY_ROTATE"),OVERLAY_COLOR:e.getDOFSet("OVERLAY_COLOR"),OVERLAY_TEXTURE:e.getDOFSet("OVERLAY_TEXTURE"),SCREEN_BG_RENDER:e.getDOFSet("SCREEN_BG_RENDER"),SCREEN_BG_COLOR:e.getDOFSet("SCREEN_BG_COLOR"),SCREEN_BG_TEXTURE:e.getDOFSet("SCREEN_BG_TEXTURE")};this.dofs=n},T.prototype.getRobotInfo=function(){return this.robotInfo},T.prototype.getClock=function(){return this.timeline.getClock()},T.prototype.createAnimationBuilder=function(t,e,o){v(this,t,e,o)},T.prototype.createAnimationBuilderFromData=function(t,e,o){var n=w.trajectory.parseAnimation(t,e,o);return n?new L(this.timeline,n,null===this.defaultTransition?null:this.defaultTransition.clone(),this.robotInfo):null},T.prototype.createLookatBuilder=function(){return new u(this.timeline,this.robotInfo,null===this.defaultTransition?null:this.defaultTransition.clone())},T.prototype.blink=function(t){null!=this.blinkBuilder?(this.blinkInProgress===!1||t===!0)&&(this.blinkBuilder.play(),this.blinkInProgress=!0):d.warn("Blink requested but blink builder not yet loaded")},T.prototype.stopAll=function(){},T.prototype.setEyeVisible=function(t){var e=this.robotInfo.getDOFSet("EYE_TEXTURE").getDOFs()[0],o=this.robotInfo.getDOFSet("OVERLAY_TEXTURE").getDOFs()[0],n=this.robotInfo.getDefaultDOFValues(),i=n[e],s=n[o],l=new a("eye visibility pose",[e,o]);t?(l.set(e,i,0),l.set(o,s,0)):(l.set(e,s,0),l.set(o,s,0));var c=r.createFromPose("eye visibility motion",l,.5),u=this.timeline.getClock().currentTime();this.timeline.add(new h(c,u,this.robotInfo),"default")},T.prototype.setEyeScale=function(t){for(var e=this.robotInfo.getDOFSet("EYE_DEFORM").plus("OVERLAY_DEFORM").getDOFs(),o=this.robotInfo.getKinematicInfo().getDefaultPose(),n=new a("eye pose",e),i=0;i<e.length;i++)n.set(e[i],o.get(e[i],0)*t,0);var s=r.createFromPose("eye scale motion",n,.5),l=this.timeline.getClock().currentTime();this.timeline.add(new h(s,l,this.robotInfo),"default")},T.prototype.setEyeScaleXY=function(t,e){for(var o=this.robotInfo.getDOFSet("EYE_DEFORM").plus("OVERLAY_DEFORM").getDOFs(),n=this.robotInfo.getKinematicInfo().getDefaultPose(),i=new a("eye pose",o),s=0;s<o.length;s++)o[s].indexOf("_t_2")>-1?i.set(o[s],n.get(o[s],0)*e,0):i.set(o[s],n.get(o[s],0)*t,0);var l=r.createFromPose("eye scale motion",i,.5),c=this.timeline.getClock().currentTime();this.timeline.add(new h(l,c,this.robotInfo),"default")},T.prototype.setEyePosition=function(t,e){var o=this.robotInfo.getDOFSet("EYE_TRANSLATE").getDOFs(),n=this.robotInfo.getDOFSet("OVERLAY_TRANSLATE").getDOFs(),i=new a("eye pose",o.concat(n));i.set(o[0],t,0),i.set(o[1],e,0),i.set(n[0],t,0),i.set(n[1],e,0);var s=r.createFromPose("eye position motion",i,.5),l=this.timeline.getClock().currentTime();this.timeline.add(new h(s,l,this.robotInfo),"default")},T.prototype.setLEDColor=function(t){var e=null;e=Array.isArray(t)?t:t.toArray();for(var o=this.robotInfo.getDOFSet("LED").getDOFs(),n=new a("LED pose",o),i=0;3>i;i++)n.set(o[i],e[i],0);var s=r.createFromPose("LED motion",n,.5),l=0,c=this.timeline.getClock().currentTime().add(l);this.timeline.add(new h(s,c,this.robotInfo),"default")},T.prototype.centerRobot=function(t,e,o){(void 0===t||null===t)&&(t=this.dofs.ALL),(void 0===e||null===e)&&(e=!1);var n=r.createFromPose("center motion",this.robotInfo.getKinematicInfo().getDefaultPose(),1/30,t.getDOFs()),i=new L(this.timeline,new s(n),this.defaultTransition.clone(),this.robotInfo),a=1,l=e&&t.hasDOF(this.dofs.BASE.getDOFs()[0]),c=null;if(l&&(c=this.createLookatBuilder(),c.setDOFs(this.dofs.BASE),a++),o){var u=function(){a--,0===a&&o()};i.on(w.AnimationEventType.CANCELLED,u),i.on(w.AnimationEventType.STOPPED,u),c&&(c.on(w.LookatEventType.CANCELLED,u),c.on(w.LookatEventType.STOPPED,u))}i.play(),c&&c.startLookat(new g.Vector3(1,0,0))},T.prototype.setDefaultTransition=function(t){this.defaultTransition=t},T.prototype.getDefaultTransition=function(){return this.defaultTransition},T.prototype.createLinearTransitionBuilder=function(){return w.trajectory.createLinearTransitionBuilder(this.robotInfo)},T.prototype.createAccelerationTransitionBuilder=function(t,e){return w.trajectory.createAccelerationTransitionBuilder(this.robotInfo,t,e)},T.prototype.installRenderPlugin=function(t){for(var e=n(this.timeline),o=0;o<e.length;o++)e[o].installRenderPlugin(t)},T.prototype.removeRenderPlugin=function(t){for(var e=n(this.timeline),o=0;o<e.length;o++)e[o].removeRenderPlugin(t)},T.prototype.getInstalledRenderPluginNames=function(){for(var t=[],e=n(this.timeline),o=0;o<e.length;o++)for(var i=e[o].getInstalledRenderPluginNames(),r=0;r<i.length;r++)t.indexOf(i[r])<0&&t.push(i[r]);return t};var O=function(t,e,o,n){this.builder=t,this.transitionClip=e,this.animationClip=o,this.layer=n};O.prototype.stop=function(){var t=this.builder.timeline,e=0,o=t.getClock().currentTime().add(e);if(o.isGreater(this.animationClip.getEndTime()))return void(this.animationClip.hasExited()?d.warn("Ignoring stop on "+this.animationClip.getName()+" as it is already over"):d.warn("Ignoring stop on "+this.animationClip.getName()+" as it is already committed"));null===this.transitionClip?this.animationClip.getStartTime().isGreater(o)&&(o=this.animationClip.getStartTime(),d.info("Stopping called on transitionless animation "+this.animationClip.getName()+" before anim started, moving stopTime forward")):this.transitionClip.getStartTime().isGreater(o)&&(o=this.transitionClip.getStartTime(),d.info("Stopping called on animation "+this.animationClip.getName()+" before its transition started, moving stopTime forward"));var n=null;n=null!==this.transitionClip&&this.transitionClip.getEndTime().isGreater(o)?this.transitionClip:this.animationClip;for(var i=[],s=n.getDOFs(),l=o.subtract(n.getStartTime()),c=0;c<s.length;c++){var u=n.getDurationForDOF(s[c]);null!==u&&u>l&&i.push(s[c])}for(var p=new a("stop pose",i),m=0;m<i.length;m++)p.set(i[m],[0]);var f=r.createFromPose(n.getName()+"_stop",p,0),g=new h(f,o,this.builder.robotInfo);t.add(g,this.layer)},O.prototype.getTransitionStartTime=function(){return this.transitionClip?this.transitionClip.getStartTime():this.animationClip.getStartTime()},O.prototype.getAnimationStartTime=function(){return this.animationClip.getStartTime()},O.prototype.getAnimationEndTime=function(){return this.animationClip.getEndTime()},O.prototype.getBuilder=function(){return this.builder};var L=function(t,e,o,n,i){null==i&&(i="default"),this.layer=i,this.timeline=t,this.motion=e,this.dofNames=Object.keys(e.getMotion().getTracks()),this.eventHandlers={},this.speed=1,this.numLoops=1,this.inPoint=0,this.outPoint=e.getDuration(),this.transition=o,this.stopOrient=!0,this.layerDOFs=t.getDOFsForLayer(i),this.robotInfo=n,this.setDOFs(null)};L.prototype._createStartedHandler=function(t){var e=this.eventHandlers[w.AnimationEventType.STARTED];if(e){var o=e.slice(0);return function(){for(var e=0;e<o.length;e++)o[e](w.AnimationEventType.STARTED,t,{})}}return null},L.prototype._createStoppedHandler=function(t){var e=this.eventHandlers[w.AnimationEventType.STOPPED];if(e){var o=e.slice(0);return function(e){for(var n=0;n<o.length;n++)o[n](w.AnimationEventType.STOPPED,t,{interrupted:e})}}return null},L.prototype._createRemovedHandler=function(t){var e=this.eventHandlers[w.AnimationEventType.STOPPED],o=this.eventHandlers[w.AnimationEventType.CANCELLED];if(e||o){var n=null,i=null;return e&&(n=e.slice(0)),o&&(i=o.slice(0)),function(e,o){var r;if(n&&e&&!o)for(r=0;r<n.length;r++)n[r](w.AnimationEventType.STOPPED,t,{interrupted:!0});if(i&&!e)for(r=0;r<i.length;r++)i[r](w.AnimationEventType.CANCELLED,t,{})}}return null},L.prototype._createEventHandler=function(t){var e=null;this.eventHandlers[w.AnimationEventType.EVENT]&&(e=this.eventHandlers[w.AnimationEventType.EVENT].slice(0));for(var o={},n=Object.keys(this.eventHandlers),i=0;i<n.length;i++){var r=n[i];r!==w.AnimationEventType.STARTED&&r!==w.AnimationEventType.STOPPED&&r!==w.AnimationEventType.CANCELLED&&r!==w.AnimationEventType.EVENT&&this.eventHandlers[r]&&(o[r]=this.eventHandlers[r].slice(0))}return e||Object.keys(o).length>0?function(n){var i;if(e)for(i=0;i<e.length;i++)e[i](w.AnimationEventType.EVENT,t,{eventName:n.getEventName(),payload:n.getPayload()});var r=n.getEventName();if(o[r])for(i=0;i<o[r].length;i++)o[r][i](r,t,n.getPayload())}:null},L.prototype.play=function(){for(var t=this.timeline.getClock().currentTime(),e=new r(this.motion.getMotion().getName()),o=0;o<this.dofNames.length;o++){var n=this.motion.getMotion().getTracks()[this.dofNames[o]];n&&e.addTrack(n)}var i=new s(e,this.motion.getEvents());1!==this.speed&&i.setSpeed(this.speed);var a=0,l=null;if(this.transition){var c,u;if("default"===this.layer){if(c=this.timeline.getCurrentState([this.layer]).getPose(),u=i.getMotion(),this.stopOrient){var d=this.timeline.getCurrentState(["lookat"]).getPose(),m=r.createFromPose("stop look",d,1),f=this.transition.generateTransition(d,m,0,d.getDOFNames());this.timeline.add(new h(f,t,this.robotInfo),"lookat")}}else c=this.timeline.getCurrentState([this.layer]).getPose(),u=i.getMotion();var g=this.transition.generateTransition(c,u,0,this.dofNames);l=new h(g,t,this.robotInfo),l=this.timeline.add(l,this.layer),null!==l&&(a=l.getDuration())}var y=new O(this,null,null,this.layer),_=null;if(1===this.numLoops)_=new h(i.getMotion(),t.add(a),this.robotInfo),_.setEvents(i.getEvents());else{var v=[i.getMotion()],T=[i.getEvents()];if(this.transition){var L=i.getMotion().getPoseAtTime(i.getMotion().getDuration(),this.robotInfo.getKinematicInfo().getInterpolatorSet()),b=this.transition.generateTransition(L,i.getMotion(),0,this.dofNames);v.push(b),T.push([])}_=new p(v,this.numLoops,t.add(a),this.robotInfo),_.setEvents(T)}return _.setHandlers(this._createStartedHandler(y),this._createStoppedHandler(y),this._createRemovedHandler(y),this._createEventHandler(y)),_=this.timeline.add(_,this.layer),y.transitionClip=l,y.animationClip=_,y},L.prototype.on=function(t,e){var o=this.eventHandlers[t];o||(o=[],this.eventHandlers[t]=o),-1===o.indexOf(e)&&o.push(e)},L.prototype.off=function(t,e){var o=this.eventHandlers[t];if(o){var n=o.indexOf(e);-1!==n&&o.splice(n,1)}},L.prototype.setSpeed=function(t){this.speed=t},L.prototype.setNumLoops=function(t){if(0>t)throw new Error("numLoops value is negative: "+t);this.numLoops=t},L.prototype.setDOFs=function(t){null==t?t=Object.keys(this.motion.getMotion().getTracks()):t instanceof f&&(t=t.getDOFs()),this.dofNames=[];for(var e=0;e<t.length;e++)this.motion.getMotion().getTracks().hasOwnProperty(t[e])&&this.layerDOFs.indexOf(t[e])>-1&&this.dofNames.push(t[e])},L.prototype.getDOFs=function(){return this.dofNames},L.prototype.setPlayBounds=function(t,e){null!==t&&void 0!==t?this.inPoint=t:this.inPoint=0,null!==e&&void 0!==e?this.outPoint=e:this.outPoint=this.getSourceAnimationDuration()},L.prototype.getSourceAnimationDuration=function(){return this.motion.getSourceMotionDuration()},L.prototype.getConfiguredAnimationDuration=function(){var t=this.outPoint-this.inPoint;return t/this.speed},L.prototype.setTransitionIn=function(t){this.transition=t},L.prototype.getTransitionIn=function(){return this.transition},L.prototype.setStopOrient=function(t){this.stopOrient=t},L.prototype.setLayer=function(t){null===this.timeline.getDOFsForLayer(t)?d.error("AnimationBuilder: ignoring setLayer with unknown layer name: "+t):(this.layer=t,this.layerDOFs=this.timeline.getDOFsForLayer(t),this.setDOFs(this.dofNames.slice(0)))};var b={};b.prototype={stop:function(){},updateTarget:function(t){},getTarget:function(){},getBuilder:function(){}};var S={};S.prototype={startLookat:function(t){},on:function(t,e){},off:function(t,e){},setDOFs:function(t){},getDOFs:function(){},setOrientFully:function(t){},setContinuousMode:function(t){}};var w={MODALITY_NAME:"MOTION",createAnimationUtilities:function(t,e){var o=new T;return t&&e&&o.init(t,e),o}};w.trajectory={getAnimation:function(t,e,o){var n;o||(n=y[t]),n?e&&e(new s(n.motion,n.events)):_.load(t,function(){var o=_.getResult();o.success?(y[t]=o,e&&e(new s(o.motion,o.events))):(d.error("animation load failed, "+o.message+' with URL:"'+t+'"'),e&&e(null))})},parseAnimation:function(t,e,o){var n=null;if(o&&(n=y[o]),n)return new s(n.motion,n.events);var r=new i;if(e){var a=e.slice(-1);"/"!==a&&"\\"!==a&&(e+="/"),r.resolvePaths=!0}else r.resolvePaths=!1;r.parseData(t,e);var l=r.getResult();return l.success?(o&&(y[o]=l),new s(l.motion,l.events)):(d.error("animation parse failed: "+l.message),null)},createLinearTransitionBuilder:function(t){return new l(t)},createAccelerationTransitionBuilder:function(t,e,o){return new c(t,e,o)}};var D={STARTED:"STARTED",STOPPED:"STOPPED",CANCELLED:"CANCELLED",EVENT:"EVENT"};w.AnimationEventType=D;var C={STARTED:"STARTED",TARGET_REACHED:"TARGET_REACHED",TARGET_SUPERSEDED:"TARGET_SUPERSEDED",STOPPED:"STOPPED",CANCELLED:"CANCELLED"};w.LookatEventType=C,e.exports=w},{"../animation-visualize/RendererOutput":39,"../geometry-info/DOFSet":41,"../ifr-core/SLog":52,"../ifr-motion/base/AnnotatedMotion":63,"../ifr-motion/base/Motion":69,"../ifr-motion/base/Pose":73,"../ifr-motion/loaders/AnimationLoader":89,"./AccelerationTransitionBuilder":1,"./LinearTransitionBuilderImpl":3,"./SingleLookatBuilder":4,"./timeline/LoopedMotionGenerator":13,"./timeline/SimpleMotionGenerator":20,three:void 0}],3:[function(t,e,o){"use strict";var n=t("../ifr-motion/base/Motion"),i=t("../ifr-motion/base/MotionValidator"),r=t("../ifr-motion/base/MotionTrack"),s=t("../ifr-motion/base/TimestampedBuffer"),a=t("./TransitionBuilder"),l=function(t){a.call(this),this._transitionTime=1,this._defaultMaxVelocity=null,this._maxVelocityByDOF=null,this._robotInfo=t};l.prototype=Object.create(a.prototype),l.prototype.constructor=l,l.prototype.setTransitionTime=function(t){this._transitionTime=t,this._defaultMaxVelocity=null,this._maxVelocityByDOF=null},l.prototype.setMaxVelocity=function(t,e){this._defaultMaxVelocity=t,this._maxVelocityByDOF=e,this._transitionTime=null},l.prototype.generateTransition=function(t,e,o,a){var l,c,u,h;for(h=0;h<a.length;h++){if(l=a[h],!this._robotInfo.getDOFInfo(l))throw new Error("Error transitioning, no dofInfo found for "+l);var p=t.get(l,0);if(null==p||Array.isArray(p)&&p.length<1)throw new Error("Error transitioning, no FROM value for "+l)}i.valuesExist(e,a);var d=this._robotInfo.getKinematicInfo().getInterpolatorSet(),m=new n("Transition:"+e.getName()),f=0,g=e.getPoseAtTime(o,d),y=this._robotInfo.getKinematicInfo().getDOFGlobalAlignment();if(y.refineToGloballyClosestTargetPose(t,g,a),null!==this._transitionTime)f=this._transitionTime;else for(h=0;h<a.length;h++)if(l=a[h],this._robotInfo.getDOFInfo(l).isMetric()){c=t.get(l,0),u=g.get(l,0);var _=this._defaultMaxVelocity;this._maxVelocityByDOF&&this._maxVelocityByDOF[l]&&(_=this._maxVelocityByDOF[l]);var v=Math.abs(u-c),T=v/_;T>f&&(f=T)}for(h=0;h<a.length;h++){l=a[h],c=t.get(l),u=g.get(l,0);var O=new s;O.append(0,c),O.append(f,u),m.addTrack(new r(l,O,f))}return m},l.prototype.clone=function(){for(var t=new l(this._robotInfo),e=Object.keys(this),o=0;o<e.length;o++)t[e[o]]=this[e[o]];return t},e.exports=l},{"../ifr-motion/base/Motion":69,"../ifr-motion/base/MotionTrack":71,"../ifr-motion/base/MotionValidator":72,"../ifr-motion/base/TimestampedBuffer":75,"./TransitionBuilder":5}],4:[function(t,e,o){"use strict";var n=t("../ifr-motion/lookat/MotionLookat"),i=t("../ifr-motion/lookat/LookatNode"),r=t("../ifr-motion/lookat/LookatMotionNode"),s=t("../ifr-motion/lookat/RotationalLookatDOF"),a=t("../ifr-motion/lookat/RotationalPlaneAlignmentLookatDOF"),l=t("../ifr-motion/lookat/PlaneDisplacementLookatDOF"),c=t("../ifr-motion/base/Pose"),u=t("../ifr-motion/base/Motion"),h=t("three"),p=t("./timeline/SimpleMotionGenerator"),d=t("../ifr-core/SLog"),m=t("./timeline/LookatMultiLayerStatusManager"),f=t("../geometry-info/DOFSet"),g=t("../ifr-motion/lookat/trackpolicy/LookatNodeTrackPolicy"),y=t("../ifr-motion/lookat/trackpolicy/TrackPolicyTriggerAlways"),_=t("../ifr-motion/lookat/trackpolicy/TrackPolicyTriggerDiscomfort"),v=t("../ifr-motion/lookat/trackpolicy/TrackPolicyTriggerMovementTerminated"),T="LOOKAT",O={STARTED:"STARTED",TARGET_REACHED:"TARGET_REACHED",TARGET_SUPERSEDED:"TARGET_SUPERSEDED",STOPPED:"STOPPED",CANCELLED:"CANCELLED"},L=function(t,e,o,n,i,r,s,a,l){this.velocity=t,this.acceleration=e,this.TPTDLimitInner=o,this.TPTDLimitOuter=n,this.TPTDAccumInner=i,this.TPTDAccumOuter=r,this.TPTDMoveImmediatelyPastOuter=s,this.TPTMTDeadZone=a,this.TPTMTDeadTime=l},b=function(t,e){this.min=t,this.max=e},S=function(t,e,o){var S=this,w={BaseLookatNode:new L(null,3),TorsoLookatNode:new L(null,3),TopLookatNode:new L(null,3),Eye:new L(null,1)},D={bottomSection_r:new b(null,null),middleSection_r:new b(null,null),topSection_r:new b(null,null),eyeSubRootBn_t:new b(-.03643574,.03643574),eyeSubRootBn_t_2:new b(-.008008724,.008008724)},C=function(t){return new g(null!=t.TPTDLimitInner?[new _(t.TPTDLimitInner,t.TPTDLimitOuter,t.TPTDAccumInner,t.TPTDAccumOuter,t.TPTDMoveImmediatelyPastOuter),new v(t.TPTMTDeadZone,t.TPTMTDeadTime)]:[new y])},F=function(){var t=e.getKinematicInfo().getFullKinematicGroup();return new n([new r(new i("BaseLookatNode",[new s("BaseLookatDOF","bottomSection_r",new h.Vector3(0,0,-1))]),e.getKinematicInfo().getDOFGlobalAlignment(),w.BaseLookatNode.acceleration,r.LookStabilizationMode.POINT_AUTO,C(w.BaseLookatNode)),new r(new i("TorsoLookatNode",[new a("TorsoLookatDOF","middleSection_r",new h.Vector3(9.509979e-9,.9271838,.37460676),.18703285,.29670632)]),e.getKinematicInfo().getDOFGlobalAlignment(),w.TorsoLookatNode.acceleration,r.LookStabilizationMode.POINT_AUTO,new C(w.TorsoLookatNode)),new r(new i("TopLookatNode",[new s("TopLookatDOF","topSection_r",new h.Vector3(0,0,-1))]),e.getKinematicInfo().getDOFGlobalAlignment(),w.TopLookatNode.acceleration,r.LookStabilizationMode.POINT_AUTO,C(w.TopLookatNode)),new r(new i("Eye",[new l("EyeLeftRight","eyeSubRootBn_t","eyeRootBn",new h.Vector3(0,0,1),new h.Vector3(0,1,0),.2,D.eyeSubRootBn_t.min,D.eyeSubRootBn_t.max),new l("EyeUpDown","eyeSubRootBn_t_2","eyeRootBn",new h.Vector3(0,0,1),new h.Vector3(-1,0,0),.1,D.eyeSubRootBn_t_2.min,D.eyeSubRootBn_t_2.max)]),e.getKinematicInfo().getDOFGlobalAlignment(),w.Eye.acceleration,r.LookStabilizationMode.POINT_TARGET,C(w.Eye))],t)},k=!0,P=!1,E={},N=F(),R=new c("LookPose",N.getDOFs()),M=function(o,n,i){o=o.clone();var r=null,s=null,a=i;this.getTarget=function(){return o},this.updateTarget=function(t){Array.isArray(t)?o.set(t[0],t[1],t[2]):o.copy(t),a.setTarget(o)},this.getBuilder=function(){return S},this.setClip=function(t,e){r=t,s=e},this.stop=function(){r&&l(r,"default"),s&&l(s,"lookat")};var l=function h(o,n){var i=0,r=t.getClock().currentTime().add(i);if(r.isGreater(o.getEndTime()))return void(o.hasExited()?d.info("Ignoring stop on SingleLookat as it is already over"):d.info("Ignoring stop on SingleLookat as it is already committed"));o.getStartTime().isGreater(r)&&(r=o.getStartTime(),d.info("Stopping called on lookat before it started, moving stopTime forward"));for(var s=[],a=o.getDOFs(),l=r.subtract(o.getStartTime()),m=0;m<a.length;m++){var f=o.getDurationForDOF(a[m]);null!==f&&f>l&&s.push(a[m])}for(var g=new c("stop pose",s),y=0;y<s.length;y++)g.set(s[y],[0]);var _=u.createFromPose(o.getName()+"_stop",g,0),h=new p(_,r,e);t.add(h,n)}};this.startLookat=function(o){var n=null;n=Array.isArray(o)?new h.Vector3(o[0],o[1],o[2]):o;var i=t.getClock().currentTime();N=F();for(var r=t.getCurrentState(["lookat"]).getPose(),s=[],a=[],l=R.getDOFNames(),f=0;f<l.length;f++)null!==r.get(l[f])?a.push(l[f]):s.push(l[f]);var g=t.getCurrentState(["default","lookat"]),y=g.getPose(),_=g.getTime(),v=null,O=new m(N,i,n,P),L=!1;if(L){N.reset();for(var b=i,S=[],w=[],D=Number.MAX_VALUE;D>.001;){d(T,"Creating lookat pose at time "+b.subtract(i)+" with remaining:"+D),N.generatePose(y,R,n,b),D=N.getDistanceRemaining();var C=new c("Pose "+b,R.getDOFNames());C.setPose(R),S.push(C),w.push(b.subtract(i)),y.setPose(R),b=b.add(1/30)}var E=u.createFromPoses("ToLook",S,w,b.subtract(i));v=new p(E,i,e)}else{if(N.reset(),k)N.generatePose(y,R,n,_);else{for(f=0;f<a.length;f++)N.generatePoseIncremental(r,R,n,_,a[f]);for(f=0;f<s.length;f++)N.generatePoseIncremental(y,R,n,_,s[f])}v=O.createGenerator(s)}var B=new M(n,N,O);O.setHandlers(x(B),V(B),G(B),A(B),I(B)),v=t.add(v,"default");var j=null;if(a.length>0){if(k){var U=u.createFromPose("zero motion",e.getKinematicInfo().getDefaultPose().getCopy(),1,a);t.add(new p(U,i,e,a),"default")}j=O.createGenerator(a),t.add(j,"lookat")}return B.setClip(v,j),B},this.on=function(t,e){var o=E[t];o||(o=[],E[t]=o),-1===o.indexOf(e)&&o.push(e)},this.off=function(t,e){var o=E[t];if(o){var n=o.indexOf(e);-1!==n&&o.splice(n,1)}},this.setDOFs=function(t){t?t instanceof f&&(t=t.getDOFs()):t=N.getDOFs();for(var e=N.getDOFs(),o=[],n=0;n<t.length;n++)e.indexOf(t[n])>-1&&o.push(t[n]);R=new c("LookPose",o)},this.getDOFs=function(){return R.getDOFNames().slice(0)},this.setOrientFully=function(t){k=t},this.setContinuousMode=function(t){P=t},this.setTransitionIn=function(t){o=t},this.getLookatNodeConfig=function(t){if(w.hasOwnProperty(t))return w[t];throw new Error("Cannot get config for unknown node: "+t+" (valid nodes:"+Object.keys(w)+")")},this.setLookatNodeConfig=function(t,e){if(!w.hasOwnProperty(t))throw new Error("Cannot set config for unknown node: "+t+" (valid nodes:"+Object.keys(w)+")");w[t]=e},this.getLookatDOFConfig=function(t){if(D.hasOwnProperty(t))return D[t];throw new Error("Cannot get config for unknown DOF: "+t+" (valid DOFS:"+Object.keys(D)+")")},this.setLookatDOFConfig=function(t,e){if(!D.hasOwnProperty(t))throw new Error("Cannot set config for unknown DOF: "+t+" (valid DOFS:"+Object.keys(D)+")");D[t]=e};var x=function(t){var e=E[O.STARTED];if(e){var o=e.slice(0);return function(){for(var e=0;e<o.length;e++)o[e](O.STARTED,t,{})}}return null},A=function(t){var e=E[O.TARGET_REACHED];if(e){var o=e.slice(0);return function(e){for(var n=0;n<o.length;n++)o[n](O.TARGET_REACHED,t,{target:e})}}return null},I=function(t){var e=E[O.TARGET_SUPERSEDED];if(e){var o=e.slice(0);return function(e){for(var n=0;n<o.length;n++)o[n](O.TARGET_SUPERSEDED,t,{target:e})}}return null},V=function(t){var e=E[O.STOPPED];if(e){var o=null;return e&&(o=e.slice(0)),function(e){if(o)for(var n=0;n<o.length;n++)o[n](O.STOPPED,t,{interrupted:e})}}return null},G=function(t){var e=E[O.STOPPED],o=E[O.CANCELLED];if(e||o){var n=null,i=null;return e&&(n=e.slice(0)),o&&(i=o.slice(0)),function(e,o){var r;if(n&&e&&!o)for(r=0;r<n.length;r++)n[r](O.STOPPED,t,{interrupted:!0});if(i&&!e)for(r=0;r<n.length;r++)i[r](O.CANCELLED,t,{})}}return null}};e.exports=S},{"../geometry-info/DOFSet":41,"../ifr-core/SLog":52,"../ifr-motion/base/Motion":69,"../ifr-motion/base/Pose":73,"../ifr-motion/lookat/LookatMotionNode":93,"../ifr-motion/lookat/LookatNode":94,"../ifr-motion/lookat/MotionLookat":96,"../ifr-motion/lookat/PlaneDisplacementLookatDOF":98,"../ifr-motion/lookat/RotationalLookatDOF":101,"../ifr-motion/lookat/RotationalPlaneAlignmentLookatDOF":102,"../ifr-motion/lookat/trackpolicy/LookatNodeTrackPolicy":103,"../ifr-motion/lookat/trackpolicy/TrackPolicyTriggerAlways":105,"../ifr-motion/lookat/trackpolicy/TrackPolicyTriggerDiscomfort":106,"../ifr-motion/lookat/trackpolicy/TrackPolicyTriggerMovementTerminated":107,"./timeline/LookatMultiLayerStatusManager":12,"./timeline/SimpleMotionGenerator":20,three:void 0}],5:[function(t,e,o){"use strict";var n=function(){};n.prototype.generateTransition=function(t,e,o,n){},n.prototype.clone=function(){},e.exports=n},{}],6:[function(t,e,o){"use strict";var n=t("./SampleCombiner"),i=function(){n.call(this)};i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.combineSamples=function(t,e,o,n){for(var i=[],r=0;r<e.length;r++)r<o.length?i.push(e[r]+o[r]):i.push(e[r]);return i},e.exports=i},{"./SampleCombiner":17}],7:[function(t,e,o){"use strict";var n={};n.prototype={display:function(t,e){}};var i=function(t,e){this.robotInfo=t,this.outputDelegate=e};i.prototype.handleOutput=function(t,e){for(var o={},n=e.getDOFNames(),i=0;i<n.length;i++){var r=e.get(n[i],0);o[n[i]]=r}this.outputDelegate.display(t,o)},e.exports=i},{}],8:[function(t,e,o){"use strict";var n=t("./MotionGenerator"),i=t("./TimelineEventDispatcher"),r=function(t,e,o,i){n.call(this),this._startTime=e,this._name=t,this._customEvents=[],this._targetDuration=i,this._entered=!1,this._exited=!1,this._clipStartedHandler=null,this._clipStoppedHandler=null,this._clipRemovedHandler=null,this._clipEventHandler=null,this._mask={};for(var r=0;r<o.length;r++)this._mask[o[r]]=i;this._currentTime=null};r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.setHandlers=function(t,e,o,n){this._clipStartedHandler=t,this._clipStoppedHandler=e,this._clipRemovedHandler=o,this._clipEventHandler=n},r.prototype.setEvents=function(t){for(var e=0;e<t.length;e++)this._customEvents.push(t[e])},r.prototype.getName=function(){return this._name},r.prototype.getStartTime=function(){return this._startTime},r.prototype.getEndTime=function(){return this._startTime.add(this.getDuration())},r.prototype.getDuration=function(){for(var t=0,e=Object.keys(this._mask),o=0;o<e.length;o++){var n=e[o];this._mask[n]>t&&(t=this._mask[n])}return t},r.prototype.getEndTimeForDOF=function(t){return this._mask.hasOwnProperty(t)?this.getStartTime().add(this._mask[t]):null},r.prototype.getDurationForDOF=function(t){return this._mask.hasOwnProperty(t)?this._mask[t]:null},r.prototype.cropEnd=function(t,e){var o;o=null!=e?e:Object.keys(this._mask);var n,i=t.subtract(this._startTime);if(i>0)for(n=0;n<o.length;n++){var r=o[n];this._mask.hasOwnProperty(r)&&this._mask[r]>i&&(this._mask[r]=i)}else for(n=0;n<o.length;n++)delete this._mask[o[n]]},r.prototype.getDOFs=function(){return Object.keys(this._mask)},r.prototype.getActiveDOFs=function(t){var e=[];if(t.isGreaterOrEqual(this._startTime))for(var o=Object.keys(this._mask),n=0;n<o.length;n++)this.getEndTimeForDOF(o[n]).isGreater(t)&&e.push(o[n]);return e},r.prototype.hasEntered=function(){return this._entered},r.prototype.hasExited=function(){return this._exited},r.prototype.notifyUpdateStarted=function(t){this._currentTime=t},r.prototype.notifyUpdateFinished=function(){if(!this._entered&&this._currentTime.isGreaterOrEqual(this.getStartTime())&&(this._entered=!0,this._clipStartedHandler&&i.queueEvent(this._clipStartedHandler,[])),this._entered&&!this._exited&&this.queueCustomEvents(),this._entered&&!this._exited&&this._currentTime.isGreaterOrEqual(this.getEndTime())){
this._exited=!0;var t=Math.abs(this.getDuration()-this._targetDuration)>.001;this._clipStoppedHandler&&i.queueEvent(this._clipStoppedHandler,[t])}},r.prototype.notifyRemoved=function(){this._clipRemovedHandler&&i.queueEvent(this._clipRemovedHandler,[this._entered,this._exited])},r.prototype.queueCustomEvents=function(){if(this.hasEntered()&&!this.hasExited()&&this._clipEventHandler)for(var t=this._currentTime.subtract(this.getStartTime()),e=this.getDuration();this._customEvents.length>0&&this._customEvents[0].getTimestamp()<=t&&this._customEvents[0].getTimestamp()<=e;)i.queueEvent(this._clipEventHandler,[this._customEvents[0]]),this._customEvents.shift()},e.exports=r},{"./MotionGenerator":15,"./TimelineEventDispatcher":21}],9:[function(t,e,o){"use strict";var n=function(){};n.prototype.combineLayers=function(t,e){},n.prototype.incrementState=function(t,e,o,n){},n.getSkipLayerProperty=function(t){return"skip_layer:"+t},e.exports=n},{}],10:[function(t,e,o){"use strict";var n=function i(t,e){this.getTime=function(){return t},this.setTime=function(e){t=e},this.getPose=function(){return e},this.getDOFNames=function(){return e.getDOFNames()},this.getDOFState=function(t){return e.get(t)},this.setDOFState=function(t,o){e.set(t,o)},this.getCopy=function(o){return(null===o||void 0===o)&&(o=t),new i(o,e.getCopy())}};e.exports=n},{}],11:[function(t,e,o){"use strict";var n=t("./BaseMotionGenerator"),i=t("../../ifr-motion/base/Pose"),r=t("../../ifr-core/SLog"),s="LOOKAT",a=function(t,e,o,a,l){var c,u=t.getDOFs();if(null!=a){c=[];for(var h=0;h<a.length;h++)u.indexOf(a[h])>=0?c.push(a[h]):r(s,"Rejecting dof "+a[h]+" from lookat set as it is covered by no lookat nodes")}else c=u;n.call(this,"SingleLookGenerator",e,c,Number.MAX_VALUE),this._motionLookat=t,this._target=o.clone(),this._generatedPose=new i("LMG generated pose",u),this._frozenPose=new i("LMG frozen pose",c),this._motionLookat.getPose(this._frozenPose),this._multiLayerLookatStatus=l};a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.setTarget=function(t){this._target.copy(t)},a.prototype.notifyUpdateFinished=function(t){var e=this._multiLayerLookatStatus.handleUpdateFinishedForGenerator(this,t);e&&(this._targetDuration=t.subtract(this._startTime),this.cropEnd(t)),n.prototype.notifyUpdateFinished.call(this,t)},a.prototype.getDOFState=function(t,e){var o=this._currentTime.subtract(this.getStartTime()),n=this.getDurationForDOF(t),i=null;return null!==n&&(n>o?(this._motionLookat.generatePoseIncremental(e.getPose(),this._generatedPose,this._target,this._currentTime,t),i=this._generatedPose.get(t),null!==i&&this._frozenPose.set(t,i)):i=this._frozenPose.get(t)),null!=i?i.slice(0):null},e.exports=a},{"../../ifr-core/SLog":52,"../../ifr-motion/base/Pose":73,"./BaseMotionGenerator":8}],12:[function(t,e,o){"use strict";var n=t("../../ifr-core/SLog"),i=t("./LookatMotionGenerator"),r="LOOKAT",s=function(t){this.generator=t,this.layerHasStarted=!1,this.layerHasStopped=!1,this.layerHasRemoved=!1},a=function(t,e,o,n){this._layerStatuses=new Map,this._clipStartedHandler=null,this._clipStoppedHandler=null,this._clipRemovedHandler=null,this._targetReachedHandler=null,this._targetSupersededHandler=null,this._waitingToNotifyOnTarget=null,this._lookat=t,this._startTime=e,this._target=null,this._continuous=n,this._haveSentStart=!1,this.setTarget(o)};a.prototype.createGenerator=function(t){var e=new i(this._lookat,this._startTime,this._target,t,this);return this._layerStatuses.set(e,new s(e)),e.setHandlers(this.handleStarted.bind(this,e),this.handleStopped.bind(this,e),this.handleRemoved.bind(this,e),null),e},a.prototype.setHandlers=function(t,e,o,n,i){this._clipStartedHandler=t,this._clipStoppedHandler=e,this._clipRemovedHandler=o,this._targetReachedHandler=n,this._targetSupersededHandler=i},a.prototype.setTarget=function(t){for(var e,o=this._layerStatuses.keys();!(e=o.next()).done;)e.value.setTarget(t);null!=this._waitingToNotifyOnTarget&&null!=this._targetSupersededHandler&&this._targetSupersededHandler(this._waitingToNotifyOnTarget),this._waitingToNotifyOnTarget=t.clone(),this._target=this._waitingToNotifyOnTarget},a.prototype.handleUpdateFinishedForGenerator=function(t,e){var o=this.getActiveDOFs(e),n=o.length>0&&this._lookat.getDistanceRemaining(o)<.001;return n&&null!=this._waitingToNotifyOnTarget&&(null!=this._targetReachedHandler&&this._targetReachedHandler(this._waitingToNotifyOnTarget),this._waitingToNotifyOnTarget=null),!(!n||this._continuous)},a.prototype.getActiveDOFs=function(t){for(var e,o=new Set,n=this._layerStatuses.keys();!(e=n.next()).done;)for(var i=e.value.getActiveDOFs(t),r=0;r<i.length;r++)o.add(i[r]);for(var s,a=[],l=o.keys();!(s=l.next()).done;)a.push(s.value);return a},a.prototype.handleStarted=function(t){var e=this._layerStatuses.get(t);if(e.layerHasStarted=!0,this._clipStartedHandler){var o=!0;for(var n of this._layerStatuses.values())n.layerHasStarted||n.layerHasRemoved||(o=!1);o&&(this._clipStartedHandler(),this._haveSentStart=!0)}},a.prototype.handleStopped=function(t,e){var o=this._layerStatuses.get(t);if(o.layerHasStopped&&n(r,"LookatMultiLayerStatManager: getting stop event for stopped layer "+t),o.layerHasStopped=!0,this._clipStoppedHandler){var i=!0;for(var s of this._layerStatuses.values())s.layerHasStopped||s.layerHasRemoved||(i=!1);i&&this._clipStoppedHandler(e)}},a.prototype.handleRemoved=function(t,e,o){var n=this._layerStatuses.get(t);n.layerHasRemoved=!0;var i=null;if(!this._haveSentStart&&this._clipStartedHandler){var r=!0;for(i of this._layerStatuses.values())i.layerHasRemoved||i.layerHasStarted||(r=!1);r&&(this._clipRemovedHandler(),this._haveSentStart=!0)}if(this._clipRemovedHandler){var s=!0;for(i of this._layerStatuses.values())i.layerHasRemoved||(s=!1);s&&this._clipRemovedHandler(e,o)}},e.exports=a},{"../../ifr-core/SLog":52,"./LookatMotionGenerator":11}],13:[function(t,e,o){"use strict";var n=t("../../ifr-motion/base/MotionValidator"),i=t("./BaseMotionGenerator"),r=t("./TimelineEventDispatcher"),s=function(t,e,o,r,s){if(!t)throw new Error("tried to construct LoopedMotionGenerator with empty motion list");if(0>e)throw new Error("numLoops value is negative: "+e);s||(s=Object.keys(t[0].getTracks()));var a,l,c;for(a=0;a<t.length;a++)for(c=t[a].getTracks(),l=0;l<s.length;l++)if(!c.hasOwnProperty(s[l]))throw new Error("LoopedMotionGenerator: motion "+a+" doesn't have a track for required DOF: "+s[l]);for(this._durationList=[],a=0;a<t.length;a++){var u=0;for(l=0;l<s.length;l++){var h=t[a].getTracks()[s[l]].getLength();h>u&&(u=h)}this._durationList.push(u)}for(this._loopDuration=0,a=0;a<t.length;a++)this._loopDuration=this._loopDuration+this._durationList[a];var p=0;for(p=0===e?Number.MAX_VALUE:this._loopDuration*e,i.call(this,t[0].getName(),o,s,p),a=0;a<t.length;a++)n.valuesExist(t[a]);this._motionList=t,this._numLoops=e,this._customEventTimes=[],this._eventLoopIndex=0,this._eventIndex=0,this._interpolatorSet=r.getKinematicInfo().getInterpolatorSet()};s.prototype=Object.create(i.prototype),s.prototype.constructor=s,s.prototype.setEvents=function(t){if(t.length!==this._motionList.length)throw new Error("motionEventsList length "+t.length+" doesn't match motionList length "+this._motionList.length);for(var e=0,o=0;o<this._motionList.length;o++){for(var n=t[o],i=0;i<n.length;i++)this._customEvents.push(n[i]),this._customEventTimes.push(e+n[i].getTimestamp());e+=this._durationList[o]}},s.prototype.getDOFState=function(t,e){var o=this._currentTime.subtract(this.getStartTime()),n=this.getDurationForDOF(t);if(null!==n){var i=Math.min(o,n);i=Math.max(i,0);var r=Math.floor(i/this._loopDuration);0!==this._numLoops&&(r=Math.min(r,this._numLoops-1));for(var s=i-this._loopDuration*r,a=0,l=s;a<this._motionList.length-1&&l>this._durationList[a];)l-=this._durationList[a],a++;var c=this._motionList[a].getTracks()[t].getDataAtTime(l,this._interpolatorSet.getInterpolator(t));return c}return null},s.prototype.queueCustomEvents=function(){if(this.hasEntered()&&!this.hasExited()&&this._clipEventHandler){var t=this._currentTime.subtract(this.getStartTime()),e=this.getDuration(),o=Math.min(t,e);o=Math.max(o,0);var n=Math.floor(o/this._loopDuration);0!==this._numLoops&&(n=Math.min(n,this._numLoops-1));for(var i=o-this._loopDuration*n;this._eventLoopIndex<n;){for(;this._eventIndex<this._customEvents.length;)r.queueEvent(this._clipEventHandler,[this._customEvents[this._eventIndex]]),this._eventIndex++;this._eventLoopIndex++,this._eventIndex=0}for(;this._eventIndex<this._customEvents.length&&this._customEventTimes[this._eventIndex]<=i;)r.queueEvent(this._clipEventHandler,[this._customEvents[this._eventIndex]]),this._eventIndex++}},e.exports=s},{"../../ifr-motion/base/MotionValidator":72,"./BaseMotionGenerator":8,"./TimelineEventDispatcher":21}],14:[function(t,e,o){"use strict";var n=t("./SampleCombiner"),i=function(){n.call(this),this._combinerMap={}};i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.addCombiner=function(t,e){for(var o=0;o<t.length;o++)this._combinerMap[t[o]]=e},i.prototype.combineSamples=function(t,e,o,n){var i=this._combinerMap[t];if(!i)throw new Error("no combiner specified for DOF: "+t);return i.combineSamples(t,e,o,n)},e.exports=i},{"./SampleCombiner":17}],15:[function(t,e,o){"use strict";var n=function(){};n.prototype.getName=function(){},n.prototype.getStartTime=function(){},n.prototype.getEndTime=function(){},n.prototype.getDuration=function(){},n.prototype.getEndTimeForDOF=function(t){},n.prototype.getDurationForDOF=function(t){},n.prototype.cropEnd=function(t,e){},n.prototype.getDOFs=function(){},n.prototype.hasEntered=function(){},n.prototype.hasExited=function(){},n.prototype.notifyUpdateStarted=function(t){},n.prototype.notifyUpdateFinished=function(){},n.prototype.notifyRemoved=function(){},n.prototype.getDOFState=function(t,e){},e.exports=n},{}],16:[function(t,e,o){"use strict";var n=t("../../ifr-motion/base/Pose"),i=t("../../ifr-motion/base/DOFGlobalAlignment"),r=t("../../ifr-motion/base/CyclicMath"),s=t("../../ifr-core/SLog"),a=t("./TimelineEventDispatcher"),l=t("./LayerState"),c=function(t,e,o,n,r){this._name=t,this._layers={},this._layerNames=[],this._robotInfo=e,this._dofNames=e.getDOFNames(),this._layerStates={},this._previousLayerStates={},this._systemState=new l(o.currentTime(),e.getKinematicInfo().getDefaultPose().getCopy()),this._previousSystemState=this._systemState.getCopy(),this._outputs=[],this._clock=o,this._layerCombiner=n,this._modalityName=r,this._dofAlignment=new i(this._robotInfo.getKinematicInfo().getFullKinematicGroup(),null),this._sortedDOFNames=this._dofNames.slice(0),this._sortedDOFNames=this._dofAlignment.sortDOFsByDepth(this._sortedDOFNames),this._dofMapByLayer={},this._minimumUpdateDelay=.01};c.prototype.getModalityDelegate=function(t){return t===this._modalityName?this:null},c.prototype.getClock=function(){return this._clock},c.prototype.getName=function(){return this._name},c.prototype.createLayer=function(t,e){if(this._layers.hasOwnProperty(t))s.error("Not creating Timeline layer "+t+" since we already have one!");else{null==e&&(e=this._dofNames),this._layers[t]=[],this._layerNames.push(t);var o=this._robotInfo.getKinematicInfo().getDefaultPose(),i=new n(t+"_pose",e.slice(0));i.setPose(o),this._layerStates[t]=new l(this._clock.currentTime(),i),this._previousLayerStates[t]=this._layerStates[t].getCopy(),this._dofMapByLayer[t]={};for(var r=0;r<e.length;r++){var a=e[r];this._dofMapByLayer[t][a]=a}}},c.prototype.getLayerNames=function(){return this._layerNames.slice(0)},c.prototype.getLayerCombiner=function(){return this._layerCombiner},c.prototype.getCurrentState=function(t){if(!t)return this._systemState;var e,o=[];for(e=0;e<t.length;e++){if(!this._layerStates.hasOwnProperty(t[e]))return s.error("MotionTimeline: requested state for unknown layer: "+t[e]),null;o.push(this._layerStates[t[e]])}var n=this._layerCombiner.combineLayers(t,o);if(null!==n){var i=null;if(n.getTime().subtract(this._previousLayerStates[t[0]].getTime())>=this._minimumUpdateDelay&&(i=this._previousLayerStates),null!==i){var r=[];for(e=0;e<t.length;e++){if(!i.hasOwnProperty(t[e])){r=null;break}r.push(i[t[e]])}if(null!==r){var a=this._layerCombiner.combineLayers(t,r);null!==a&&this.computeVelocity(a,n)}}}return n},c.prototype.add=function(t,e){if(!this._layers.hasOwnProperty(e))return s.error("MotionTimeline: skipping add on unknown layer: "+e),null;for(var o=t.getStartTime(),n=t.getDOFs(),i=0,r=this._layers[e],a=0;a<r.length;){var l=r[a];l.getEndTime().isGreater(o)&&l.cropEnd(o,n),l.getDuration()>0?a++:(r.splice(a,1),l.notifyRemoved()),o.isGreaterOrEqual(l.getStartTime())&&(i=a)}return t.getDuration()>0?r.splice(i,0,t):(t.notifyRemoved(),t=null),t},c.prototype.cullUpToTime=function(t){for(var e=Object.keys(this._layers),o=0;o<e.length;o++)for(var n=this._layers[e[o]],i=0;i<n.length&&t.isGreater(n[i].getStartTime());){var r=n[i];t.isGreaterOrEqual(r.getEndTime())?(n.splice(i,1),r.notifyRemoved()):i++}},c.prototype.render=function(t){var e,o,n,i,r,s,a,l,c,u,h=this._previousSystemState;for(this._previousSystemState=this._systemState,this._systemState=h,this._systemState.setTime(t),e=0;e<this._layerNames.length;e++)i=this._layerNames[e],h=this._previousLayerStates[i],this._previousLayerStates[i]=this._layerStates[i],this._layerStates[i]=h,this._layerStates[i].setTime(t);for(o=0;o<this._sortedDOFNames.length;o++)for(r=this._sortedDOFNames[o],e=0;e<this._layerNames.length;e++)if(i=this._layerNames[e],this._dofMapByLayer[i].hasOwnProperty(r)){for(s=this._layers[i],c=null,n=0;n<s.length&&t.isGreaterOrEqual(s[n].getStartTime());)a=s[n],u=a.getEndTimeForDOF(r),null!==u&&u.isGreater(this._previousLayerStates[i].getTime())&&(c=a),n++;l=null,l=c?c.getDOFState(r,this._systemState):this._previousLayerStates[i].getDOFState(r),this._layerStates[i].setDOFState(r,l),0===e?this._systemState.setDOFState(r,l):this._layerCombiner.incrementState(this._systemState,i,this._layerStates[i],r)}this.computeVelocity(this._previousSystemState,this._systemState)},c.prototype.addOutput=function(t){this._outputs.push(t)},c.prototype.removeOutput=function(t){var e=this._outputs.indexOf(t);e>-1&&this._outputs.splice(e,1)},c.prototype.getOutputs=function(){return this._outputs},c.prototype.computeVelocity=function(t,e){for(var o=e.getTime().subtract(t.getTime()),n=t.getPose(),i=e.getPose(),s=e.getDOFNames(),a=0;a<s.length;a++){var l=s[a],c=this._robotInfo.getDOFInfo(l);if(c.isMetric()){var u=i.get(l,0),h=n.get(l,0);c.isCyclic()&&(u=r.closestEquivalentRotation(u,h));var p=(u-h)/o;e.getPose().set(l,p,1)}}},c.prototype.update=function(){var t=this._clock.currentTime();if(!(t.subtract(this._systemState.getTime())<this._minimumUpdateDelay)){var e,o,n,i,r=this._layerNames;for(e=0;e<r.length;e++)for(n=this._layers[r[e]],o=0;o<n.length;o++)i=n[o],i.notifyUpdateStarted(t);this.render(t);for(var s=0;s<this._outputs.length;s++){var l=this._outputs[s];l.handleOutput(t,this._systemState.getPose())}for(e=0;e<r.length;e++)for(n=this._layers[r[e]],o=0;o<n.length;o++)i=n[o],i.notifyUpdateFinished(t);this.cullUpToTime(t),a.dispatchQueuedEvents()}},c.prototype.getDOFsForLayer=function(t){return this._layerStates.hasOwnProperty(t)?this._layerStates[t].getDOFNames():null},e.exports=c},{"../../ifr-core/SLog":52,"../../ifr-motion/base/CyclicMath":65,"../../ifr-motion/base/DOFGlobalAlignment":66,"../../ifr-motion/base/Pose":73,"./LayerState":10,"./TimelineEventDispatcher":21}],17:[function(t,e,o){"use strict";var n=function(){};n.prototype.combineSamples=function(t,e,o,n){},e.exports=n},{}],18:[function(t,e,o){"use strict";var n=t("./SampleCombiner"),i=function(t,e,o){n.call(this),this._unityScales={},this._zeroScales={};for(var i=0;i<o.length;i++){var r=o[i];null!=t&&null!=t.get(r)?this._unityScales[r]=t.get(r)[0]:this._unityScales[r]=1,null!=e&&null!=e.get(r)?this._zeroScales[r]=e.get(r)[0]:this._zeroScales[r]=0}};i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.combineSamples=function(t,e,o,n){var i=[],r=this._unityScales[t],s=this._zeroScales[t],a=(o[0]-s)/(r-s)+s;isNaN(a)&&(a=0);for(var l=0;l<e.length;l++)i.push(e[l]*a);return i},e.exports=i},{"./SampleCombiner":17}],19:[function(t,e,o){"use strict";var n=t("./LayerCombiner"),i=function(){n.call(this),this.sampleCombiners={}};i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.setSampleCombiner=function(t,e){this.sampleCombiners[t]=e},i.prototype.combineLayers=function(t,e){if(!t)return null;for(var o=e[0].getCopy(),n=1;n<t.length;n++)for(var i=e[n].getDOFNames(),r=0;r<i.length;r++)this.incrementState(o,t[n],e[n],i[r]);return o},i.prototype.incrementState=function(t,e,o,n){var i=t.getPose().get(n),r=o.getPose().get(n),s=this.sampleCombiners[e];if(i&&r&&s){var a=s.combineSamples(n,i,r,null);t.getPose().set(n,a)}else;},e.exports=i},{"./LayerCombiner":9}],20:[function(t,e,o){"use strict";var n=t("../../ifr-motion/base/MotionValidator"),i=t("./BaseMotionGenerator"),r=function(t,e,o,r){r||(r=Object.keys(t.getTracks()));for(var s=0,a=0;a<r.length;a++){var l=t.getTracks()[r[a]].getLength();l>s&&(s=l)}i.call(this,t.getName(),e,r,s),n.valuesExist(t),this._motion=t,this._interpolatorSet=o.getKinematicInfo().getInterpolatorSet()};r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.getDOFState=function(t,e){var o=this._currentTime.subtract(this.getStartTime()),n=this.getDurationForDOF(t);if(null!==n){var i=Math.min(o,n),r=this._motion.getTracks()[t].getDataAtTime(i,this._interpolatorSet.getInterpolator(t));return r}return null},e.exports=r},{"../../ifr-motion/base/MotionValidator":72,"./BaseMotionGenerator":8}],21:[function(t,e,o){"use strict";var n=t("../../ifr-core/SLog"),i=[],r={queueEvent:function(t,e){null==t&&n.error("Error, null/undefined function queued!\n"+(new Error).stack),i.push({f:t,a:e})},dispatchQueuedEvents:function(){for(var t=0;t<i.length;t++){var e=i[t];e.f.apply(null,e.a)}i.length=0}};e.exports=r},{"../../ifr-core/SLog":52}],22:[function(t,e,o){"use strict";var n=t("../ifr-core/Time"),i=t("../ifr-core/SLog"),r={NONE:0,LIMP:1,BRAKE:2,PWM:3,VELOCITY:4,TRAJECTORY:5,TORQUE:6,POS_VEL:7},s=function(){this.ts=null,this.pos=null,this.inc_pos=null,this.vel=null,this.cur=null,this.pwm=null,this.status=null,this.vel_limit=null,this.acc_limit=null,this.cur_limit=null,this.mode=null,this.ref=null,this.ref_pos=null,this.ref_acc=null,this.ticks=null,this.integrator=null,this.fault_status=null};s.prototype.getTimestamp=function(){return null===this.ts?null:n.createFromTimestamp(this.ts)},s.prototype.isIndexed=function(){return null===this.status?!1:(1&this.status)>0},s.prototype.setFromJson=function(t){for(var e=Object.keys(t),o=0;o<e.length;o++)this.hasOwnProperty(e[o])?this[e[o]]=t[e[o]]:i.info("SingleAxisState: unknown JSON property name: "+e[o]);return this};var a=function(){this.ts=null,this.pelvis=null,this.torso=null,this.neck=null};a.prototype.getTimestamp=function(){return null===this.ts?null:n.createFromTimestamp(this.ts)},a.prototype.setFromJson=function(t){return this.ts=t.ts,this.pelvis=(new s).setFromJson(t.pelvis),this.torso=(new s).setFromJson(t.torso),this.neck=(new s).setFromJson(t.neck),this};var l=function(){this.mode=null,this.value=null,this.vel_limit=null,this.acc_limit=null,this.cur_limit=null},c=function(){this.ts=null,this.pelvis=null,this.torso=null,this.neck=null};c.prototype.setTimestamp=function(t){this.ts=t._timestamp};var u=function(){this.ts=null,this.color=null,this.rate_limit=null};u.prototype.setTimestamp=function(t){this.ts=t._timestamp},u.prototype.setRateLimit=function(t){this.rate_limit=[t,t,t]},e.exports.AxisCommandMode=r,e.exports.SingleAxisState=s,e.exports.AxisState=a,e.exports.SingleAxisCommand=l,e.exports.AxisCommand=c,e.exports.LEDCommand=u},{"../ifr-core/SLog":52,"../ifr-core/Time":53}],23:[function(t,e,o){"use strict";var n=t("./MotionInterface"),i=t("../ifr-core/TimerTools"),r=function(t,e,o,r,s,a){this.clock=t,this.robotInfo=e,this.outputTime=null,this.outputPose=null,this.reactionTime=.02,this.velocityCalcDelta=.02,this.motionInterface=new n(o,a),this.dofNames=this.motionInterface.getMotionDOFNames(),this.enabledArray=[];for(var l=0;l<this.dofNames.length;l++)this.enabledArray.push(void 0!==r?r:!1);if(this.infoListeners=[],this.updateHandle=null,s){var c=this;this.updateHandle=i.setInterval(function(){c.update()},s)}this.cachedTargets=null};r.prototype.getMotionDOFNames=function(){return this.dofNames},r.prototype.isConnected=function(){return this.motionInterface.isConnected()},r.prototype.setEnabled=function(t){for(var e=0;e<this.enabledArray.length;e++)this.enabledArray[e]=t instanceof Array?t[e]:t},r.prototype.addInfoListener=function(t){this.infoListeners.push(t)},r.prototype.handleOutput=function(t,e){this.outputTime=t,this.outputPose=e,this.computeTargetsForTime(t,!0)},r.prototype.update=function(){},r.prototype.computeTargetsForTime=function(t,e){if(!e)return this.cachedTargets;if(null!==this.outputPose){for(var o=this.outputPose,n=[],i=0;i<this.dofNames.length;i++){var r=o.get(this.dofNames[i],0),s=o.get(this.dofNames[i],1);Math.abs(s)<.01&&(s=0),n.push({position:r,velocity:s})}return this.cachedTargets=n,n}return this.cachedTargets=null,null},r.prototype.dispose=function(){this.motionInterface.close(),null!==this.updateHandle&&(i.clearInterval(this.updateHandle),this.updateHandle=null),this.robotInfo=null,this.outputPose=null},e.exports=r},{"../ifr-core/TimerTools":54,"./MotionInterface":31}],24:[function(t,e,o){"use strict";var n=t("./BodyData"),i=t("./BodyOutput"),r=t("../ifr-core/Clock"),s=function(t,e,o,n,r,s,a){i.call(this,t,e,o,n,r,s),this.idleModeSwitchTime=.3,null!=a&&(this.idleModeSwitchTime=a),this.startTime=null,this.initialStates=[],this.lastMovingCommandTime=[],this.movingEpsilon=1e-4};s.prototype=Object.create(i.prototype),s.prototype.constructor=i,s.prototype.update=function(){var t,e=this.clock.currentTime(),o=this.computeTargetsForTime(e.add(this.reactionTime));if(null!==o&&this.motionInterface.isConnected()){if(null===this.startTime){for(this.startTime=e,t=0;t<this.dofNames.length;t++)this.initialStates.push(this.motionInterface.getState(this.dofNames[t]));for(t=0;t<this.dofNames.length;t++)this.lastMovingCommandTime.push(r.currentTime())}var i=1,s=8;if(e.subtract(this.startTime)<s){var a=0;for(t=0;t<this.dofNames.length;t++)Math.abs(this.initialStates[t].pos)>a&&(a=Math.abs(this.initialStates[t].pos));a=Math.max(0,Math.min(Math.PI,a));var l=s*(a/Math.PI);i=e.subtract(this.startTime)/l,i=Math.max(0,Math.min(1,i))}for(t=0;t<this.dofNames.length;t++){var c,u=50;1>i?(c=[o[t].velocity*i,o[t].position*i+this.initialStates[t].pos*(1-i)],this.lastMovingCommandTime[t]=r.currentTime()):c=[o[t].velocity,o[t].position],(Math.abs(c[0])>this.movingEpsilon||1>i)&&(this.lastMovingCommandTime[t]=r.currentTime());var h,p;if(this.idleModeSwitchTime>0&&r.currentTime().subtract(this.lastMovingCommandTime[t])>this.idleModeSwitchTime)this.motionInterface.setCommand(this.dofNames[t],this.enabledArray[t]?n.AxisCommandMode.VELOCITY:n.AxisCommandMode.LIMP,0,null,u,null),h=0,p=.25;else{var d=this.enabledArray[t]?n.AxisCommandMode.POS_VEL:n.AxisCommandMode.LIMP;this.motionInterface.setCommand(this.dofNames[t],d,d===n.AxisCommandMode.POS_VEL?c:0,null,u,null),h=c[0],p=c[1]}if(this.infoListeners.length>0)for(var m=this.motionInterface.getState(this.dofNames[t]),f={dofName:this.dofNames[t],timestamp:e,observedPosition:m.pos,targetPosition:p,observedVelocity:m.vel,commandVelocity:h,refVelocity:m.ref},g=0;g<this.infoListeners.length;g++)this.infoListeners[g](f)}this.motionInterface.sendCommand()}},e.exports=s},{"../ifr-core/Clock":49,"./BodyData":22,"./BodyOutput":23}],25:[function(t,e,o){"use strict";var n=t("./BodyData"),i=t("./BodyOutput"),r=function(t,e,o,n,r,s){i.call(this,t,e,o,n,r,s),this.startTime=null,this.initialStates=[]};r.prototype=Object.create(i.prototype),r.prototype.constructor=i,r.prototype.update=function(){var t,e=this.clock.currentTime(),o=this.computeTargetsForTime(e.add(this.reactionTime));if(null!==o&&this.motionInterface.isConnected()){if(null===this.startTime)for(this.startTime=e,t=0;t<this.dofNames.length;t++)this.initialStates.push(this.motionInterface.getState(this.dofNames[t]));var i=1,r=8;if(e.subtract(this.startTime)<r){var s=0;for(t=0;t<this.dofNames.length;t++)Math.abs(this.initialStates[t].pos)>s&&(s=Math.abs(this.initialStates[t].pos));s=Math.max(0,Math.min(Math.PI,s));var a=r*(s/Math.PI);i=e.subtract(this.startTime)/a,i=Math.max(0,Math.min(1,i))}for(t=0;t<this.dofNames.length;t++){var l,c=this.enabledArray[t]?n.AxisCommandMode.POS_VEL:n.AxisCommandMode.LIMP,u=50;if(l=1>i?[o[t].velocity*i,o[t].position*i+this.initialStates[t].pos*(1-i)]:[o[t].velocity,o[t].position],this.motionInterface.setCommand(this.dofNames[t],c,c===n.AxisCommandMode.POS_VEL?l:0,null,u,null),this.infoListeners.length>0)for(var h=this.motionInterface.getState(this.dofNames[t]),p={dofName:this.dofNames[t],timestamp:e,observedPosition:h.pos,targetPosition:l[1],observedVelocity:h.vel,commandVelocity:l[0],refVelocity:h.ref},d=0;d<this.infoListeners.length;d++)this.infoListeners[d](p)}this.motionInterface.sendCommand()}},e.exports=r},{"./BodyData":22,"./BodyOutput":23}],26:[function(t,e,o){"use strict";var n=t("./BodyOutput"),i=function(t,e,o,i,r,s){n.call(this,t,e,o,i,r,s)};i.prototype=Object.create(n.prototype),i.prototype.constructor=n,i.prototype.update=function(){var t=this.clock.currentTime(),e=this.computeTargetsForTime(t.add(this.reactionTime));if(null!==e&&this.motionInterface.isConnected()){for(var o=0;o<this.dofNames.length;o++){var n=e[o].position;this.motionInterface.setCommand(this.dofNames[o],0,n,null,null,null)}this.motionInterface.sendCommand()}},e.exports=i},{"./BodyOutput":23}],27:[function(t,e,o){"use strict";var n=t("./BodyData"),i=t("./BodyOutput"),r=function(t,e,o,n,r,s){i.call(this,t,e,o,n,r,s)};r.prototype=Object.create(i.prototype),r.prototype.constructor=i,r.prototype.update=function(){var t=this.clock.currentTime(),e=this.computeTargetsForTime(t.add(this.reactionTime));if(null!==e&&this.motionInterface.isConnected()){for(var o=0;o<this.dofNames.length;o++){var i=this.enabledArray[o]?n.AxisCommandMode.TRAJECTORY:n.AxisCommandMode.LIMP,r=.3,s=30,a=[e[o].velocity,e[o].position,r,0];if(this.motionInterface.setCommand(this.dofNames[o],i,i===n.AxisCommandMode.TRAJECTORY?a:0,null,s,null),this.infoListeners.length>0)for(var l=this.motionInterface.getState(this.dofNames[o]),c={dofName:this.dofNames[o],timestamp:t,observedPosition:l.pos,targetPosition:e[o].position,observedVelocity:l.vel,commandVelocity:e[o].velocity},u=0;u<this.infoListeners.length;u++)this.infoListeners[u](c)}this.motionInterface.sendCommand()}},e.exports=r},{"./BodyData":22,"./BodyOutput":23}],28:[function(t,e,o){"use strict";var n=t("./BodyData"),i=t("./BodyOutput"),r=t("../ifr-motion/feedback/PVController"),s=function(t,e,o,n,s,a){i.call(this,t,e,o,n,s,a),this.feedbackControllers=[];for(var l=0;l<this.dofNames.length;l++)this.feedbackControllers.push(new r)};s.prototype=Object.create(i.prototype),s.prototype.constructor=i,s.prototype.update=function(){var t=this.clock.currentTime(),e=this.computeTargetsForTime(t.add(this.reactionTime));if(null!==e&&this.motionInterface.isConnected()){for(var o=0;o<this.dofNames.length;o++){this.feedbackControllers[o].setTarget(t,e[o].position,e[o].velocity),this.feedbackControllers[o].calculateForTime(t);var i=this.feedbackControllers[o].getCommandVelocity(),r=this.feedbackControllers[o].getCommandAcceleration(),s=this.enabledArray[o]?n.AxisCommandMode.VELOCITY:n.AxisCommandMode.LIMP;this.motionInterface.setCommand(this.dofNames[o],s,i,null,r,null);var a=this.motionInterface.getState(this.dofNames[o]);if(this.feedbackControllers[o].acceptFeedback(t,a.pos,a.vel,a.ref),this.infoListeners.length>0)for(var l={dofName:this.dofNames[o],timestamp:t,observedPosition:a.pos,targetPosition:e[o].position,observedVelocity:a.vel,commandVelocity:i},c=0;c<this.infoListeners.length;c++)this.infoListeners[c](l)}this.motionInterface.sendCommand()}},e.exports=s},{"../ifr-motion/feedback/PVController":86,"./BodyData":22,"./BodyOutput":23}],29:[function(t,e,o){"use strict";var n=t("./BodyData"),i=t("../ifr-core/Clock"),r=function(t,e){this.command=new n.LEDCommand,this.command.color=[0,0,0],this.command.setRateLimit(50),e?this.commandSocket=new WebSocket(t+"/led_command",e):this.commandSocket=new WebSocket(t+"/led_command")};r.prototype.setCommand=function(t,e){for(var o=0;3>o;o++)this.command.color[o]=t[o];return this.command.setRateLimit(e),!0},r.prototype.sendCommand=function(){if(this.commandSocket.readyState===WebSocket.OPEN){this.command.setTimestamp(i.currentTime());var t=JSON.stringify(this.command);return this.commandSocket.send(t),!0}return!1},r.prototype.isConnected=function(){return this.commandSocket.readyState===WebSocket.OPEN},r.prototype.close=function(){this.commandSocket.close()},e.exports=r},{"../ifr-core/Clock":49,"./BodyData":22}],30:[function(t,e,o){"use strict";var n=t("./LEDInterface"),i=t("../ifr-core/TimerTools"),r=function(t,e,o,r,s,a){if(this.clock=t,this.robotInfo=e,this.outputTime=null,this.outputPose=null,this.reactionTime=.02,this.velocityCalcDelta=.02,this.rateLimit=50,this.ledInterface=new n(o,a),this.dofNames=this.robotInfo.getDOFSet("LED").getDOFs(),this.enabled=void 0!==r?r:!0,this.updateHandle=null,s){var l=this;this.updateHandle=i.setInterval(function(){l.update()},s)}};r.prototype.isConnected=function(){return this.ledInterface.isConnected()},r.prototype.setEnabled=function(t){this.enabled=t},r.prototype.handleOutput=function(t,e){this.outputTime=t,this.outputPose=e},r.prototype.update=function(){var t=this.clock.currentTime(),e=this.computeTargetsForTime(t.add(this.reactionTime));if(null!==e&&this.enabled&&this.ledInterface.isConnected()){for(var o=[],n=0;n<this.dofNames.length;n++)o.push(e[n].position);this.ledInterface.setCommand(o,this.rateLimit),this.ledInterface.sendCommand()}},r.prototype.computeTargetsForTime=function(t){if(null!==this.outputPose){for(var e=this.outputPose,o=[],n=0;n<this.dofNames.length;n++){var i=e.get(this.dofNames[n],0),r=e.get(this.dofNames[n],1);o.push({position:i,velocity:r})}return o}return null},r.prototype.dispose=function(){this.ledInterface.close(),null!==this.updateHandle&&(i.clearInterval(this.updateHandle),this.updateHandle=null),this.robotInfo=null,this.outputPose=null},e.exports=r},{"../ifr-core/TimerTools":54,"./LEDInterface":29}],31:[function(t,e,o){"use strict";var n=t("./BodyData"),i=t("../ifr-core/Clock"),r=function(t,e,o,i,r){var s=o||"bottomSection_r",a=i||"middleSection_r",l=r||"topSection_r";this.dofToAxis={},this.dofToAxis[s]="pelvis",this.dofToAxis[a]="torso",this.dofToAxis[l]="neck",this.dofNames=[s,a,l],this.stateMessageCount=0,this.latestAxisState=null,this.command=new n.AxisCommand,this.command.pelvis=new n.SingleAxisCommand,this.command.torso=new n.SingleAxisCommand,this.command.neck=new n.SingleAxisCommand;var c=this;e?this.stateSocket=new WebSocket(t+"/axis_state",e):this.stateSocket=new WebSocket(t+"/axis_state"),this.stateSocket.onmessage=function(t){var e=JSON.parse(t.data);c.latestAxisState=(new n.AxisState).setFromJson(e),c.stateMessageCount++},e?this.commandSocket=new WebSocket(t+"/axis_command",e):this.commandSocket=new WebSocket(t+"/axis_command")};r.prototype.getMotionDOFNames=function(){return this.dofNames},r.prototype.getState=function(t){if(!this.dofToAxis.hasOwnProperty(t))throw new Error("unknown motion DOF name: "+t);return null!==this.latestAxisState?this.latestAxisState[this.dofToAxis[t]]:null},r.prototype.getStateMessageCount=function(){return this.stateMessageCount},r.prototype.setCommand=function(t,e,o,n,i,r){if(!this.dofToAxis.hasOwnProperty(t))throw new Error("unknown motion DOF name: "+t);var s=this.getState(t);if(null!==s){var a=this.command[this.dofToAxis[t]];return a.mode=e,a.value=o instanceof Array?o:[o],a.vel_limit=void 0!==n&&null!==n?n:s.vel_limit,a.acc_limit=void 0!==i&&null!==i?i:s.acc_limit,a.cur_limit=void 0!==r&&null!==r?r:s.cur_limit,
!0}return!1},r.prototype.sendCommand=function(){if(this.commandSocket.readyState===WebSocket.OPEN){this.command.setTimestamp(i.currentTime());var t=JSON.stringify(this.command);return this.commandSocket.send(t),!0}return!1},r.prototype.isConnected=function(){return null!==this.latestAxisState&&this.commandSocket.readyState===WebSocket.OPEN},r.prototype.close=function(){this.stateSocket.close(),this.commandSocket.close()},e.exports=r},{"../ifr-core/Clock":49,"./BodyData":22}],32:[function(t,e,o){"use strict";var n=t("../ifr-core/Time"),i=t("../ifr-core/FileTools"),r={};r.createLog=function(e){var o="fs";o=t(o);var n=o.createWriteStream(e),i=!0;return function(t){i?i=!1:n.write(",\n"),n.write(JSON.stringify(t))}},r.loadLog=function(t,e){i.loadText(t,function(t,o){if(t)e(t,null);else{var i=null;try{var r="["+o+"]";i=JSON.parse(r);for(var s=0;s<i.length;s++)i[s].timestamp=n.createFromTimestamp(i[s].timestamp._timestamp)}catch(a){e(a,null)}e(null,i)}})},e.exports=r},{"../ifr-core/FileTools":50,"../ifr-core/Time":53}],33:[function(t,e,o){"use strict";var n=t("./BodyOutput"),i=function(t,e,o,i,r,s,a){n.call(this,t,e,o,r,s,a),this.commandSocket=new WebSocket(i)};i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.update=function(){var t=this.clock.currentTime(),e=this.computeTargetsForTime(t.add(this.reactionTime));if(null!==e&&this.commandSocket.readyState===WebSocket.OPEN){for(var o=0;o<this.dofNames.length;o++)e[o].enabled=this.enabledArray[o];var n=JSON.stringify(e);if(this.commandSocket.send(n),this.infoListeners.length>0&&this.motionInterface.isConnected())for(o=0;o<this.dofNames.length;o++)for(var i=this.motionInterface.getState(this.dofNames[o]),r={dofName:this.dofNames[o],timestamp:t,observedPosition:i.pos,targetPosition:e[o].position,observedVelocity:i.vel,commandVelocity:e[o].velocity},s=0;s<this.infoListeners.length;s++)this.infoListeners[s](r)}},i.prototype.isConnected=function(){return this.motionInterface.isConnected()&&this.commandSocket.readyState===WebSocket.OPEN},e.exports=i},{"./BodyOutput":23}],34:[function(t,e,o){"use strict";var n=t("../animation-animate/AnimateImpl"),i=t("../animation-animate/timeline/MotionTimeline"),r=t("../animation-animate/timeline/SimpleLayerCombiner"),s=t("../animation-animate/timeline/ScaleSampleCombiner"),a=t("../animation-animate/timeline/AddSampleCombiner"),l=t("../animation-animate/timeline/MixedSampleCombiner"),c=t("../animation-visualize/RendererOutput"),u=t("../ifr-core/Clock"),h=t("../ifr-core/TimerTools"),p=[],d=[],m=function(t,e,o){var n=h.setInterval(function(){for(var t=0;t<o.length;t++)o[t].update()},e);p.push(t),d.push(n)},f=function(t){var e=p.indexOf(t);e>-1&&(h.clearInterval(d[e]),p.splice(e,1),d.splice(e,1))},g={createTimeline:function(t,e,o){o=void 0!==o?o:20;var h=new r,p=new i("Motion Timeline",t,u,h,n.MODALITY_NAME);p.createLayer("default"),p.createLayer("lookat",[t.getDOFSet("BODY").getDOFs()[0]]),h.setSampleCombiner("lookat",new a),p.createLayer("posture",t.getDOFSet("BODY").plus("EYE_ROOT").plus("OVERLAY_ROOT").getDOFs()),h.setSampleCombiner("posture",new a);var d=t.getDOFSet("BODY").plus("EYE_ROOT").plus("OVERLAY_ROOT"),f=t.getDOFSet("EYE_DEFORM").plus("OVERLAY_DEFORM");p.createLayer("beat",d.plus(f).getDOFs());var g=new l;g.addCombiner(d.getDOFs(),new a);var y=new s(t.getKinematicInfo().getDefaultPose().getCopy(),null,f.getDOFs());g.addCombiner(f.getDOFs(),y),h.setSampleCombiner("beat",g);var _=t.getDOFSet("EYE_DEFORM").getDOFs();p.createLayer("blink",_);var v=new s(t.getKinematicInfo().getDefaultPose().getCopy(),null,_);h.setSampleCombiner("blink",v);var T=new c(u);T.setKinematicInfo(t.getKinematicInfo()),p.addOutput(T);var O=[p,T];return m(p,o,O),e&&e(p),p},connectRenderer:function(t,e){for(var o=t.getOutputs(),n=0;n<o.length;n++)if(o[n]instanceof c){o[n].addRenderer(e);break}},disconnectRenderer:function(t,e){for(var o=t.getOutputs(),n=0;n<o.length;n++)if(o[n]instanceof c){o[n].removeRenderer(e);break}},disposeTimeline:function(t,e){if(f(t),e===!0)for(var o=t.getOutputs(),n=0;n<o.length;n++)void 0!==o[n].dispose&&o[n].dispose()}};e.exports=g},{"../animation-animate/AnimateImpl":2,"../animation-animate/timeline/AddSampleCombiner":6,"../animation-animate/timeline/MixedSampleCombiner":14,"../animation-animate/timeline/MotionTimeline":16,"../animation-animate/timeline/ScaleSampleCombiner":18,"../animation-animate/timeline/SimpleLayerCombiner":19,"../animation-visualize/RendererOutput":39,"../ifr-core/Clock":49,"../ifr-core/TimerTools":54}],35:[function(t,e,o){"use strict";var n=t("three"),i=t("./RenderPlugin"),r=function(){i.call(this,"DefaultEyeLighting"),this._mainLightBasePosition=new n.Vector3(0,.03,.09),this._mainLightXScale=2,this._mainLightYScale=2.7,this._ledEffectAmount=.2};r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.install=function(t,e){if(null!=e){var o=new n.AmbientLight(3158064);e.add(o),this._registerObjectForScene(e,"ambientLight",o);var i=new n.DirectionalLight(0,1);i.position.set(0,-2,0),e.add(i),this._registerObjectForScene(e,"ledLight",i);var r=new n.PointLight(10526880,1.2,1);r.position.copy(this._mainLightBasePosition),this._registerObjectForScene(e,"mainLight",r),e.add(r),this._markMaterialsForUpdate(e)}},r.prototype.update=function(t,e,o){if(null!=e){var n=this._getObjectForScene(e,"ledLight");if(null!=n){var i=o.lightring_redChannelBn_r,r=o.lightring_greenChannelBn_r,s=o.lightring_blueChannelBn_r;null!=i&&null!=r&&null!=s&&n.color.setRGB(i*this._ledEffectAmount,r*this._ledEffectAmount,s*this._ledEffectAmount)}var a=this._getObjectForScene(e,"mainLight");if(null!=a){var l=o.eyeSubRootBn_t,c=o.eyeSubRootBn_t_2;if(null!=l&&null!=c){l=this._mainLightBasePosition.x+l*this._mainLightXScale,c=this._mainLightBasePosition.y+c*this._mainLightYScale;var u=this._mainLightBasePosition.z;a.position.set(l,c,u)}}}},r.prototype.uninstall=function(t,e){if(null!=e){for(var o=["ambientLight","ledLight","mainLight"],n=0;n<o.length;n++){var i=this._getObjectForScene(e,o[n]);null!=i&&e.remove(i)}this._clearObjectForScene(e)}},e.exports=r},{"./RenderPlugin":38,three:void 0}],36:[function(t,e,o){"use strict";var n=t("../ifr-geometry/loaders/ArticulatedModelLoader"),i=t("../ifr-motion/loaders/KinematicsLoader"),r=t("../ifr-motion/dofs/TextureControl"),s=t("three"),a=function(t){this._config=t,this._textureLoader=null,this._modelRoot=null,this._modelControlGroup=null,this.loadSucceeded=!1,this.loadMessage=""};a.prototype.setTextureLoader=function(t){this._textureLoader=t},a.prototype.load=function(t){var e=this,o=new n;o.modelLoader.defaultMaterial.side=s.DoubleSide,o.load("body model",e._config.getBodyGeometryURL(),e._config.getBodySkeletonURL(),function(){var n=o.getResult();if(n.success){e._modelRoot=n.modelRoot;var s=new i,a=s.getModelControlFactory(r.Factory.prototype._controlType);e._textureLoader&&a.setSharedImageLoader(e._textureLoader),s.load(e._config.getBodyKinematicsURL(),function(){var o=s.getResult();o.success?(e._modelControlGroup=o.modelControlGroup,e._modelControlGroup.attachToModel(e._modelRoot),e.loadSucceeded=!0):(e.loadSucceeded=!1,e.loadMessage="kinematics load failed with message: "+o.message+", URL = "+o.url),t&&t()})}else e.loadSucceeded=!1,e.loadMessage=""+n.message+", model URL = "+n.modelUrl+", skeleton URL = "+n.skeletonUrl,t&&t()})},a.prototype.getModelRoot=function(){return this._modelRoot},a.prototype.getModelControlGroup=function(){return this._modelControlGroup},a.prototype.constructFaceScreenRenderTarget=function(t){var e=new s.WebGLRenderTarget(800,450);e.minFilter=s.LinearFilter;var o=this.getModelRoot().getObjectByName(t.faceScreenMeshName,!0);return o.material.map=e,e},e.exports=a},{"../ifr-geometry/loaders/ArticulatedModelLoader":58,"../ifr-motion/dofs/TextureControl":83,"../ifr-motion/loaders/KinematicsLoader":90,three:void 0}],37:[function(t,e,o){"use strict";var n=t("../ifr-geometry/loaders/ArticulatedModelLoader"),i=t("../ifr-motion/loaders/KinematicsLoader"),r=t("../ifr-motion/dofs/TextureControl"),s=t("three"),a=function(t){this._config=t,this._textureLoader=null,this._modelRoot=null,this._modelControlGroup=null,this.loadSucceeded=!1,this.loadMessage=""};a.prototype.setTextureLoader=function(t){this._textureLoader=t},a.prototype.load=function(t){var e=this,o=new n;o.load("eye model",e._config.getEyeGeometryURL(),e._config.getEyeSkeletonURL(),function(){var n=o.getResult();if(n.success){e._modelRoot=n.modelRoot;for(var a=0,l=.01,c=0;c<e._modelRoot.children.length;c++){var u=e._modelRoot.children[c];u instanceof s.SkinnedMesh&&(u.material.transparent=!0,u.frustumCulled=!1,u.position.z=a,a+=l)}e._modelRoot.traverse(function(t){t instanceof s.Mesh&&(t.material.transparent=!0,t.frustumCulled=!1)});var h=new i,p=h.getModelControlFactory(r.Factory.prototype._controlType);e._textureLoader&&p.setSharedImageLoader(e._textureLoader),h.load(e._config.getEyeKinematicsURL(),function(){var o=h.getResult();if(o.success){e._modelControlGroup=o.modelControlGroup,e._modelControlGroup.attachToModel(e._modelRoot);for(var n=0;n<e._modelControlGroup.getControlList().length;n++)"TEXTURE"===e._modelControlGroup.getControlList()[n].getControlType()&&e._modelControlGroup.getControlList()[n].setDefaultNormalURL(e._config.getDefaultNormalMap());e.loadSucceeded=!0}else e.loadSucceeded=!1,e.loadMessage="kinematics load failed with message: "+o.message+", URL = "+o.url;t&&t()})}else e.loadSucceeded=!1,e.loadMessage=""+n.message+", model URL = "+n.modelUrl+", skeleton URL = "+n.skeletonUrl,t&&t()})},a.prototype.getModelRoot=function(){return this._modelRoot},a.prototype.getModelControlGroup=function(){return this._modelControlGroup},a.prototype.constructCamera=function(t){var e=new s.OrthographicCamera(-t.faceScreenWidth/2,t.faceScreenWidth/2,t.faceScreenHeight/2,-t.faceScreenHeight/2,-20,20);return e.position.set(0,0,5),e.updateMatrixWorld(!0),e},a.prototype.constructScene=function(){var t=new s.Scene;return t.add(this.getModelRoot()),t},e.exports=a},{"../ifr-geometry/loaders/ArticulatedModelLoader":58,"../ifr-motion/dofs/TextureControl":83,"../ifr-motion/loaders/KinematicsLoader":90,three:void 0}],38:[function(t,e,o){"use strict";var n=t("three"),i=t("../ifr-core/SLog"),r="RENDER_PLUGIN",s=function(t){this._name=t,this._installed_cache=null},a=function(t){this._scene=t,this._objects={}};s.prototype._getObjectForScene=function(t,e){if(null==this._installed_cache)return null;for(var o=null,n=0;n<this._installed_cache.length;n++)if(t===this._installed_cache[n]._scene){o=this._installed_cache[n];break}return null===o?null:o._objects.hasOwnProperty(e)?o._objects[e]:null},s.prototype._clearObjectForScene=function(t,e){if(null!=this._installed_cache)for(var o=0;o<this._installed_cache.length;o++)if(t===this._installed_cache[o]._scene){if(null==e)this._installed_cache.splice(o,1);else{var n=this._installed_cache[o];delete n._objects[e]}break}},s.prototype._registerObjectForScene=function(t,e,o){null==this._installed_cache&&(this._installed_cache=[]);for(var n=null,s=0;s<this._installed_cache.length;s++)if(t===this._installed_cache[s]._scene){n=this._installed_cache[s];break}null===n&&(n=new a(t),this._installed_cache.push(n)),n._objects.hasOwnProperty(e)&&i(r,'Error, RenderPlugin registering object "'+e+'" but one is already registered'),n._objects[e]=o},s.prototype._markMaterialsForUpdate=function(t){t.traverse(function(t){t instanceof n.Mesh&&null!=t.material&&(t.material.needsUpdate=!0)})},s.prototype.install=function(t,e){},s.prototype.update=function(t,e,o){},s.prototype.uninstall=function(t,e){},s.prototype.getName=function(){return this._name},e.exports=s},{"../ifr-core/SLog":52,three:void 0}],39:[function(t,e,o){"use strict";var n=function(t){this.clock=t,this.kinematicInfo=null,this.renderers=[],this.outputTime=null,this.outputPose=null};n.prototype.setKinematicInfo=function(t){this.kinematicInfo=t},n.prototype.addRenderer=function(t){this.renderers.push(t)},n.prototype.removeRenderer=function(t){var e=this.renderers.indexOf(t);e>-1&&this.renderers.splice(e,1)},n.prototype.getRenderers=function(){return this.renderers.slice(0)},n.prototype.handleOutput=function(t,e){this.outputTime=t,this.outputPose=e},n.prototype.update=function(){if(null!==this.kinematicInfo&&null!==this.outputPose){for(var t=this.outputPose,e={},o=t.getDOFNames(),n=0;n<o.length;n++){var i=t.get(o[n],0);e[o[n]]=i}for(var r=0;r<this.renderers.length;r++)this.renderers[r].display(e)}},n.prototype.dispose=function(){for(var t=0;t<this.renderers.length;t++)this.renderers[t].dispose();this.renderers=[],this.kinematicInfo=null,this.outputPose=null},e.exports=n},{}],40:[function(t,e,o){"use strict";var n=t("../geometry-info/SceneInfo"),i=t("./JiboBody"),r=t("./JiboEye"),s=t("../ifr-visualizer/BasicScene"),a=t("../ifr-geometry/loaders/CachedImageLoader"),l=t("three"),c=t("./DefaultEyeLighting"),u=t("../ifr-core/SLog"),h="MODEL_LOADING",p=function(t,e,o,n,i,r){this.robotInfo=t,this.scene=e,this.modelControlGroups=i,this.textureLoader=r,this.grid=null,this.renderedDOFs=[],this.dofLastValues=[],this.dofIsMetric=[];for(var s=0;s<this.modelControlGroups.length;s++)for(var a=this.modelControlGroups[s].getDOFNames(),l=0;l<a.length;l++){var c=a[l];this.renderedDOFs.indexOf(c)<0&&(this.renderedDOFs.push(c),this.dofLastValues.push(1/0),this.dofIsMetric.push(t.getDOFInfo(c).isMetric()))}this.dofChangeEpsilon=1e-4,this.trackDOFDirtyStatus=!1,this.renderPlugins={},this.bodyScene=o,this.eyeScene=n,this.display(this.robotInfo.getDefaultDOFValues()),null!==this.scene.getContainer()&&this.scene.play()};p.prototype.setRenderOnlyWhenDirty=function(t){this.trackDOFDirtyStatus=t,this.scene.setRenderOnlyWhenDirty(t)},p.prototype.setRenderEveryNFrames=function(t){this.scene.setRenderEveryNFrames(t)},p.prototype.display=function(t){var e=!0;if(this.trackDOFDirtyStatus){for(var o=!1,n=this.dofChangeEpsilon,i=0;i<this.renderedDOFs.length;i++){var r=t[this.renderedDOFs[i]],s=this.dofLastValues[i];r!==s&&(this.dofIsMetric[i]?Math.abs(s-r)>n&&(o=!0,this.dofLastValues[i]=r):(o=!0,this.dofLastValues[i]=r))}o?this.scene.markDirty():e=!1}if(e){var a;for(a=0;a<this.modelControlGroups.length;a++)this.modelControlGroups[a].updateFromDOFValues(t);var l=Object.keys(this.renderPlugins);for(a=0;a<l.length;a++)this.renderPlugins[l[a]].update(this.bodyScene,this.eyeScene,t)}},p.prototype.loadTexture=function(t){this.textureLoader.loadImage(t)},p.prototype.setBackgroundColor=function(t,e,o,n){n||(n=1),this.scene.getRenderer().setClearColor(new l.Color(t,e,o),n)},p.prototype.setCamera=function(t,e,o){var n=t,i=e?e:new l.Vector3,r=o?o:45;this.scene.getCamera().position.copy(n),this.scene.getTrackballControls().target.copy(i),this.scene.getCamera().fov=r,this.scene.getCamera().updateProjectionMatrix()},p.prototype.setGrid=function(t,e,o){null!==this.grid&&this.scene.getScene().remove(this.grid),this.grid=new l.GridHelper(e*t,t),this.grid.quaternion.setFromAxisAngle(new l.Vector3(1,0,0),Math.PI/2),this.grid.setColors(o,o),this.scene.getScene().add(this.grid)},p.prototype.detachFromContainer=function(){this.scene.detachFromContainer()},p.prototype.attachToContainer=function(t){null!==this.scene.getContainer()&&this.detachFromContainer(),this.scene.attachToContainer(t),null!==this.scene.getContainer()&&this.scene.play()},p.prototype.dispose=function(){null!==this.scene&&(this.scene.dispose(),this.scene=null),this.robotInfo=null,this.modelControlGroups=[],this.textureLoader=null,this.grid=null},p.prototype.removeCameraControls=function(){this.scene.removeTrackballControls()},p.prototype.installRenderPlugin=function(t){var e=t.getName();this.renderPlugins.hasOwnProperty(e)&&this.renderPlugins[e].uninstall(this.bodyScene,this.eyeScene),t.install(this.bodyScene,this.eyeScene),this.renderPlugins[e]=t},p.prototype.removeRenderPlugin=function(t){this.renderPlugins.hasOwnProperty(t)&&(this.renderPlugins[t].uninstall(this.bodyScene,this.eyeScene),delete this.renderPlugins[t])},p.prototype.getInstalledRenderPluginNames=function(){return Object.keys(this.renderPlugins)};var d={createRobotRenderer:function(t,e,o,m){var f=t.getConfig(),g=null,y=[],_=new a,v=null,T=new n;T.load(f.getSceneInfoURL(),function(){if(T.loadSucceeded){var n=new r(f);n.load(function(){if(n.loadSucceeded)if(y.push(n.getModelControlGroup()),o===d.DisplayType.EYE)g=new s(e,!1,!1,new l.Color(0,0,0)),g._camera=n.constructCamera(T),g._scene=n.constructScene(),v=new p(t,g,null,g._scene,y,_),v.installRenderPlugin(new c),m&&m(v);else{var r=new i(f);r.load(function(){if(r.loadSucceeded){y.push(r.getModelControlGroup()),g=new s(e,!1,!1,new l.Color(0,0,.3)),g.getCamera().up=new l.Vector3(0,0,1),g.installTrackballControls(),g.getDirectionalLight().intensity=.5,g.getDirectionalLight().position.set(1,-1,1);var o=new l.DirectionalLight(16777215,.5);o.position.set(1,1,1),g.getScene().add(o);var i=new l.DirectionalLight(16777215,.5);i.position.set(-1,0,1),g.getScene().add(i);var a=r.getModelRoot();g.getScene().add(a);var d=n.constructScene(),f=n.constructCamera(T),O=r.constructFaceScreenRenderTarget(T),L=new l.Color,b=new l.Color(0,0,0);g.addRenderCallback(function(){var t=g.getRenderer();L.copy(t.getClearColor()),t.setClearColor(b),t.render(d,f,O),t.setClearColor(L)}),v=new p(t,g,g._scene,d,y,_),v.setCamera(new l.Vector3(.5,0,.37),new l.Vector3(0,0,.17),45),v.installRenderPlugin(new c),m&&m(v)}else u(h,"JiboBody load error: "+r.loadMessage),m&&m(null)})}else u(h,"JiboEye load error: "+n.loadMessage),m&&m(null)})}else u(h,"SceneInfo load error: "+T.loadMessage),m&&m(null)})},getEye:function(){return null}},m={BODY:"BODY",EYE:"EYE"};d.DisplayType=m,e.exports=d},{"../geometry-info/SceneInfo":47,"../ifr-core/SLog":52,"../ifr-geometry/loaders/CachedImageLoader":59,"../ifr-visualizer/BasicScene":109,"./DefaultEyeLighting":35,"./JiboBody":36,"./JiboEye":37,three:void 0}],41:[function(t,e,o){"use strict";var n=t("../ifr-core/FileTools"),i=t("../ifr-core/SLog"),r="MODEL_LOADING",s=function a(t,e){var o={};if(null!=t)for(var n=0;n<t.length;n++)o[t[n]]=!0;this.plus=function(t){var n;n="string"==typeof t?e[t]:t;var i=this.getDOFs(),r=n.getDOFs();if(null!=n)for(var s=0;s<r.length;s++)o.hasOwnProperty(r[s])||i.push(r[s]);return new a(i,e)},this.minus=function(t){var o;o="string"==typeof t?e[t]:t;var n=[],i=this.getDOFs();if(null!=o)for(var r=0;r<i.length;r++)o.hasDOF(i[r])||n.push(i[r]);else n=i;return new a(n,e)},this.getDOFs=function(){return Object.keys(o)},this.hasDOF=function(t){return o.hasOwnProperty(t)}};s.load=function(t,e){n.loadJSON(t,function(t,o){if(null===t){var n=s.createDOFSetsFromJSON(o);e&&e(n,null)}else e&&e(null,t)})},s.createDOFSetsFromJSON=function(t){var e;"DOFSets"!==t.header.fileType&&i(r,"DOFSet doesn't know how to parse file with type "+t.header.fileType);var o=t.content.DOFSets,n=Object.keys(o),a={};for(e=0;e<n.length;e++)a[n[e]]=new s(o[n[e]],a);if(t.content.hasOwnProperty("CompoundSets")){var l=t.content.CompoundSets,c=Object.keys(l);for(e=0;e<c.length;e++){for(var u=l[c[e]],h=new s(null,a),p=0;p<u.length;p++){var d=u[p];a.hasOwnProperty(d)?h=h.plus(a[d]):i(r,"Error, compound DOFSet "+c[e]+" requested basic set "+d+" but it is not present in file")}a[c[e]]=h}}return a},e.exports=s},{"../ifr-core/FileTools":50,"../ifr-core/SLog":52}],42:[function(t,e,o){"use strict";var n=t("../ifr-motion/dofs/TranslationControl"),i={};i.verticesForDOFValues=function(t,e){for(var o=e.getKinematicInfo().getEyeControlGroup(),i={},r=o.getControlList(),s=0;s<r.length;s++){var a=r[s];a instanceof n&&(i[a._skeletonFrameName]=a.computeFromDOFValues(t))}return i},e.exports=i},{"../ifr-motion/dofs/TranslationControl":84}],43:[function(t,e,o){"use strict";var n=function(t,e,o){this.eyeScreenWidth=t,this.eyeScreenHeight=e,this.eyeScreenBillboardMeshName=o};n.prototype.getWidth=function(){return this.eyeScreenWidth},n.prototype.getHeight=function(){return this.eyeScreenHeight},n.prototype.getEyeScreenBillboardMeshName=function(){return this.eyeScreenBillboardMeshName},e.exports=n},{}],44:[function(t,e,o){"use strict";var n=function(e,o){var n=e;if(void 0===n){var i="find-root";i=t(i),n=i(__dirname)+"/res/geometry-config/"}var r=void 0!==o?o:"P1.0",s=n+r+"/",a=s+"jibo_body.geom",l=s+"jibo_body.skel",c=s+"jibo_body.kin",u=s+"jibo_joined.geom",h=s+"jibo_joined.skel",p=s+"jibo_joined.kin",d=s+"jibo_eye.geom",m=s+"jibo_eye.skel",f=s+"jibo_eye.kin",g=s+"jibo.jscene",y=s+"jibo.dofgroups",_=s+"jibo.lim",v=s+"defaultNormalMap.png";this.getRobotURL=function(){return s},this.getBodyGeometryURL=function(){return a},this.getBodySkeletonURL=function(){return l},this.getBodyKinematicsURL=function(){return c},this.getFullGeometryURL=function(){return u},this.getFullSkeletonURL=function(){return h},this.getFullKinematicsURL=function(){return p},this.getEyeGeometryURL=function(){return d},this.getEyeSkeletonURL=function(){return m},this.getEyeKinematicsURL=function(){return f},this.getSceneInfoURL=function(){return g},this.getDOFGroupsURL=function(){return y},this.getLimitsURL=function(){return _},this.getDefaultNormalMap=function(){return v}};e.exports=n},{}],45:[function(t,e,o){"use strict";var n=t("../ifr-motion/loaders/KinematicsLoader"),i=t("../ifr-motion/loaders/AnimationLoader"),r=t("../ifr-motion/loaders/LimitsLoader"),s=t("../ifr-geometry/loaders/SkeletonLoader"),a=t("./SceneInfo"),l=t("../ifr-motion/dofs/KinematicGroup"),c=t("../ifr-motion/base/InterpolatorSet"),u=t("../ifr-motion/base/SeriesAlignedAxesTargetSelector"),h=t("../ifr-motion/dofs/ModelControlGroup"),p=t("../ifr-motion/base/DOFGlobalAlignment"),d=t("./EyeScreenInfo"),m=t("../ifr-motion/base/Pose"),f=t("./DOFSet"),g=t("../ifr-core/SLog"),y="MODEL_LOADING",_=function(t){this._config=t,this._bodyControlGroup=null,this._eyeControlGroup=null,this._fullControlGroup=null,this._bodyDOFNames=[],this._eyeDOFNames=[],this._dofNames=[],this._interpolatorSet=new c,this._bodyKinematicGroup=null,this._fullKinematicGroup=null,this._defaultAnimation=null,this._defaultPose=null,this.loadSucceeded=!1,this.loadMessage="",this._eyeScreenInfo=null,this._dofSets=null,this._dofGlobalAlignment=null};_.prototype.load=function(t){var e=this,o=[],c=null,_=!1,v=null,T=null,O=null,L=function(t,e){if(o.indexOf(t)>=0)throw new Error("JiboKinematicInfo:Cannot queue 2 loads with the same identifier ("+t+")");return o.push(t),function(){var n=o.indexOf(t);-1===n?g(y,'JiboKinematicInfo:Error, callback "'+t+'" called but not currently pending.'):o.splice(n,1),e&&e.apply(this,arguments),0===o.length&&c()}};c=function(){if(_)e.loadSucceeded=!1;else{e.loadSucceeded=!0,e._dofNames=e._bodyDOFNames.concat(e._eyeDOFNames),m.hasOwnProperty("__globalSetup")&&m.__globalSetup(e._dofNames),e._bodyKinematicGroup=new l(e._bodyControlGroup.getCopy(),v);var o=e._eyeControlGroup.getControlList().concat(e._bodyControlGroup.getControlList());e._fullControlGroup=new h,e._fullControlGroup.setControlList(o),e._fullKinematicGroup=new l(e._fullControlGroup.getCopy(),T),e._defaultPose=new m("default pose",e._dofNames),e._defaultAnimation.getPoseAtTime(e._defaultAnimation.getDuration()/2,e._interpolatorSet,e._defaultPose);for(var n=0;n<e._dofNames.length;n++)if(null===e._defaultPose.get(e._dofNames[n],0)){e.loadMessage="default animation has no value for DOF: "+e._dofNames[n],e.loadSucceeded=!1;break}e._dofGlobalAlignment=new p(e._fullKinematicGroup,{middleSection_r:new u("middleSection_r",["bottomSection_r"],[1]),topSection_r:new u("topSection_r",["middleSection_r","bottomSection_r"],[1,1])});for(var i=Object.keys(O),r=0;r<i.length;r++){var s=e._fullControlGroup.getDOFInfo(i[r]);s.setLimitData(O[i[r]])}}t&&t()};var b=new n,S=L("Ensure All Loads Queued",null);b.load(e._config.getBodyKinematicsURL(),L("Body Kinematics",function(){var t=b.getResult();t.success?(e._bodyControlGroup=t.modelControlGroup,e._bodyDOFNames=e._bodyControlGroup.getDOFNames(),e._interpolatorSet.addModelControlGroup(e._bodyControlGroup)):(_=!0,e.loadMessage="body kinematics load failed with message: "+t.message+", URL = "+t.url)})),b.load(e._config.getEyeKinematicsURL(),L("Eye Kinematics",function(){var t=b.getResult();t.success?(e._eyeControlGroup=t.modelControlGroup,e._eyeDOFNames=e._eyeControlGroup.getDOFNames(),e._interpolatorSet.addModelControlGroup(e._eyeControlGroup)):(_=!0,e.loadMessage="eye kinematics load failed with message: "+t.message+", URL = "+t.url)}));var w=new s;w.load(e._config.getBodySkeletonURL(),L("Body Skeleton",function(){var t=w.getResult();t.success?v=t.skeletonRoot:(_=!0,e.loadMessage="body skeleton load failed with message: "+t.message+", URL = "+t.url)}));var D=new s;D.load(e._config.getFullSkeletonURL(),L("Full Skeleton",function(){var t=D.getResult();t.success?T=t.skeletonRoot:(_=!0,e.loadMessage="full skeleton load failed with message: "+t.message+", URL = "+t.url)}));var C=new i;C.load(e._config.getRobotURL()+"jibo_default.anim",L("Default Animation",function(){var t=C.getResult();t.success?e._defaultAnimation=t.motion:(_=!0,e.loadMessage="default animation load failed with message: "+t.message+", URL = "+t.url)}));var F=new a;F.load(e._config.getSceneInfoURL(),L("Scene Info",function(){F.loadSucceeded?e._eyeScreenInfo=new d(F.faceScreenWidth,F.faceScreenHeight,F.faceScreenMeshName):(_=!0,e.loadMessage="scene info failed with load message: "+F.loadMessage+", URL = "+e._config.getSceneInfoURL())})),f.load(e._config.getDOFGroupsURL(),L("DOF Groups",function(t,o){null!=t?e._dofSets=t:(_=!0,e.loadMessage="DOF Groups failed with load message: "+o+", URL = "+e._config.getDOFGroupsURL())}));var k=new r;k.load(e._config.getLimitsURL(),L("Limits",function(){var t=k.getResult();t.success?O=t.dofLimits:(_=!0,e.loadMessage="limits data load failed with message: "+t.message+", URL = "+t.url)})),S()},_.prototype.getBodyControlGroup=function(){return this._bodyControlGroup},_.prototype.getEyeControlGroup=function(){return this._eyeControlGroup},_.prototype.getFullControlGroup=function(){return this._fullControlGroup},_.prototype.getBodyDOFNames=function(){return this._bodyDOFNames},_.prototype.getEyeDOFNames=function(){return this._eyeDOFNames},_.prototype.getDOFNames=function(){return this._dofNames},_.prototype.getFullKinematicGroup=function(){return this._fullKinematicGroup},_.prototype.getBodyKinematicGroup=function(){return this._bodyKinematicGroup},_.prototype.getInterpolatorSet=function(){return this._interpolatorSet},_.prototype.getDefaultPose=function(){return this._defaultPose},_.prototype.getEyeScreenInfo=function(){return this._eyeScreenInfo},_.prototype.getDOFSets=function(){return this._dofSets},_.prototype.getDOFGlobalAlignment=function(){return this._dofGlobalAlignment},e.exports=_},{"../ifr-core/SLog":52,"../ifr-geometry/loaders/SkeletonLoader":61,"../ifr-motion/base/DOFGlobalAlignment":66,"../ifr-motion/base/InterpolatorSet":67,"../ifr-motion/base/Pose":73,"../ifr-motion/base/SeriesAlignedAxesTargetSelector":74,"../ifr-motion/dofs/KinematicGroup":78,"../ifr-motion/dofs/ModelControlGroup":81,"../ifr-motion/loaders/AnimationLoader":89,"../ifr-motion/loaders/KinematicsLoader":90,"../ifr-motion/loaders/LimitsLoader":91,"./DOFSet":41,"./EyeScreenInfo":43,"./SceneInfo":47}],46:[function(t,e,o){"use strict";var n=t("./JiboConfig"),i=t("./JiboKinematicInfo"),r=t("../ifr-core/SLog"),s="MODEL_LOADING",a=function(t,e){this._jiboConfig=t,this._kinematicInfo=e};a.createInfo=function(t,e){(void 0===t||null===t)&&(t=new n);var o=new i(t);o.load(function(){o.loadSucceeded?e(new a(t,o)):(r(s,"RobotInfo creation failed: "+o.loadMessage),e(null))})},a.prototype.getKinematicInfo=function(){return this._kinematicInfo},a.prototype.getConfig=function(){return this._jiboConfig},a.prototype.getBodyDOFNames=function(){return this._kinematicInfo.getBodyDOFNames()},a.prototype.getEyeDOFNames=function(){return this._kinematicInfo.getEyeDOFNames()},a.prototype.getDOFNames=function(){return this._kinematicInfo.getDOFNames()},a.prototype.getEyeScreenInfo=function(){return this._kinematicInfo.getEyeScreenInfo()},a.prototype.getDOFInfo=function(t){return this._kinematicInfo.getFullControlGroup().getDOFInfo(t)},a.prototype.getDefaultDOFValues=function(){for(var t={},e=this._kinematicInfo.getDefaultPose(),o=this.getDOFNames(),n=0;n<o.length;n++){var i=o[n];t[i]=e.get(i,0)}return t},a.prototype.getDOFSetNames=function(){return Object.keys(this._kinematicInfo.getDOFSets())},a.prototype.getDOFSet=function(t){return this._kinematicInfo.getDOFSets()[t]},e.exports=a},{"../ifr-core/SLog":52,"./JiboConfig":44,"./JiboKinematicInfo":45}],47:[function(t,e,o){"use strict";var n=t("../ifr-core/FileTools"),i=function(){this.faceScreenMeshName=null,this.faceScreenWidth=null,this.faceScreenHeight=null,this.loadURL=null,this.loadSucceeded=!1,this.loadMessage=""};i.prototype.load=function(t,e){this.loadURL=t;var o=this;n.loadJSON(t,function(t,n){null===t?(o.parseData(n),e&&e()):(o.loadSucceeded=!1,o.loadMessage=t,e&&e())})},i.prototype.parseData=function(t){return"SceneInfo"!==t.header.fileType?(this.loadSucceeded=!1,void(this.loadMessage="don't know how to handle file type: "+t.header.fileType)):(this.faceScreenMeshName=t.content.faceScreenMeshName,this.faceScreenWidth=t.content.faceScreenInternalBounds[0],this.faceScreenHeight=t.content.faceScreenInternalBounds[1],void(this.loadSucceeded=!0))},e.exports=i},{"../ifr-core/FileTools":50}],48:[function(t,e,o){"use strict";var n=t("./SLog"),i=null,r={},s=!1;r.init=function(t){null===i?i=t:n.warn("Warning, Bakery initialized multiple times!")};var a=function(t){return i},l=function(){s||(n.info("Bakery values requested by Bakery never initialized"),s=!0)};r.getFloat=function(t,e,o,n,i){var r=a(i);return null!==r?r.getFloat(t,e,o,n,i):(l(),n)},r.getBoolean=function(t,e,o){var n=a(o);return null!==n?n.getBoolean(t,e,o):(l(),e)},r.makeButton=function(t,e,o){var n=a(o);null!==n?n.makeButton(t,e,o):l()},r.showText=function(t,e,o){var n=a(o);null!==n?n.showText(t,e,o):l()},e.exports=r},{"./SLog":52}],49:[function(t,e,o){"use strict";var n=t("./Time"),i={};i.currentTime=function(){var t,e;"undefined"!=typeof window&&"undefined"!=typeof window.performance?(t=window.performance.now(),e=window.performance.timing.navigationStart):(t=0,e=Date.now());var o=Math.floor(t),i=t-o,r=o+e,s=Math.floor(r/1e3);r-=1e3*s;var a=r+i;return a=Math.round(1e3*a),1e6===a&&(a=0,s+=1),new n(s,a)},e.exports=i},{"./Time":53}],50:[function(t,e,o){"use strict";var n=t("urijs"),i={};i.loadText=function(e,o){var i=new n(e);if(i.addQuery(""+(new Date).getTime()),"undefined"!=typeof XMLHttpRequest){var r=new XMLHttpRequest;r.open("GET",i.toString(),!0),r.addEventListener("load",function(t){o&&(200===r.status||0===r.status?o(null,r.responseText):o("FileTools: XMLHttpRequest failed with status: "+r.statusText,null))},!1),r.addEventListener("error",function(t){o&&o("FileTools: XMLHttpRequest error event with status: "+r.statusText,null)},!1),r.send(null)}else if("http"===i.protocol()){var s="http";s=t(s);var a={host:i.hostname(),port:i.port()?parseInt(i.port()):80,path:i.resource(),method:"GET"},l=s.request(a,function(t){200===t.statusCode?(t.setEncoding("utf8"),t.on("data",function(t){o&&o(null,t)})):o&&o("FileTools: http request failed with status code: "+t.statusCode,null)});l.on("error",function(t){o&&o(t.message,null)}),l.end()}else if("file"===i.protocol()||""===i.protocol()){var c="fs";c=t(c),c.readFile(i.path(),"utf8",o)}else o&&o("FileTools: no XMLHttpRequest available, and no fallback support for protocol: "+i.protocol(),null)},i.loadJSON=function(t,e){i.loadText(t,function(t,o){if(e)if(t)e(t,null);else{var n=null,i=!1,r="";try{n=JSON.parse(o)}catch(s){i=!0,r=s}i?e("FileTools: JSON parse error: "+r,null):e(null,n)}})},e.exports=i},{urijs:void 0}],51:[function(t,e,o){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},i=t("./FileTools"),r=t("./SLog"),s=function(t){var e=null,o=null;if("string"==typeof t?o=t:e=t,this._dataRoot={},this._defaultScopeName="default",e&&(this._dataRoot=e),o){var n=this;i.loadJSON(o,function(t,e){
t?r.error("JSONBaker: failed to load data, url: "+o+" error: "+t):n._dataRoot=e})}};s.prototype._getScope=function(t){if(t||(t=this._defaultScopeName),t instanceof Array){for(var e=this._dataRoot,o=0;o<t.length;o++)"object"!==n(e[t[o]])&&(e[t[o]]={}),e=e[t[o]];return e}return"object"!==n(this._dataRoot[t])&&(this._dataRoot[t]={}),this._dataRoot[t]},s.prototype.getFloat=function(t,e,o,n,i){var r=this._getScope(i),s=r[t];return(void 0===s||null===s)&&(s=n,r[t]=s),s},s.prototype.getBoolean=function(t,e,o){var n=this._getScope(o),i=n[t];return(void 0===i||null===i)&&(i=e,n[t]=i),i},s.prototype.makeButton=function(t,e,o){},s.prototype.showText=function(t,e,o){},s.prototype.getData=function(){return this._dataRoot},e.exports=s},{"./FileTools":50,"./SLog":52}],52:[function(t,e,o){"use strict";var n=function(t,e){},i=function(t,e){console.log(t+" : "+e)},r=n,s={ERROR:i},a=function(t,e){s.hasOwnProperty(t)?s[t](t,e):r(t,e)};a.BaseChannels={INFO:"INFO",WARN:"WARN",ERROR:"ERROR"},a.info=function(t){a(a.BaseChannels.INFO,t)},a.warn=function(t){a(a.BaseChannels.WARN,t)},a.error=function(t){a(a.BaseChannels.ERROR,t)},a.setDefaultDelegate=function(t){r=null==t?n:t},a.setChannelDelegate=function(t,e){null==e?s[t]=n:s[t]=e},a.clearChannelDelegate=function(t){if(null==t)for(var e=Object.keys(s),o=0;o<e.length;o++)delete s[e[o]];else delete s[t]},a.setPrintChannels=function(t){if(a.setDefaultDelegate(null),a.clearChannelDelegate(null),null!=t)for(var e=0;e<t.length;e++)a.setChannelDelegate(t[e],i)},a.setPrintAll=function(){a.setDefaultDelegate(i),a.clearChannelDelegate(null)},a.setPrintNone=function(){a.setDefaultDelegate(n),a.clearChannelDelegate(null)},e.exports=a},{}],53:[function(t,e,o){"use strict";var n=function(t,e){this._timestamp=[t,e];var o=function(t){var e=t[0]===+t[0]&&t[1]===+t[1]&&t[0]>=0&&t[1]>=0&&t[1]<1e6&&t[0]===Math.round(t[0])&&t[1]===Math.round(t[1]);return e||((t[0]!==+t[0]||t[1]!==+t[1])&&console.log("InvalidTime: At least one element of timestamp is not a number"),(t[0]<0||t[1]<0)&&console.log("InvalidTime: At least one element of timestamp is negative"),t[1]>=1e6&&console.log("InvalidTime: Microseconds portion is over one second"),(t[0]!==Math.round(t[0])||t[1]!==Math.round(t[1]))&&console.log("InvalidTime: At least one element is not an integer")),e};if(!o(this._timestamp))throw new Error("new Time() given invalid time values: (INVALID "+this._timestamp[0]+", "+this._timestamp[1]+")")};n.createFromTimestamp=function(t){if(!Array.isArray(t))throw new Error("new Time() given invalid Timestamp: (INVALID: not array)");return new n(t[0],t[1])},n.prototype.subtract=function(t){var e,o,n;this.isGreaterOrEqual(t)?(e=this._timestamp,o=t._timestamp,n=1):(e=t._timestamp,o=this._timestamp,n=-1);var i=e[1]-o[1],r=e[0]-o[0];0>i&&(i+=1e6,r-=1);var s=n*(r+i/1e6);return Math.round(1e6*s)/1e6},n.prototype.add=function(t){var e,o;if(0>t){var i=Math.floor(-t),r=-t-i;if(e=this._timestamp[0]-i,o=this._timestamp[1]-1e6*r,0>o&&(o+=1e6,e-=1),0>e)throw console.log("Error, "+this.toString()+"+"+t+" is a negative timestamp! (not allowed)"),new Error("Error, "+this.toString()+"+"+t+" is a negative timestamp! (not allowed)")}else{var s=Math.floor(t),a=t-s;e=this._timestamp[0]+s,o=this._timestamp[1]+1e6*a,o>=1e6&&(o-=1e6,e+=1)}return o=Math.round(o),new n(e,o)},n.prototype.isGreater=function(t){return this._timestamp[0]>t._timestamp[0]?!0:this._timestamp[0]===t._timestamp[0]?this._timestamp[1]>t._timestamp[1]:!1},n.prototype.isGreaterOrEqual=function(t){return this._timestamp[0]>t._timestamp[0]?!0:this._timestamp[0]===t._timestamp[0]?this._timestamp[1]>=t._timestamp[1]:!1},n.prototype.equals=function(t){return this._timestamp[0]===t._timestamp[0]&&this._timestamp[1]===t._timestamp[1]},n.prototype.toString=function(){for(var t=""+this._timestamp[1];t.length<6;)t="0"+t;return this._timestamp[0]+"."+t},e.exports=n},{}],54:[function(t,e,o){"use strict";var n=function(t,e){var o=setInterval(t,e);this.stop=function(){clearInterval(o)}},i="var timerHandles = {};\nself.onmessage = function(event)\n{\n	var command = event.data.command;\n	var callbackID = event.data.callbackID;\n	var callbackInterval = event.data.callbackInterval;\n	var timerHandle = null;\n\n	if (command === 'start')\n	{\n		timerHandle = setInterval(function()\n		{\n			self.postMessage({callbackID: callbackID});\n		}, callbackInterval);\n		timerHandles[callbackID] = timerHandle;\n	}\n	else if (command === 'stop')\n	{\n		timerHandle = timerHandles[callbackID];\n		if (timerHandle !== undefined && timerHandle !== null)\n		{\n			clearInterval(timerHandle);\n		}\n	}\n};\n",r=function(){var t=new Blob([i],{type:"text/javascript"}),e=URL.createObjectURL(t),o=new Worker(e),n={},r=0;this.createTimer=function(t,e){var i=r;n[i]=t,r++,o.postMessage({command:"start",callbackID:i,callbackInterval:e});var s={};return s.stop=function(){n[i]=null,o.postMessage({command:"stop",callbackID:i})},s},o.onmessage=function(t){var e=t.data.callbackID,o=n[e];o&&o()}},s=null,a=!0,l={};l.setInterval=function(t,e){if(1e3>e&&"undefined"!=typeof Worker&&a){if(null===s)try{s=new r}catch(o){return console.log("TimerTools: Worker blobs don't seem to be allowed, falling back to standard setInterval timing."),a=!1,new n(t,e)}return s.createTimer(t,e)}return new n(t,e)},l.clearInterval=function(t){t&&t.stop()},l.WebWorkerTimerFactory=r,e.exports=l},{}],55:[function(t,e,o){"use strict";var n=t("three"),i=function(t,e,o){this.name=t||"",this.position=e||new n.Vector3,this.orientation=o||new n.Quaternion};i.prototype.setFromJson=function(t){return this.name=t.name,this.position.copy(i.vector3FromJson(t.xyzTranslation)),this.orientation.copy(i.quaternionFromJson(t.wxyzRotation)),this},i.prototype.toMatrix4=function(){return(new n.Matrix4).compose(this.position,this.orientation,new n.Vector3(1,1,1))},i.vector3FromJson=function(t){return(new n.Vector3).fromArray(t)},i.quaternionFromJson=function(t){var e=t,o=new n.Quaternion(e[1],e[2],e[3],e[0]);return o.inverse(),o},e.exports=i},{three:void 0}],56:[function(t,e,o){"use strict";var n=function(){this.name=null,this.skeletonFrameName=null,this.mesh=null,this.boneFrameNames=null,this.bones=null};e.exports=n},{}],57:[function(t,e,o){"use strict";var n=t("three"),i={};i.convertDirectionLocalToWorld=function(){var t=null;return function(e,o,i){return null===t&&(t=new n.Quaternion),(void 0===i||null===i)&&(i=new n.Vector3),e.getWorldQuaternion(t),i.copy(o).applyQuaternion(t)}}(),i.findOrthogonal=function(t,e){(void 0===e||null===e)&&(e=new n.Vector3);var o=Math.abs(t.x),i=Math.abs(t.y),r=Math.abs(t.z);return o>=i&&o>=r?e.set(t.y,-t.x,0):e.set(0,t.z,-t.y),e},i.quatFromAxisAngle=function(){var t=null;return function(e,o,i){return null===t&&(t=new n.Vector3),null===i&&(i=new n.Quaternion),t.copy(e).normalize(),i.setFromAxisAngle(t,o)}}(),i.toString=function(t){return"("+t.x+", "+t.y+", "+t.z+")"},e.exports=i},{three:void 0}],58:[function(t,e,o){"use strict";var n=t("./ModelLoader"),i=t("./SkeletonLoader"),r=t("three"),s=function(){this.modelUrl=null,this.skeletonUrl=null,this.success=!1,this.message="",this.modelResult=null,this.skeletonResult=null,this.modelRoot=null},a=function(t,e){this.modelLoader=t||new n,this.skeletonLoader=e||new i,this._result=null};a.prototype.getResult=function(){return this._result},a.prototype.load=function(t,e,o,n){if(o){var i=this;this.skeletonLoader.load(o,function(){var r=i.skeletonLoader.getResult();if(r.success)i._loadModel(t,e,r,n);else{var a=new s;a.modelUrl=e,a.skeletonUrl=o,a.skeletonResult=r,a.success=!1,a.message="skeleton load failed with message: "+r.message,i._result=a,n()}})}else this._loadModel(t,e,null,n)},a.prototype._loadModel=function(t,e,o,n){var i=this;this.modelLoader.load(e,function(){i._result=new s,i._result.modelUrl=e,i._result.skeletonUrl=o?o.url:null,i._result.skeletonResult=o;var a=i.modelLoader.getResult();if(i._result.modelResult=a,!a.success)return i._result.success=!1,i._result.message="model load failed with message: "+a.message,void n();var l=new r.Object3D;l.name=t||"";var c;if(o){var u=o.skeletonRoot;for(l.add(u),c=0;c<a.meshes.length;c++){var h=a.meshes[c];if(h.bones){for(var p=0;p<h.bones.length;p++){var d=u.getObjectByName(h.boneFrameNames[p],!0);if(!d)return i._result.success=!1,i._result.message="unable to find skeleton frame: "+h.boneFrameNames[p]+" required to attach bone "+p+" of mesh: "+h.name,void n();d.add(h.bones[p])}h.mesh.material.skinning=!0,l.add(h.mesh)}else{if(!h.skeletonFrameName)return i._result.success=!1,i._result.message="unable to attach mesh: "+h.name+" - no skeleton frame or skinning data specified",void n();var m=u.getObjectByName(h.skeletonFrameName,!0);if(!m)return i._result.success=!1,i._result.message="unable to find skeleton frame: "+h.skeletonFrameName+" required to attach mesh: "+h.name,void n();m.add(h.mesh)}}}else for(c=0;c<a.meshes.length;c++)l.add(a.meshes[c].mesh);i._result.success=!0,i._result.modelRoot=l,n()})},e.exports=a},{"./ModelLoader":60,"./SkeletonLoader":61,three:void 0}],59:[function(t,e,o){"use strict";var n=t("three"),i=function(){this.url=null,this.success=!1,this.image=null},r=function(){this._loader=new n.ImageLoader,this._result=null};r.prototype.getResult=function(){return this._result},r.prototype.loadImage=function(t,e){var o=this;this._loader.load(t,function(n){var r=new i;r.url=t,r.success=!0,r.image=n,o._result=r,e&&e()},void 0,function(n){var r=new i;r.url=t,r.success=!1,o._result=r,e&&e()})},e.exports=r},{three:void 0}],60:[function(t,e,o){"use strict";var n=t("../BasicMesh"),i=t("../BasicFrame"),r=t("../../ifr-core/FileTools"),s=t("three"),a=function(){this.url=null,this.success=!1,this.message="",this.meshes=null},l=function(t){this.defaultMaterial=t,this.defaultMaterial||(this.defaultMaterial=new s.MeshPhongMaterial),this.baseTextureURL=null,this._result=null};l.prototype.getResult=function(){return this._result},l.prototype.load=function(t,e){var o=this;r.loadJSON(t,function(n,i){if(null===n)o.parseData(i,t),e&&e();else{var r=new a;r.url=t,r.success=!1,r.message=n,o._result=r,e&&e()}})},l.prototype.parseData=function(t,e){if(this._result=new a,this._result.url=e,"Meshes"!==t.header.fileType)return this._result.success=!1,void(this._result.message="don't know how to handle file type: "+t.header.fileType);var o=e.substring(0,e.lastIndexOf("/")+1);this._result.meshes=[];for(var r=0;r<t.content.meshes.length;r++){var l=t.content.meshes[r],c=new n;c.name=l.name,c.skeletonFrameName=l.skeletonFrameName;var u=new s.BufferGeometry,h=new Float32Array(l.position);if(u.addAttribute("position",new s.BufferAttribute(h,3)),l.normal){var p=new Float32Array(l.normal);u.addAttribute("normal",new s.BufferAttribute(p,3))}if(l.textureCoordinates){var d=new Float32Array(l.textureCoordinates);u.addAttribute("uv",new s.BufferAttribute(d,2))}if(l.triangles){var m=new Uint32Array(l.triangles);u.addAttribute("index",new s.BufferAttribute(m,3))}if(l.color){for(var f=new Float32Array(l.color.length/4*3),g=0;g<l.color.length/4;g++)f[3*g]=l.color[4*g],f[3*g+1]=l.color[4*g+1],f[3*g+2]=l.color[4*g+2];u.addAttribute("color",new s.BufferAttribute(f,3))}var y=this.defaultMaterial.clone();if(y.vertexColors=l.color?s.VertexColors:s.NoColors,l.material){var _=l.material;if(_.ambient&&(y.ambient=new s.Color(_.ambient[0],_.ambient[1],_.ambient[2])),_.diffuse&&(y.color=new s.Color(_.diffuse[0],_.diffuse[1],_.diffuse[2])),_.specular&&(y.specular=new s.Color(_.specular[0],_.specular[1],_.specular[2])),_.emissive&&(y.emissive=new s.Color(_.emissive[0],_.emissive[1],_.emissive[2])),_.shininess&&(y.shininess=_.shininess),_.texture){var v=this.baseTextureURL?this.baseTextureURL+_.texture:o+_.texture,T=s.ImageUtils.loadTexture(v);T.minFilter=s.LinearFilter,y.map=T}}if(l.skin){c.mesh=new s.SkinnedMesh(u,y),c.mesh.name=l.name;var O=l.skin;c.boneFrameNames=O.skeletonTotalInfluences;var L=c.boneFrameNames.length,b=(new i).setFromJson(O.skinBindFrame),S=b.toMatrix4();c.bones=[];for(var w=[],D=0;L>D;D++){var C=(new i).setFromJson(O.skinBindInverses[D]);w.push(C.toMatrix4());var F=new s.Bone(c.mesh);c.bones.push(F)}var k=new s.Skeleton(c.bones,w,!1);c.mesh.bindMode="detached",c.mesh.bind(k,S);var P=h.length/3,E=new Float32Array(O.skeletonWeightsByVertex),N=new Float32Array(O.skeletonInfluencesByVertex);if(E.length!==4*P)return this._result.success=!1,void(this._result.message="expected "+4*P+" skeleton weights for mesh "+c.name+", but got: "+E.length);if(N.length!==4*P)return this._result.success=!1,void(this._result.message="expected "+4*P+" skeleton influences for mesh "+c.name+", but got: "+N.length);u.addAttribute("skinWeight",new s.BufferAttribute(E,4)),u.addAttribute("skinIndex",new s.BufferAttribute(N,4))}else c.mesh=new s.Mesh(u,y),c.mesh.name=l.name;this._result.meshes.push(c)}this._result.success=!0},e.exports=l},{"../../ifr-core/FileTools":50,"../BasicFrame":55,"../BasicMesh":56,three:void 0}],61:[function(t,e,o){"use strict";var n=t("../BasicFrame"),i=t("../../ifr-core/FileTools"),r=t("three"),s=function(){this.url=null,this.success=!1,this.message="",this.skeletonRoot=null},a=function(){this._result=null};a.prototype.getResult=function(){return this._result},a.prototype.load=function(t,e){var o=this;i.loadJSON(t,function(n,i){if(null===n)o.parseData(i,t),e&&e();else{var r=new s;r.url=t,r.success=!1,r.message=n,o._result=r,e&&e()}})},a.prototype.parseData=function(t,e){return this._result=new s,this._result.url=e,"Skeleton"!==t.header.fileType?(this._result.success=!1,void(this._result.message="don't know how to handle file type: "+t.header.fileType)):(this._result.skeletonRoot=this._parseSkeleton(t.content),void(this._result.success=!0))},a.prototype._parseSkeleton=function(t){var e=new r.Object3D,o=(new n).setFromJson(t);if(e.name=o.name,e.position.copy(o.position),e.quaternion.copy(o.orientation),t.children)for(var i=0;i<t.children.length;i++)e.add(this._parseSkeleton(t.children[i]));return e},e.exports=a},{"../../ifr-core/FileTools":50,"../BasicFrame":55,three:void 0}],62:[function(t,e,o){"use strict";var n=t("../../ifr-core/SLog"),i="ACCEL_PLANNER",r=function(t,e,o,n,i,r,s){this._initialVelocity=t,this._targetVelocity=e,this._acceleration=o,this._accelerateTime=n,this._decelerateTime=i,this._totalTime=r,this._distance=s};r.prototype.displacementAtTime=function(t){var e=0;if(t>0){var o=Math.min(t,this._accelerateTime);e+=(this._initialVelocity+this._acceleration*o/2)*o,t-=o}if(t>0){var n=Math.min(t,this._decelerateTime);e+=(this._initialVelocity+this._acceleration*this._accelerateTime-this._acceleration*n/2)*n,t-=n}return t>0&&(e+=this._targetVelocity*t),e},r.prototype.velocityAtTime=function(t){var e=this._initialVelocity;if(t>0){var o=Math.min(t,this._accelerateTime);e+=this._acceleration*o,t-=o}if(t>0){var n=Math.min(t,this._decelerateTime);e-=this._acceleration*n,t-=n}return e},r.prototype.isConsistent=function(){if(isNaN(this._accelerateTime)||isNaN(this._decelerateTime))return n(i,"Plan has NaN times! accelerationTime:"+this._accelerateTime+" decelerationTime:"+this._decelerateTime),!1;if(!isFinite(this._accelerateTime)||!isFinite(this._decelerateTime))return n(i,"Plan has non-finite times! accelerationTime:"+this._accelerateTime+" decelerationTime:"+this._decelerateTime),!1;if(isNaN(this._acceleration))return n(i,"Plan has NaN acceleration!: "+this._acceleration),!1;if(!isFinite(this._acceleration))return n(i,"Plan has non-finite acceleration!: "+this._acceleration),!1;var t=this._accelerateTime+this._decelerateTime,e=this._distance+this._targetVelocity*t,o=(this._initialVelocity+this._acceleration*this._accelerateTime/2)*this._accelerateTime+(this._initialVelocity+this._acceleration*this._accelerateTime-this._acceleration*this._decelerateTime/2)*this._decelerateTime,r=this._initialVelocity+this._acceleration*this._accelerateTime-this._acceleration*this._decelerateTime;return this._accelerateTime<0||this._decelerateTime<0?(n(i,"Plan has negative times! accelerationTime:"+this._accelerateTime+" decelerationTime:"+this._decelerateTime),!1):Math.abs(this._accelerateTime+this._decelerateTime-this._totalTime)>1e-7?(n(i,"Plan time segments are not equal to target time! segments:"+(this._accelerateTime+this._decelerateTime)+" target:"+this._totalTime),!1):Math.abs(o-e)>1e-6?(n(i,"Plan has incorrect integral! ourDisplacement:"+o+" pDelta:"+e),!1):Math.abs(r-this._targetVelocity)>1e-7?(n(i,"Plan has incorrect final velocity resultV:"+r+" pDelta:"+this._targetVelocity),!1):!0},r.prototype.getTotalTime=function(){return this._totalTime};var s=function(){};s.prototype.computeWithFixedTime=function(t,e,o,s){if(1e-10>s)return n(i,"Asked for fixed time plan with time of "+s+", returning null"),null;var a,l,c=(e-t)*s/2+o,u=Math.pow((t-e)*s/2-o,2)-Math.pow(s,2)*(e*t/2-Math.pow(t,2)/4-Math.pow(e,2)/4);if(0>u){if(!(u>-1e-10))return n(i,"Inconsistent CWFT Plan for vCurrent:"+t+", vTarget:"+e+", pDelta:"+o+", totalTime:"+s+", tsqrt:"+u),null;u=0}var h=Math.sqrt(u),p=Math.pow(s,2)/2,d=1;.5*s*(t-e)>o&&(d=-1);var m=(c+d*h)/p;if(0===m?(a=s,l=0):Math.abs(m)<1e-10?(m=0,a=s,l=0):(a=s/2+(e-t)/(2*m),l=s/2+(t-e)/(2*m)),0>a){if(!(a>-1e-10))return n(i,"Inconsistent CWFTaT1 Plan for vCurrent:"+t+", vTarget:"+e+", pDelta:"+o+", totalTime:"+s+", aChoiceT1:"+a),null;a=0}if(0>l){if(!(l>-1e-10))return n(i,"Inconsistent CWFTaT2 Plan for vCurrent:"+t+", vTarget:"+e+", pDelta:"+o+", totalTime:"+s+", aChoiceT2:"+l),null;l=0}var f=new r(t,e,m,a,l,s,o);return f},s.prototype.computeWithFixedAccel=function(t,e,o,s){if(1e-10>s)return n(i,"Asked for fixed acceleration plan with acceleration of "+s+", returning null"),null;var a=s,l=1;(t-e)*Math.abs(e-t)/(2*s)>o&&(a=-s,l=-1);var c=2*e-2*t,u=2*Math.pow(t-e,2)+4*a*o;if(0>u){if(!(u>-1e-10))return n(i,"Inconsistent CWFA Plan for vCurrent:"+t+", vTarget:"+e+", pDelta:"+o+", acceleration:"+s+", tsqrt:"+u),null;u=0}var h=Math.sqrt(u),p=2*a,d=(c+l*h)/p,m=t/a+d-e/a;if(0>d){if(!(d>-1e-10))return n(i,"Inconsistent CWFAt1 Plan for vCurrent:"+t+", vTarget:"+e+", pDelta:"+o+", acceleration:"+s+", t1Choice:"+d),null;d=0}if(0>m){if(!(m>-1e-10))return n(i,"Inconsistent CWFAt2 Plan for vCurrent:"+t+", vTarget:"+e+", pDelta:"+o+", acceleration:"+s+", t2Choice:"+m),null;m=0}return new r(t,e,a,d,m,d+m,o)},s.prototype.computeWithZeroAccel=function(t){var e=new r(t,t,0,1,0,1,0);return e},s.prototype.computeWithMaxAccel=function(t,e,o,n,i){if(1e-6>n)return this.computeWithZeroAccel(t);var r=this.computeWithFixedTime(t,e,o,i);if(Math.abs(r._acceleration)<=n)return r;var s=this.computeWithFixedAccel(t,e,o,n);return s},e.exports=s},{"../../ifr-core/SLog":52}],63:[function(t,e,o){"use strict";var n=t("./Motion"),i=t("./MotionEvent"),r=function(t,e){var o={};o.motion=t,e=e||[],o.events=e,o.speed=1,o.inPoint=0,o.outPoint=t.getDuration(),this.getMotion=function(){return o.motion},this.getEventCount=function(){return o.events.length},this.getEvent=function(t){return o.events[t]},this.getEvents=function(){return o.events},this.setClipBounds=function(t,e){null!==t&&void 0!==t?o.inPoint=t:o.inPoint=0,null!==e&&void 0!==e?o.outPoint=e:o.outPoint=this.getSourceMotionDuration()},this.getSourceMotionDuration=function(){return t.getDuration()},this.getDuration=function(){var t=o.outPoint-o.inPoint;return t/o.speed},this.getSpeed=function(){return o.speed},this.setSpeed=function(r){if(0>=r)throw new Error("invalid speed: "+r);if(r!==o.speed)if(o.speed=r,1===o.speed)o.motion=t,o.events=e;else{for(var s=new n(t.getName()),a=Object.keys(t.getTracks()),l=0;l<a.length;l++){for(var c=t.getTracks()[a[l]].clone(),u=c.getMotionData().timestampList,h=0;h<u.length;h++)u[h]=u[h]/r;c.length=c.length/r,s.addTrack(c)}o.motion=s;for(var p=[],d=0;d<e.length;d++){var m=e[d].getTimestamp()/r,f=e[d].getEventName(),g=e[d].getPayload();p.push(new i(m,f,g))}o.events=p}}};e.exports=r},{"./Motion":69,"./MotionEvent":70}],64:[function(t,e,o){"use strict";var n=t("./CyclicMath"),i=function(t){this._dofName=t};i.prototype.closestEquivalentRotation=function(t,e){return n.closestEquivalentRotation(e.get(this._dofName,0),t.get(this._dofName,0))},i.prototype.getDOFName=function(){return this._dofName},e.exports=i},{"./CyclicMath":65}],65:[function(t,e,o){"use strict";var n=function(){};n.closestEquivalentRotation=function(t,e){var o=e-t,n=Math.floor((o+Math.PI)/(2*Math.PI)),i=t+n*Math.PI*2;return i},e.exports=n},{}],66:[function(t,e,o){"use strict";var n=t("./CyclicDOFTargetSelector"),i=function(t,e){var o,i={},r={},s=t.getDOFNames(),a={},l=function(t,e){var o=a[t],n=a[e];return null!=o&&null!=n?o-n:0};for(o=0;o<s.length;o++){var c=0,u=t.getModelControlGroup().getControlForDOF(s[o]);if(null!=u&&("ROTATION"===u.getControlType()||"TRANSLATION"===u.getControlType())){var h=u.getTransformName(),p=t.getTransform(h);if(null!=p)for(;null!=p.parent;)c++,p=p.parent}a[s[o]]=c}for(o=0;o<s.length;o++){var d=s[o];t.getModelControlGroup().getDOFInfo(d).isCyclic()&&(e&&e.hasOwnProperty(d)?i[d]=e[d]:i[d]=new n(d),r[d]=new n(d))}this.sortDOFsByDepth=function(t){return t.sort(l)},this.getGlobalTargetSelector=function(t){return i[t]},this.getLocalTargetSelector=function(t){return r[t]},this.refineToGloballyClosestTargetPose=function(t,e,o){null==o&&(o=t.getDOFNames());for(var n=this.sortDOFsByDepth(o.slice(0)),i=0;i<n.length;i++){var r=this.getGlobalTargetSelector(n[i]);if(r){var s=r.closestEquivalentRotation(t,e);e.set(n[i],s,0)}}},this.refineToLocallyClosestTargetPose=function(t,e,o){null==o&&(o=t.getDOFNames());for(var n=0;n<o.length;n++){var i=this.getLocalTargetSelector(o[n]);if(i){var r=i.closestEquivalentRotation(t,e);e.set(o[n],r,0)}}}};e.exports=i},{"./CyclicDOFTargetSelector":64}],67:[function(t,e,o){"use strict";var n=t("./Interpolators"),i=t("../dofs/TextureControl"),r=function(){this.interpolatorSet={}};r.prototype.addInterpolator=function(t,e){this.interpolatorSet[t]=e},r.prototype.getInterpolator=function(t){var e=this.interpolatorSet[t];return void 0!==e?e:null},r.prototype.addModelControlGroup=function(t){for(var e=t.getControlList(),o=0;o<e.length;o++)for(var r=e[o],s=r.getDOFNames(),a=0;a<s.length;a++)r instanceof i?this.addInterpolator(s[a],new n.DOFSampleInterpolator(new n.StepInterpolator)):this.addInterpolator(s[a],new n.DOFSampleInterpolator(new n.LinearInterpolator))},e.exports=r},{"../dofs/TextureControl":83,"./Interpolators":68}],68:[function(t,e,o){"use strict";var n={};n.BaseInterpolator=function(){},n.BaseInterpolator.prototype.interpolate=function(t,e,o){return t},n.StepInterpolator=function(t){n.BaseInterpolator.call(this),this.alphaThreshold=void 0!==t?t:1},n.StepInterpolator.prototype=Object.create(n.BaseInterpolator.prototype),n.StepInterpolator.prototype.constructor=n.StepInterpolator,n.StepInterpolator.prototype.interpolate=function(t,e,o){return o<this.alphaThreshold?t:e},n.LinearInterpolator=function(){n.BaseInterpolator.call(this)},n.LinearInterpolator.prototype=Object.create(n.BaseInterpolator.prototype),n.LinearInterpolator.prototype.constructor=n.LinearInterpolator,n.LinearInterpolator.prototype.interpolate=function(t,e,o){return(1-o)*t+o*e},n.DOFSampleInterpolator=function(t,e){n.BaseInterpolator.call(this),this.positionInterpolator=t,this.derivativeInterpolator=void 0!==e?e:new n.LinearInterpolator},n.DOFSampleInterpolator.prototype=Object.create(n.BaseInterpolator.prototype),n.DOFSampleInterpolator.prototype.constructor=n.DOFSampleInterpolator,n.DOFSampleInterpolator.prototype.interpolate=function(t,e,o){t instanceof Array||(t=[t]),e instanceof Array||(e=[e]);for(var n=[],i=Math.min(t.length,e.length),r=0;i>r;r++)0===r?n.push(this.positionInterpolator.interpolate(t[r],e[r],o)):n.push(this.derivativeInterpolator.interpolate(t[r],e[r],o));return n},e.exports=n},{}],69:[function(t,e,o){"use strict";var n=t("./Pose"),i=t("./MotionTrack"),r=t("./TimestampedBuffer"),s=function(t){this.name=t,this.length=0,this.tracks={}};s.prototype.getName=function(){return this.name},s.prototype.getDuration=function(){return this.length},s.prototype.getTracks=function(){return this.tracks},s.prototype.addTrack=function(t){this.tracks[t.getName()]=t,t.getLength()>this.length&&(this.length=t.getLength())},s.prototype.getPoseAtTime=function(t,e,o){if((void 0===o||null===o)&&(o=new n(this.getName()+" pose sample",Object.keys(this.tracks))),"number"!=typeof t)throw new Error("getPoseAtTime expects time as a number value in seconds");for(var i=o.getDOFNames(),r=0;r<i.length;r++){var s=i[r];if(this.tracks.hasOwnProperty(s)){var a=e.getInterpolator(s);if(null===a)throw new Error("no interpolator provided for DOF name: "+s);var l=this.tracks[s].getDataAtTime(t,a);null!==l&&o.set(s,l)}}return o},s.createFromPose=function(t,e,o,n){var a=new s(t);null==n&&(n=e.getDOFNames());for(var l=0;l<n.length;l++){var c=n[l],u=e.get(c),h=new r;h.append(0,u),a.addTrack(new i(c,h,o))}return a},s.createFromPoses=function(t,e,o,n,a){var l=new s(t);null==a&&(a=e[0].getDOFNames());for(var c=0;c<a.length;c++){for(var u=a[c],h=new r,p=0;p<o.length;p++){var d=e[p].get(u);h.append(o[p],d)}l.addTrack(new i(u,h,n))}return l},e.exports=s},{"./MotionTrack":71,"./Pose":73,"./TimestampedBuffer":75}],70:[function(t,e,o){"use strict";var n=function(t,e,o){this.getTimestamp=function(){return t},this.getEventName=function(){return e},this.getPayload=function(){return o}};e.exports=n},{}],71:[function(t,e,o){"use strict";var n=function(t,e,o){this.name=t,this.motionData=e,this.length=o};n.prototype.clone=function(){return new n(this.name,this.motionData.clone(),this.length)},n.prototype.getName=function(){return this.name},n.prototype.getLength=function(){return this.length},n.prototype.getMotionData=function(){return this.motionData},n.prototype.getDataAtTime=function(t,e){if(0===this.motionData.size())return null;var o=this.motionData.getLeftIndexForTime(t),n=o+1;o=Math.max(o,0),n=Math.min(n,this.motionData.size()-1);var i,r=this.motionData.getTimestamp(o),s=this.motionData.getTimestamp(n);i=r===s?0:(t-r)/(s-r);var a=this.motionData.getData(o),l=this.motionData.getData(n);return e.interpolate(a,l,i)},e.exports=n},{}],72:[function(t,e,o){"use strict";t("./Motion"),t("./MotionTrack");var n={};n.valuesExist=function(t,e){var o,n=t.getTracks();o=null==e?Object.keys(n):e;for(var i=0;i<o.length;i++){var r=n[o[i]].getMotionData();if(null==r)throw new Error("Error, motion ("+t.getName()+") has null/undefined track ("+o[i]+").");for(var s=0;s<r.size();s++){var a=r.getData(s);if(null==a||Array.isArray(a)&&a.length<1)throw new Error("Error, motion ("+t.getName()+") has null/undefined/empty keys ("+o[i]+").")}}},e.exports=n},{"./Motion":69,"./MotionTrack":71}],73:[function(t,e,o){"use strict";var n=null,i=null,r=null,s=function(t){r=t.length,n=new Array(r),i=new Array(r);for(var e=0;r>e;e++)n[t[e]]=e,i[e]=t[e]},a=function(t,e){var o;if(null!==t.dofNames)throw new Error("Cannot re-setup pose with new dofnames!");if(null===n)throw new Error("Pose used before __globalSetup!");for(t.dofNames=e,t.dofIndices=new Array(e.length),t.dofPresent=new Array(r),t.dofVals=new Array(r),o=0;r>o;o++)t.dofPresent[o]=!1;for(var i=0;i<e.length;i++){if(o=n[e[i]],"undefined"==typeof o)throw new Error("Cannot use DOF "+e[i]+", not in dofset!");t.dofIndices[i]=o,t.dofPresent[o]=!0,t.dofVals[o]=[]}},l=function(t,e){this.name=t,this.dofNames=null,this.dofIndices=null,this.dofPresent=null,this.dofVals=null,void 0!==e&&a(this,e)};l.prototype.setPose=function(t){null===this.dofNames&&a(this,t.dofNames);for(var e=0;e<this.dofIndices.length;e++){var o=this.dofIndices[e];if(t.dofPresent[o]){for(var n=t.dofVals[o],i=this.dofVals[o],r=0;r<n.length;r++)i[r]=n[r];i.length=n.length}}},l.prototype.getPose=function(t){t.setPose(this)},l.prototype.set=function(t,e,o){var i=n[t];this.dofPresent[i]&&("undefined"!=typeof o?this.dofVals[i][o]=e:this.dofVals[i]=e)},l.prototype.get=function(t,e){var o=n[t];if(this.dofPresent[o]){var i;return i=void 0!==e?this.dofVals[o][e]:this.dofVals[o],void 0!==i?i:null}return null},l.prototype.getName=function(){return this.name},l.prototype.getDOFNames=function(){return this.dofNames},l.prototype.clear=function(){if(null!==this.dofNames)for(var t=0;t<this.dofIndices.length;t++)this.dofVals[this.dofIndices[t]].length=0},l.prototype.getCopy=function(t){for(var e=new l(null!=t?t:this.name),o=this.dofNames,n=this.dofIndices,i=this.dofPresent,s=o.length,a=new Array(s),c=new Array(s),u=new Array(r),h=0;s>h;h++)a[h]=o[h],c[h]=n[h];for(var p=0;r>p;p++)u[p]=i[p];e.dofNames=a,e.dofIndices=c,e.dofPresent=u,e.dofVals=new Array(s);for(var d=0;s>d;d++){for(var m=n[d],f=this.dofVals[m],g=new Array(f.length),y=0;y<f.length;y++)g[y]=f[y];e.dofVals[m]=g}return e},l.computeBinary=function(t,e,o,n,s){var c,u;if(null==s||null==s.dofNames){null==s&&(s=new l(t.getName()+" x "+e.getName()));var h=[];for(u=0;r>u;u++)t.dofPresent[u]&&e.dofPresent[u]&&h.push(i[u]);a(s,h)}for(c=0;c<s.dofIndices.length;c++)u=s.dofIndices[c],t.dofPresent[u]&&e.dofPresent[u]?s.dofVals[u]=o(s.dofNames[c],t.dofVals[u],e.dofVals[u]):n&&(s.dofVals[u].length=0);return s},l.computeUnary=function(t,e,o,n){var i,r;for((null==n||null==n.dofNames)&&(null==n?n=new l(t.getName(),t.dofNames):a(n,t.dofNames)),i=0;i<n.dofIndices.length;i++)r=n.dofIndices[i],t.dofPresent[r]?n.dofVals[r]=e(n.dofNames[i],t.dofVals[r]):o&&(n.dofVals[r].length=0);return n},l._subtractOperator=function(t,e,o){var n=[],i=e.length>0?e[0]:0,r=o.length>0?o[0]:0;n[0]=i-r;for(var s=1;s<e.length&&s<o.length;)n.push(e[s]-o[s]),s++;return n},l._additionOperator=function(t,e,o){var n=[],i=e.length>0?e[0]:0,r=o.length>0?o[0]:0;n[0]=i+r;for(var s=1;s<e.length&&s<o.length;)n.push(e[s]+o[s]),s++;return n},l._advanceByVelocityOperator=function(t,e,o){var n=[];if(e.length>0){null==o&&(o=1);var i=0;e.length>=2&&(i=e[1]),n[0]=i*o+e[0];for(var r=1;r<e.length;r++)n.push(e[r])}return n},l.subtract=function(t,e,o,n){return l.computeBinary(t,e,l._subtractOperator,o,n)},l.add=function(t,e,o,n){return l.computeBinary(t,e,l._additionOperator,o,n)},l.advanceByTime=function(t,e,o,n){return null==n?l.computeUnary(t,l._advanceByVelocityOperator,e,o):l.computeUnary(t,function(t,e){return l._advanceByVelocityOperator(t,e,n)},e,o)},l.prototype.toString=function(){for(var t="Pose{",e=0;e<this.dofNames.length;e++)t+=this.dofNames[e]+":["+this.dofVals[this.dofIndices[e]].toString()+"]",e<this.dofNames.length-1&&(t+=",");return t+"}"},l.__globalSetup=s,e.exports=l},{}],74:[function(t,e,o){"use strict";var n=t("./CyclicDOFTargetSelector"),i=t("./CyclicMath"),r=function(t,e,o){n.call(this,t),this._alignedParents=e,this._parentDirections=o};r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.closestEquivalentRotation=function(t,e){for(var o=0,n=0;n<this._alignedParents.length;n++){var r=t.get(this._alignedParents[n],0),s=e.get(this._alignedParents[n],0),a=s-r;o+=this._parentDirections[n]*a}var l=e.get(this.getDOFName(),0),c=t.get(this.getDOFName(),0),u=c-o;return i.closestEquivalentRotation(l,u)},e.exports=r},{"./CyclicDOFTargetSelector":64,"./CyclicMath":65}],75:[function(t,e,o){"use strict";var n=function(){this.timestampList=[],this.dataList=[],this._lastReturnedLeftIndex=0};n.prototype.clone=function(){var t=new n;return t.timestampList=this.timestampList.slice(0),t.dataList=this.dataList.slice(0),t._lastReturnedLeftIndex=this._lastReturnedLeftIndex,t},n.prototype.size=function(){return this.timestampList.length},n.prototype.getStartTime=function(){return this.timestampList[0]},n.prototype.getEndTime=function(){return this.timestampList[this.timestampList.length-1]},n.prototype.append=function(t,e){if(this.size()>0&&t<this.getEndTime())throw new Error("new timestamp "+t+" is out of sequence with previous timestamp "+this.getEndTime());this.timestampList.push(t),this.dataList.push(e)},n.prototype.getTimestamp=function(t){return this.timestampList[t]},n.prototype.getData=function(t){return this.dataList[t]},n.prototype.remove=function(t){return this.timestampList.splice(t,1),this.dataList.splice(t,1)[0]},n.prototype.getDataForTime=function(t){var e=this.getLeftIndexForTime(t);return e>-1?this.dataList[e]:null},n.prototype.getDataForRange=function(t,e,o,n){for(var i=null,r=this.getLeftIndexForTime(t),s=this.getLeftIndexForTime(o)+1,a=r;s>=a;a++)if(a>=0&&a<this.size()){
var l=this.getTimestamp(a),c=l>t||l===t&&e,u=o>l||l===o&&n;c&&u&&(null===i&&(i=[]),i.push(this.getData(a)))}return i},n.prototype.insert=function(t,e){var o=this.getLeftIndexForTime(t);if(o>=0&&this.timestampList[o]===t)this.dataList[o]=e;else{var n=o+1;this.timestampList.splice(n,0,t),this.dataList.splice(n,0,e)}},n.prototype.getLeftIndexForTime=function(t){if(0===this.size()||t<this.getStartTime())return-1;if(t>=this.getEndTime())return this.size()-1;if(this._lastReturnedLeftIndex<this.size()-1&&this.timestampList[this._lastReturnedLeftIndex]<=t&&this.timestampList[this._lastReturnedLeftIndex+1]>t)return this._lastReturnedLeftIndex;if(this._lastReturnedLeftIndex++,this._lastReturnedLeftIndex<this.size()-1&&this.timestampList[this._lastReturnedLeftIndex]<=t&&this.timestampList[this._lastReturnedLeftIndex+1]>t)return this._lastReturnedLeftIndex;for(var e,o=0,n=this.size()-1;n!==o+1;)e=Math.floor((o+n)/2),this.timestampList[e]<=t?o=e:n=e;return this._lastReturnedLeftIndex=o,o},e.exports=n},{}],76:[function(t,e,o){"use strict";function n(t,e,o){for(var n=0;n<this._meshes.length;n++)this._billboardMode?this._meshes[n].material.emissive.setRGB(t,e,o):this._meshes[n].material.color.setRGB(t,e,o)}var i=t("./ModelControl"),r=t("./ModelControlFactory"),s=t("three"),a=function(){i.call(this),this._meshNames=null,this._ledNames=null,this._meshes=[],this._billboardMode=!0};a.prototype=Object.create(i.prototype),a.prototype.constructor=a,a.prototype._controlType="COLOR",a.prototype.setFromJson=function(t){i.prototype.setFromJson.call(this,t),this._dofNames.push(t.redDOFName),this._dofNames.push(t.greenDOFName),this._dofNames.push(t.blueDOFName),this._meshNames=t.meshNames,t.ledNames&&(this._ledNames=t.ledNames)},a.prototype.attachToModel=function(t){if(this._meshes.length=0,null==t)return!1;for(var e=0;e<this._meshNames.length;e++){if(!t.hasOwnProperty(this._meshNames[e]))return!1;this._meshes.push(t[this._meshNames[e]])}return!0},a.prototype.setBillboardMode=function(t){if(t!==this._billboardMode){if(this._meshes.length>0){var e=new s.Color(0,0,0),o=new s.Color(0,0,0);t?o.copy(this._meshes[0].material.color):e.copy(this._meshes[0].material.emissive);for(var n=0;n<this._meshes.length;n++)this._meshes[n].material.emissive.copy(o),this._meshes[n].material.color.copy(e)}this._billboardMode=t}},a.prototype.updateFromDOFValues=function(t){var e,o=[];for(e=0;e<this._dofNames.length;e++){if(!t.hasOwnProperty(this._dofNames[e]))return!1;o.push(t[this._dofNames[e]])}return this._meshes.length>0?(n.call(this,o[0],o[1],o[2]),!0):!1},a.prototype.updateFromPose=function(t){var e,o=[];for(e=0;e<this._dofNames.length;e++){var i=t.get(this._dofNames[e],0);if(null==i)return!1;o.push(i)}return this._meshes.length>0?(n.call(this,o[0],o[1],o[2]),!0):!1},a.prototype.getCopy=function(t){return t||(t=new a),i.prototype.getCopy.call(this,t),t._meshNames=this._meshNames?this._meshNames.slice(0):null,t._ledNames=this._ledNames?this._ledNames.slice(0):null,t},a.Factory=function(){},a.Factory.prototype=Object.create(r.prototype),a.Factory.prototype.constructor=a.Factory,a.Factory.prototype._controlType=a.prototype._controlType,a.Factory.prototype._controlConstructor=a,e.exports=a},{"./ModelControl":79,"./ModelControlFactory":80,three:void 0}],77:[function(t,e,o){"use strict";var n=function(t,e){this._dofName=t,this._controlType=null,this._isMetric=!1,this._isCyclic=!1,this._min=void 0,this._max=void 0,this._limitData={},this.setFromModelControl(e)};n.prototype.setFromModelControl=function(t){if(this._controlType=t.getControlType(),this._isMetric="TEXTURE"!==this._controlType,this._isCyclic="ROTATION"===this._controlType&&t.isCyclic(),"ROTATION"===this._controlType)this._min=this._isCyclic?-Math.PI:t.getMin(),this._max=this._isCyclic?Math.PI:t.getMax();else if("TRANSLATION"===this._controlType){var e=t.getDOFNames().indexOf(this._dofName);e>-1&&(this._min=t._minList[e],this._max=t._maxList[e])}else"COLOR"===this._controlType&&(this._min=0,this._max=1)},n.prototype.getDOFName=function(){return this._dofName},n.prototype.getControlType=function(){return this._controlType},n.prototype.isMetric=function(){return this._isMetric},n.prototype.isCyclic=function(){return this._isCyclic},n.prototype.getMin=function(){return this._min},n.prototype.getMax=function(){return this._max},n.prototype.setLimitData=function(t){for(var e=Object.keys(t),o=0;o<e.length;o++)this._limitData[e[o]]=t[e[o]]},n.prototype.getLimit=function(t){return this._limitData[t]},e.exports=n},{}],78:[function(t,e,o){"use strict";var n=function(t,e){this._modelControlGroup=t,this._hierarchyRoot=e,this._modelMap=null},i=function r(t,e){for(var o=t.clone(void 0,!1),n=0;n<t.children.length;n++){var i=t.children[n];null!=i.name&&e[i.name]&&o.add(r(i,e))}return o};n.prototype.getCopy=function(t,e){var o;if(null!=t&&null!=this._hierarchyRoot){for(var r={},s=this.getModelMap(),a=0;a<t.length;a++)for(var l=s[t[a]];null!=l;)r.hasOwnProperty(l.name)?l=null:(r[l.name]=!0,l=l.parent);r[this._hierarchyRoot.name]?o=i(this._hierarchyRoot,r):(console.log("Warning, none of required dofs ("+(null==t?"null":t.toString())+")present in hierarchy!"),o=null)}else o=this._hierarchyRoot?this._hierarchyRoot.clone():null;var c=this._modelControlGroup?this._modelControlGroup.getCopy():null;return c.attachToModelAndPrune(o),new n(c,o)},n.prototype.getPose=function(t){},n.prototype.setFromPose=function(t){this._modelControlGroup.updateFromPose(t)},n.prototype.getDOFNames=function(){return this._modelControlGroup.getDOFNames()},n.prototype.getModelControlGroup=function(){return this._modelControlGroup},n.prototype.getRoot=function(){return this._hierarchyRoot},n.generateTransformMap=function(t){for(var e={},o=[t];o.length>0;){var n=o.shift();if(n.name&&(e[n.name]=n),n.children)for(var i=0;i<n.children.length;i++)o.push(n.children[i])}return e},n.prototype.getModelMap=function(){return this._modelMap||(this._modelMap=n.generateTransformMap(this._hierarchyRoot)),this._modelMap},n.prototype.getTransform=function(t){return this._modelMap||(this._modelMap=n.generateTransformMap(this._hierarchyRoot)),this._modelMap[t]},e.exports=n},{}],79:[function(t,e,o){"use strict";var n=function(){this._controlNames=[],this._dofNames=[]};n.prototype._controlType=null,n.prototype.setFromJson=function(t){t.controlName&&this._controlNames.push(t.controlName)},n.prototype.getControlType=function(){return this._controlType},n.prototype.getControlNames=function(){return this._controlNames},n.prototype.getDOFNames=function(){return this._dofNames},n.prototype.getTransformNames=function(){return null},n.prototype.getDescriptiveName=function(){if(0===this._controlNames.length)return null;if(1===this._controlNames.length)return this._controlNames[0];for(var t=this._controlNames[0],e=1;e<this._controlNames.length;e++)t=t+", "+this._controlNames[e];return"MultiControl<"+t+">"},n.prototype.attachToModel=function(t){return!1},n.prototype.attachToControlGroup=function(t){},n.prototype.updateFromDOFValues=function(t){return!1},n.prototype.updateFromPose=function(t){return!1},n.prototype.getCopy=function(t){t||(t=new n),t._controlNames=this._controlNames?this._controlNames.slice(0):null,t._dofNames=this._dofNames?this._dofNames.slice(0):null,t._controlType=this._controlType},e.exports=n},{}],80:[function(t,e,o){"use strict";var n=function(){this._controlType=null,this._controlConstructor=null};n.prototype.getControlType=function(){return this._controlType},n.prototype.constructFromJson=function(t){if(t.controlType!==this._controlType)return console.warn("ModelControlFactory<"+this._controlType+">: don't know how to construct for control type: "+t.controlType),null;var e=new this._controlConstructor;return e.setFromJson(t),e},n.prototype.postProcessControlList=function(t){return t},e.exports=n},{}],81:[function(t,e,o){"use strict";var n=t("./KinematicGroup"),i=t("./DOFInfo"),r=function(){this._controlList=[],this._dofNames=[],this._dofNameToControlMap={},this._dofInfos={}};r.prototype.setControlList=function(t){var e;for(this._controlList=t,this._dofNames=[],this._dofNameToControlMap={},this._dofInfos={},e=0;e<this._controlList.length;e++)for(var o=this._controlList[e],n=o.getDOFNames(),r=0;r<n.length;r++)this._dofNames.push(n[r]),this._dofNameToControlMap[n[r]]=o,this._dofInfos[n[r]]=new i(n[r],o);for(e=0;e<this._controlList.length;e++)this._controlList[e].attachToControlGroup(this)},r.prototype.getControlList=function(){return this._controlList},r.prototype.getDOFNames=function(){return this._dofNames},r.prototype.getControlForDOF=function(t){return this._dofNameToControlMap[t]},r.prototype.getDOFInfo=function(t){return this._dofInfos[t]},r.prototype.attachToModel=function(t){for(var e=n.generateTransformMap(t),o=!0,i=0;i<this._controlList.length;i++){var r=this._controlList[i].attachToModel(e);r||(o=!1,console.warn("failed to attach model control: "+this._controlList[i].getDescriptiveName()))}return o},r.prototype.attachToModelAndPrune=function(t){var e=n.generateTransformMap(t);this.setControlList(this._controlList.filter(function(t){return t.attachToModel(e)}))},r.prototype.updateFromDOFValues=function(t){for(var e=!0,o=0;o<this._controlList.length;o++){var n=this._controlList[o].updateFromDOFValues(t);n||(e=!1)}return e},r.prototype.updateFromPose=function(t){for(var e=!0,o=0;o<this._controlList.length;o++){var n=this._controlList[o].updateFromPose(t);n||(e=!1)}return e},r.prototype.getRequiredTransformNamesForDOFs=function(t){if(null===t)return null;for(var e=[],o=0;o<t.length;o++){var n=this.getControlForDOF(t[o]),i=n.getTransformNames();if(null!=i)for(var r=0;r<i.length;r++)e.push(i[r])}return e},r.prototype.getPose=function(t){},r.prototype.getCopy=function(){if(null==this._controlList)return new r;for(var t=[this._controlList.length],e=0;e<this._controlList.length;e++)t[e]=this._controlList[e].getCopy(null);var o=new r;return o.setControlList(t),o},e.exports=r},{"./DOFInfo":77,"./KinematicGroup":78}],82:[function(t,e,o){"use strict";function n(t){var e=(new a.Quaternion).setFromAxisAngle(this._rotationalAxis,t);this._skeletonFrame.quaternion.multiplyQuaternions(this._initialRotation,e)}var i=t("./ModelControl"),r=t("./ModelControlFactory"),s=t("../../ifr-geometry/BasicFrame"),a=t("three"),l=function(){i.call(this),this._skeletonFrameName=null,this._rotationalAxis=new a.Vector3,this._initialRotation=new a.Quaternion,this._min=null,this._max=null,this._isCyclic=!1,this._skeletonFrame=null};l.prototype=Object.create(i.prototype),l.prototype.constructor=l,l.prototype._controlType="ROTATION",l.prototype.setFromJson=function(t){i.prototype.setFromJson.call(this,t),this._dofNames.push(t.dofName),this._skeletonFrameName=t.skeletonFrameName,this._rotationalAxis.copy(s.vector3FromJson(t.xyzRotationAxis)),this._initialRotation.copy(s.quaternionFromJson(t.wxyzQuatInitialRotation)),this._min=t.min,this._max=t.max,this._isCyclic=t.isCyclic|!1},l.prototype.attachToModel=function(t){return this._skeletonFrame=null,null!=t&&t.hasOwnProperty(this._skeletonFrameName)?(this._skeletonFrame=t[this._skeletonFrameName],!0):!1},l.prototype.updateFromDOFValues=function(t){if(this._skeletonFrame&&t.hasOwnProperty(this._dofNames[0])){var e=t[this._dofNames[0]];return n.call(this,e),!0}return!1},l.prototype.updateFromPose=function(t){var e=t.get(this._dofNames[0],0);return this._skeletonFrame&&null!=e?(n.call(this,e),!0):!1},l.prototype.getRotationalAxis=function(t){return null==t&&(t=new a.Vector3),t.copy(this._rotationalAxis)},l.prototype.getInitialRotation=function(t){return null==t&&(t=new a.Quaternion),t.copy(this._initialRotation)},l.prototype.getMin=function(){return this._min},l.prototype.getMax=function(){return this._max},l.prototype.isCyclic=function(){return this._isCyclic},l.prototype.getCopy=function(t){return t||(t=new l),i.prototype.getCopy.call(this,t),t._skeletonFrameName=this._skeletonFrameName,t._rotationalAxis=this._rotationalAxis?this._rotationalAxis.clone():null,t._initialRotation=this._initialRotation?this._initialRotation.clone():null,t._min=this._min,t._max=this._max,t._isCyclic=this._isCyclic,t},l.prototype.getTransformName=function(){return this._skeletonFrameName},l.prototype.getTransformNames=function(){return[this.getTransformName()]},l.Factory=function(){},l.Factory.prototype=Object.create(r.prototype),l.Factory.prototype.constructor=l.Factory,l.Factory.prototype._controlType=l.prototype._controlType,l.Factory.prototype._controlConstructor=l,e.exports=l},{"../../ifr-geometry/BasicFrame":55,"./ModelControl":79,"./ModelControlFactory":80,three:void 0}],83:[function(t,e,o){"use strict";function n(){null==this._mesh.material._specular_disabled&&(this._mesh.material._specular_disabled=new u.Color(this._mesh.material.specular)),this._billboardMode?(this._mesh.material.ambient.setRGB(0,0,0),this._mesh.material.specular.setRGB(0,0,0)):(this._mesh.material.ambient.setRGB(1,1,1),this._mesh.material.specular.set(this._mesh.material._specular_disabled))}function i(t){null!==this._colorControl&&this._colorControl.setBillboardMode(t),t!==this._billboardMode&&(null!==this._meshes&&(t?(this._mesh.material.ambient.setRGB(0,0,0),this._mesh.material.specular.setRGB(0,0,0)):(this._mesh.material.ambient.setRGB(1,1,1),this._mesh.material.specular.set(this._mesh.material._specular_disabled))),this._billboardMode=t)}function r(t){if("string"==typeof t)return i.call(this,!0),this.setTextureFromURL(t),!0;if("object"!==("undefined"==typeof t?"undefined":s(t)))return"number"==typeof t?(h.error("TextureControl for DOF "+this._dofNames[0]+": numerical values (image indices) are no longer supported, use full image URL instead"),!1):!1;var e=t.textureURL,o=t.useNormals,n=t.normalURL;null==o&&(o=null!=n),o===!0&&null==n&&(n=this._defaultNormalURL),o===!0&&this.setNormalFromURL(n),i.call(this,!o),null==e?h.error("Value for DOF "+this._dofNames[0]+' is object, but did not contain field "textureURL"'):this.setTextureFromURL(e)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},a=t("./ModelControl"),l=t("./ModelControlFactory"),c=t("../../ifr-geometry/loaders/CachedImageLoader"),u=t("three"),h=t("../../ifr-core/SLog"),p=function(){a.call(this),this._meshName=null,this._mesh=null,this._texture=new u.Texture,this._texture.minFilter=u.LinearFilter,this._normal=new u.Texture,this._blankTexture=new u.DataTexture(new Uint8Array(16),2,2),this._blankTexture.minFilter=u.LinearFilter,this._imageLoader=null,this._defaultNormalURL=null,this._colorControl=null,this._billboardMode=!0};p.prototype=Object.create(a.prototype),p.prototype.constructor=p,p.prototype._controlType="TEXTURE",p.prototype.setFromJson=function(t){a.prototype.setFromJson.call(this,t),this._dofNames.push(t.dofName),this._meshName=t.meshName},p.prototype.setImageLoader=function(t){this._imageLoader=t},p.prototype.setDefaultNormalURL=function(t){this._defaultNormalURL=t},p.prototype.attachToModel=function(t){return this._mesh=null,null!=t&&t.hasOwnProperty(this._meshName)?(this._mesh=t[this._meshName],n.call(this),!0):!1},a.prototype.attachToControlGroup=function(t){var e=t.getControlList();this._colorControl=null;for(var o=0;o<e.length;o++){if("COLOR"===e[o].getControlType())for(var n=e[o]._meshNames,i=0;i<n.length;i++)if(n[i]===this._meshName){this._colorControl=e[o];break}if(null!==this._colorControl)break}},p.prototype.updateFromDOFValues=function(t){if(this._mesh&&t.hasOwnProperty(this._dofNames[0])){var e=t[this._dofNames[0]];return r.call(this,e)}return!1},p.prototype.updateFromPose=function(t){var e=t.get(this._dofNames[0],0);return this._mesh&&null!=e?r.call(this,e):!1},p.prototype.setTextureFromURL=function(t){if(this._mesh&&this._texture.sourceFile!==t){this._texture.sourceFile=t,this._blankTexture.needsUpdate=!0,this._mesh.material.map=this._blankTexture;var e=this;this._imageLoader.loadImage(t,function(){var t=e._imageLoader.getResult();t.success&&t.url===e._texture.sourceFile?(e._texture.image=t.image,e._texture.needsUpdate=!0,e._mesh.material.map=e._texture):t.success||h.error("TextureControl for DOF "+e._dofNames[0]+": image load failed, URL = "+t.url)})}},p.prototype.setNormalFromURL=function(t){if(this._mesh&&this._normal.sourceFile!==t){this._normal.sourceFile=t;var e=this;this._imageLoader.loadImage(t,function(){var t=e._imageLoader.getResult();t.success&&t.url===e._normal.sourceFile?(e._normal.image=t.image,e._normal.needsUpdate=!0,null==e._mesh.material.normalMap&&(e._mesh.material.needsUpdate=!0),e._mesh.material.normalMap=e._normal):t.success||h.error("TextureControl for DOF "+e._dofNames[0]+": normal load failed, URL = "+t.url)})}},p.prototype.getCopy=function(t){return t||(t=new p),a.prototype.getCopy.call(this,t),t._meshName=this._meshName,t._texture=this._texture?this._texture.clone():null,t._imageLoader=this._imageLoader,t._defaultNormalURL=this._defaultNormalURL,t},p.Factory=function(){this._sharedImageLoader=new c},p.Factory.prototype=Object.create(l.prototype),p.Factory.prototype.constructor=p.Factory,p.Factory.prototype._controlType=p.prototype._controlType,p.Factory.prototype._controlConstructor=p,p.Factory.prototype.setSharedImageLoader=function(t){this._sharedImageLoader=t},p.Factory.prototype.constructFromJson=function(t){var e=l.prototype.constructFromJson.call(this,t);return e&&e.setImageLoader(this._sharedImageLoader),e},e.exports=p},{"../../ifr-core/SLog":52,"../../ifr-geometry/loaders/CachedImageLoader":59,"./ModelControl":79,"./ModelControlFactory":80,three:void 0}],84:[function(t,e,o){"use strict";function n(t){for(var e=(new a.Vector3).copy(this._initialPosition),o=new a.Vector3,n=0;n<t.length;n++){var i=a.Math.clamp(t[n],this._minList[n],this._maxList[n]);o.copy(this._translationalDirectionList[n]).multiplyScalar(i),e.add(o)}return e}var i=t("./ModelControl"),r=t("./ModelControlFactory"),s=t("../../ifr-geometry/BasicFrame"),a=t("three"),l=function(){i.call(this),this._skeletonFrameName=null,this._initialPosition=new a.Vector3,this._translationalDirectionList=[],this._minList=[],this._maxList=[],this._skeletonFrame=null};l.prototype=Object.create(i.prototype),l.prototype.constructor=l,l.prototype._controlType="TRANSLATION",l.prototype.setFromJson=function(t){i.prototype.setFromJson.call(this,t),this._dofNames.push(t.dofName),this._skeletonFrameName=t.skeletonFrameName,this._initialPosition.copy(s.vector3FromJson(t.xyzInitialPosition)),this._translationalDirectionList.push(s.vector3FromJson(t.xyzTranslationDirection)),this._minList.push(t.min),this._maxList.push(t.max)},l.prototype.appendControl=function(t){this._controlNames=this._controlNames.concat(t._controlNames),this._dofNames=this._dofNames.concat(t._dofNames),this._translationalDirectionList=this._translationalDirectionList.concat(t._translationalDirectionList),this._minList=this._minList.concat(t._minList),this._maxList=this._maxList.concat(t._maxList)},l.prototype.attachToModel=function(t){return this._skeletonFrame=null,null!=t&&t.hasOwnProperty(this._skeletonFrameName)?(this._skeletonFrame=t[this._skeletonFrameName],!0):!1},l.prototype.computeFromDOFValues=function(t){for(var e=[],o=0;o<this._dofNames.length;o++){if(!t.hasOwnProperty(this._dofNames[o]))return null;e.push(t[this._dofNames[o]])}return n.call(this,e)},l.prototype.updateFromDOFValues=function(t){var e=this.computeFromDOFValues(t);return null!=e&&null!=this._skeletonFrame?(this._skeletonFrame.position.copy(e),!0):!1},l.prototype.computeFromPose=function(t){for(var e=[],o=0;o<this._dofNames.length;o++){var i=t.get(this._dofNames[o],0);if(null==i)return null;e.push(i)}return n.call(this,e)},l.prototype.updateFromPose=function(t){var e=this.computeFromPose(t);return null!=e&&null!=this._skeletonFrame?(this._skeletonFrame.position.copy(e),!0):!1},l.prototype.getCopy=function(t){if(t||(t=new l),i.prototype.getCopy.call(this,t),t._skeletonFrameName=this._skeletonFrameName,t._initialPosition=this._initialPosition?this._initialPosition.clone():null,t._translationalDirectionList=this._translationalDirectionList?this._translationalDirectionList.slice(0):null,t._translationalDirectionList)for(var e=0;e<t._translationalDirectionList.length;e++)t[e]=t[e]?t[e].clone():null;return t._minList=this._minList?this._minList.slice(0):this._minList,t._maxList=this._maxList?this._maxList.slice(0):this._maxList,t},l.prototype.getTransformName=function(){return this._skeletonFrameName},l.prototype.getTransformNames=function(){return[this.getTransformName()]},l.Factory=function(){},l.Factory.prototype=Object.create(r.prototype),l.Factory.prototype.constructor=l.Factory,l.Factory.prototype._controlType=l.prototype._controlType,l.Factory.prototype._controlConstructor=l,l.Factory.prototype.postProcessControlList=function(t){for(var e={},o=[],n=0;n<t.length;n++){var i=t[n];if(i instanceof l)if(e.hasOwnProperty(i._skeletonFrameName)){var r=e[i._skeletonFrameName];r.appendControl(i)}else e[i._skeletonFrameName]=i,o.push(i);else o.push(i)}return o},e.exports=l},{"../../ifr-geometry/BasicFrame":55,"./ModelControl":79,"./ModelControlFactory":80,three:void 0}],85:[function(t,e,o){"use strict";var n=t("../../ifr-core/Bakery"),i=t("../base/CyclicMath"),r=function(){this._targetTime=null,this._targetPosition=null,this._targetVelocity=null,this._lastObservationTime=null,this._lastObservedPosition=null,this._lastObservedVelocity=null,this._lastReportedTargetVelocity=null,this._commandVelocity=0,this._commandAcceleration=1,this._lastError=0,this._window="FeedbackController"};r.prototype.setTarget=function(t,e,o){this._targetTime=t,this._targetPosition=e,this._targetVelocity=o},r.prototype.acceptFeedback=function(t,e,o,n){this._lastObservationTime=t,this._lastObservedPosition=e,this._lastObservedVelocity=o,this._lastReportedTargetVelocity=n},r.prototype.calculateForTime=function(t){if(null!==this._lastObservationTime&&null!==this._targetTime){var e=t.subtract(this._targetTime),o=this._targetPosition+this._targetVelocity*e,r=n.getFloat("P Gain",0,10,2,this._window),s=n.getFloat("D Gain",0,10,0,this._window),a=this.predictedPosition(t);a=i.closestEquivalentRotation(a,o);var l=o-a,c=l-this._lastError,u=r*l+s*c;this._lastError=l;var h=n.getFloat("P Gain Vel Cap",0,100,100,this._window);u=Math.max(-h,Math.min(h,u)),this._commandVelocity=u,this._commandAcceleration=n.getFloat("Advertise Accel Limit",0,50,30,this._window)}},r.prototype.predictedPosition=function(t){return this._lastObservedPosition},r.prototype.getCommandVelocity=function(){return this._commandVelocity},r.prototype.getCommandAcceleration=function(){return this._commandAcceleration},r.prototype.noteCommandSent=function(t,e,o){},e.exports=r},{"../../ifr-core/Bakery":48,"../base/CyclicMath":65}],86:[function(t,e,o){"use strict";var n=t("../../ifr-core/Bakery"),i=t("./PController"),r=function(){i.call(this),this._commandVelocityPVC=0};r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.calculateForTime=function(t){null!==this._lastObservationTime&&null!==this._targetTime&&(i.prototype.calculateForTime.call(this,t),n.getBoolean("Use Velocity",!0,this._window)?this._commandVelocityPVC=this._commandVelocity+this._targetVelocity:this._commandVelocityPVC=this._commandVelocity)},r.prototype.getCommandVelocity=function(){return this._commandVelocityPVC},e.exports=r},{"../../ifr-core/Bakery":48,"./PController":85}],87:[function(t,e,o){"use strict";var n=t("./TrajectoryControllerSim"),i=function(t,e,o){n.call(this,t,e,o)};i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.updateCommand=function(t,e,o,i,r){var s=.1;n.prototype.updateCommand.call(this,t,e,s,o,i,r)},e.exports=i},{"./TrajectoryControllerSim":88}],88:[function(t,e,o){"use strict";var n=t("../base/AccelPlanner"),i=t("../../ifr-core/Clock"),r=t("../base/CyclicMath"),s=t("../../ifr-core/SLog"),a=function(t,e,o){null==t&&(t=0),null==e&&(e=0),null==o&&(o=i.currentTime()),this._planner=new n,this._plan=this._planner.computeWithZeroAccel(e),this._planStartTime=o,this._planStartPosition=t};a.prototype.updateCommand=function(t,e,o,n,a,l){null==l&&(l=i.currentTime());var c=l.subtract(this._planStartTime),u=this._plan.displacementAtTime(c)+this._planStartPosition,h=this._plan.velocityAtTime(c);t=r.closestEquivalentRotation(t,u),this._plan=this._planner.computeWithMaxAccel(h,e,t-u,n,o),this._plan.isConsistent()||(s.error("Inconsistent plan with inputs: \n	currentVelocity:"+h+" \n	targetVelocity:"+e+" \n	pDelta:"+(t-u)+" \n	maxAcceleration:"+n+" \n	maxVelocity:"+a),this.plan=this._planner.computeWithMaxAccel(0,0,0,1,1)),this._planStartTime=l,this._planStartPosition=u},a.prototype.getPosition=function(t){null==t&&(t=i.currentTime());var e=t.subtract(this._planStartTime),o=this._plan.displacementAtTime(e)+this._planStartPosition;return o},a.prototype.getVelocity=function(t){null==t&&(t=i.currentTime());var e=t.subtract(this._planStartTime),o=this._plan.velocityAtTime(e);return o},e.exports=a},{"../../ifr-core/Clock":49,"../../ifr-core/SLog":52,"../base/AccelPlanner":62,"../base/CyclicMath":65}],89:[function(t,e,o){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},i=t("../base/TimestampedBuffer"),r=t("../base/MotionTrack"),s=t("../base/Motion"),a=t("../base/MotionEvent"),l=t("../../ifr-core/FileTools"),c=t("../../ifr-core/SLog"),u="MODEL_LOADING",h=function(){this.url=null,this.success=!1,this.message="",this.motion=null,this.defaultDOFNames=null,this.enumMaps=null,this.events=null},p=function(){this._result=null,this.flattenEnums=!0,this.resolvePaths=!0};p.prototype.getResult=function(){return this._result},p.prototype.load=function(t,e){var o=this;l.loadJSON(t,function(n,i){if(null===n)o.parseData(i,t),e&&e();else{var r=new h;r.url=t,r.success=!1,r.message=n,o._result=r,e&&e()}})},p.prototype.parseData=function(t,e){if(this._result=new h,this._result.url=e,"DOFAnimation"!==t.header.fileType&&"Animation"!==t.header.fileType)return this._result.success=!1,void(this._result.message="don't know how to handle file type: "+t.header.fileType);for(var o=t.content,n=new s(o.name),l=0;l<o.channels.length;l++){var p=o.channels[l],f=new i;f.timestampList=p.times,f.dataList=p.values;var g=new r(p.dofName,f,p.length);n.addTrack(g)}if(this._result.motion=n,o.defaultDOFs&&(this._result.defaultDOFNames=o.defaultDOFs),o.enumMaps){this._result.enumMaps={};for(var y=0;y<o.enumMaps.length;y++){var _=o.enumMaps[y];this._result.enumMaps[_.dofName]=_.values}this.flattenEnums&&d(this._result.motion,this._result.enumMaps)}if(this.resolvePaths&&m(this._result.motion,e),o.events){this._result.events=[];for(var v=0;v<o.events.length;v++){var T=o.events[v];if(void 0===T.time||null===T.time)c(u,"AnimationLoader: skipping event with null or undefined time property");else if(T.time<0||T.time>n.getDuration())c(u,"AnimationLoader: skipping event with time property: "+T.time+" outside of animation bounds, animation duration = "+n.getDuration());else if(void 0===T.eventName||null===T.eventName||""===T.eventName)c(u,"AnimationLoader: skipping event with empty, null, or undefined eventName property");else if("string"!=typeof T.eventName)c(u,"AnimationLoader: skipping event with non-string eventName property: "+T.eventName);else{var O=void 0!==T.payload?T.payload:null;this._result.events.push(new a(T.time,T.eventName,O))}}this._result.events.sort(function(t,e){return t.getTimestamp()-e.getTimestamp()})}this._result.success=!0};var d=function(t,e){for(var o=t.getTracks(),n=Object.keys(o),i=0;i<n.length;i++){var r=n[i];if(e.hasOwnProperty(r))for(var s=o[r].getMotionData().dataList,a=e[r],l=0;l<s.length;l++){var h=s[l];if(h instanceof Array&&(h=h[0]),"number"==typeof h){var p=Math.round(h);s[l]=[a[p]],a.hasOwnProperty(p)||c(u,"AnimationLoader: no enum value specified for key: "+p+", DOF = "+r)}else c(u,"AnimationLoader: DOF "+r+" has an enum map, but found non-numerical value: "+h)}}},m=function(t,e){var o="",i=e.lastIndexOf("/"),r=e.lastIndexOf("\\");if(-1!==i||-1!==r){var s=Math.max(i,r);o=e.substring(0,s+1)}for(var a=t.getTracks(),l=Object.keys(a),h=0;h<l.length;h++){var p=l[h],d=a[p].getMotionData().dataList,m=[],f=d[0];if(f instanceof Array&&(f=f[0]),"string"==typeof f||"object"===("undefined"==typeof f?"undefined":n(f)))for(var g=0;g<d.length;g++){var y=d[g];y instanceof Array&&(y=y[0]),"string"==typeof y?d[g]=[o+y]:"object"===("undefined"==typeof y?"undefined":n(y))?m.indexOf(y)<0&&("string"==typeof y.textureURL?(y.textureURL=o+y.textureURL,"string"==typeof y.normalURL&&(y.normalURL=o+y.normalURL),m.push(y)):c(u,"AnimationLoader: DOF "+p+" had object-valued samples, but at least one ("+g+') is missing "textureURL" field')):c(u,"AnimationLoader: DOF "+p+" had string-valued samples, but also found non-string value: "+y)}}};e.exports=p},{"../../ifr-core/FileTools":50,"../../ifr-core/SLog":52,"../base/Motion":69,"../base/MotionEvent":70,"../base/MotionTrack":71,"../base/TimestampedBuffer":75}],90:[function(t,e,o){"use strict";var n=t("../dofs/ModelControlGroup"),i=t("../dofs/RotationControl"),r=t("../dofs/TranslationControl"),s=t("../dofs/TextureControl"),a=t("../dofs/ColorControl"),l=t("../../ifr-core/FileTools"),c=function(){this.url=null,this.success=!1,this.message="",this.modelControlGroup=null},u=function(){this._result=null,this._modelControlFactoryMap={},this.addModelControlFactory(new i.Factory),this.addModelControlFactory(new r.Factory),this.addModelControlFactory(new s.Factory),this.addModelControlFactory(new a.Factory)};u.prototype.addModelControlFactory=function(t){this._modelControlFactoryMap[t.getControlType()]=t},u.prototype.getModelControlFactory=function(t){return this._modelControlFactoryMap[t]},u.prototype.getResult=function(){return this._result},u.prototype.load=function(t,e){var o=this;l.loadJSON(t,function(n,i){if(null===n)o.parseData(i,t),e&&e();else{var r=new c;r.url=t,r.success=!1,r.message=n,o._result=r,e&&e()}})},u.prototype.parseData=function(t,e){if(this._result=new c,this._result.url=e,"Kinematics"!==t.header.fileType)return this._result.success=!1,void(this._result.message="don't know how to handle file type: "+t.header.fileType);for(var o=[],i=0;i<t.content.controls.length;i++){var r=t.content.controls[i];if(!this._modelControlFactoryMap.hasOwnProperty(r.controlType))return this._result.success=!1,void(this._result.message="no factory installed for control type: "+r.controlType+", control name = "+r.controlName);var s=this._modelControlFactoryMap[r.controlType],a=s.constructFromJson(r);if(null===a)return this._result.success=!1,void(this._result.message="factory construction failed, control type = "+r.controlType+", control name = "+r.controlName);o.push(a)}for(var l=Object.keys(this._modelControlFactoryMap),u=0;u<l.length;u++)o=this._modelControlFactoryMap[l[u]].postProcessControlList(o);this._result.modelControlGroup=new n,this._result.modelControlGroup.setControlList(o),this._result.success=!0},e.exports=u},{"../../ifr-core/FileTools":50,"../dofs/ColorControl":76,"../dofs/ModelControlGroup":81,"../dofs/RotationControl":82,"../dofs/TextureControl":83,"../dofs/TranslationControl":84}],91:[function(t,e,o){"use strict";var n=t("../../ifr-core/FileTools"),i=t("../../ifr-core/SLog"),r="MODEL_LOADING",s=function(){this.url=null,this.success=!1,this.message="",this.dofLimits=null},a=function(){this._result=null};a.prototype.getResult=function(){return this._result},a.prototype.load=function(t,e){var o=this;n.loadJSON(t,function(n,i){if(null===n)o.parseData(i,t),e&&e();else{var r=new s;r.url=t,r.success=!1,r.message=n,o._result=r,e&&e()}})},a.prototype.parseData=function(t,e){if(this._result=new s,this._result.url=e,"Limits"!==t.header.fileType)return this._result.success=!1,void(this._result.message="don't know how to handle file type: "+t.header.fileType);var o={},n=t.content.dofLimits;if(n)for(var a=0;a<n.length;a++){var l=n[a].dofName,c=n[a].limits;void 0===l||null===l?i(r,"LimitsLoader: skipping limit data with null or undefined dofName property"):void 0===c||null===c?i(r,"LimitsLoader: skipping limit data with null or undefined limits property"):o[l]=c;
}this._result.dofLimits=o,this._result.success=!0},e.exports=a},{"../../ifr-core/FileTools":50,"../../ifr-core/SLog":52}],92:[function(t,e,o){"use strict";var n=function(t,e){this._name=t,this._controlledDOFName=e,this._kinematicGroup=null};n.prototype.connectToGroup=function(t){this._kinematicGroup=t},n.prototype.valToPointAtTarget=function(t,e){},n.prototype.getName=function(){return this._name},n.prototype.getControlledDOFName=function(){return this._controlledDOFName},n.prototype.errorRatio=function(t){},n.prototype.suggestForwardTarget=function(t){},e.exports=n},{}],93:[function(t,e,o){"use strict";var n=t("./OcularStabilizationTracker"),i=t("./PoseOffsetFilter"),r=t("../base/Pose"),s=t("../../ifr-core/SLog"),a=t("three"),l=t("./LookatNode"),c=t("./LookatNodeDistanceReport"),u=t("./trackpolicy/LookatNodeTrackPolicy"),h=t("./trackpolicy/TrackPolicyTriggerAlways"),p={POINT_TARGET:"POINT_TARGET",POINT_FORWARD:"POINT_FORWARD",POINT_AUTO:"POINT_AUTO"},d=function(t,e,o,s,l){this._lookatNode=t,this._stabilization=new n(t,e),this._filter=new i(t.getDOFs()),this._filter.setRejectDeltaThreshold(.4),null!=o&&this._filter.setAcceleration(o),this._lastUpdateTime=null,this._optimalPose=new r("LMN Optimal",t.getDOFs()),this._tempPose=new r("LMN Temp",t.getDOFs()),this._stabilizationTarget=new a.Vector3,this._poseForStabilizationTarget=new r("Pose For ST",t.getDOFs()),this._holdPose=new r("Hold Pose",t.getDOFs()),this._lookatTrackPolicy=l,null==this._lookatTrackPolicy&&(this._lookatTrackPolicy=new u([new h])),this._dofAligner=e,this._stabilizationMode=s,this._lookatNodeDistanceReport=new c};d.LookStabilizationMode=p,d.prototype.connectToGroup=function(t){this._lookatNode.connectToGroup(t)},d.prototype.update=function(t,e,o,n){if(null!==this._lastUpdateTime&&n.equals(this._lastUpdateTime))return void this._filter.getValue(e);var i;i=null===this._lastUpdateTime?t:this._optimalPose;var a=new l.PointNodeReport;if(this._lookatNode.getPose(t,this._optimalPose,o,i,a),this._stabilizationMode===p.POINT_FORWARD||this._stabilizationMode===p.POINT_AUTO&&(a._targetStability<.2||!a._pointSucceeded)?(this._stabilizationMode===p.POINT_AUTO&&s.info("Stabilization AUTO mode for "+this.getName()+" falling back to FORWARD with stability "+a._targetStability+", pointSuccess="+a._pointSucceeded),this._lookatNode.suggestForwardTarget(t,this._stabilizationTarget),this._lookatNode.getPose(t,this._poseForStabilizationTarget,this._stabilizationTarget,i)):(this._stabilizationTarget.copy(o),this._poseForStabilizationTarget.setPose(this._optimalPose)),null===this._lastUpdateTime)this._stabilization.reset(),this._holdPose.setPose(t),this._lookatTrackPolicy.reset(),this._stabilization.computeStabilizationDelta(t,this._poseForStabilizationTarget,this._stabilizationTarget),this._tempPose.setPose(t),this._stabilization.decomposeVelocity(t,this._tempPose,this._stabilizationTarget,this._filter.getRejectDeltaThreshold()),this._filter.resetToPose(this._tempPose);else{this._filter.getTarget(this._tempPose),this._dofAligner.refineToLocallyClosestTargetPose(this._tempPose,this._optimalPose);var c=this._stabilization.computeStabilizationDelta(t,this._poseForStabilizationTarget,this._stabilizationTarget);this._filter.applyUnfilteredOffset(c),r.add(this._holdPose,c,!1,this._holdPose),this._filter.getValue(this._tempPose),this._lookatNodeDistanceReport.compute(this._holdPose,this._optimalPose,this._tempPose);var h=this._lookatTrackPolicy.computeMode(this._lookatNodeDistanceReport,n);h===u.TrackMode.HOLD||h===u.TrackMode.DELAY?this._filter.setTarget(this._holdPose):this._filter.setTarget(this._optimalPose),this._filter.updateByTime(n.subtract(this._lastUpdateTime))}null!=e&&this._filter.getValue(e),this._lastUpdateTime=n},d.prototype.getOptimalPose=function(t,e,o){var n;n=null===this._lastUpdateTime?t:this._optimalPose,this._lookatNode.getPose(t,e,o,n)},d.prototype.getPose=function(t){null===this._lastUpdateTime&&s.error('LookatMotionNode asked "getPose()" before initialization'),this._filter.getValue(t)},d.prototype.getDistanceRemaining=function(){return this._filter.getValue(this._tempPose),this._lookatNode.distanceAsRatio(this._tempPose,this._optimalPose)},d.prototype.getDOFs=function(){return this._lookatNode.getDOFs()},d.prototype.reset=function(){this._lastUpdateTime=null},d.prototype.getName=function(){return this._lookatNode.getName()},e.exports=d},{"../../ifr-core/SLog":52,"../base/Pose":73,"./LookatNode":94,"./LookatNodeDistanceReport":95,"./OcularStabilizationTracker":97,"./PoseOffsetFilter":100,"./trackpolicy/LookatNodeTrackPolicy":103,"./trackpolicy/TrackPolicyTriggerAlways":105,three:void 0}],94:[function(t,e,o){"use strict";function n(t,e,o){var n=t._angleToAxis/(Math.PI/2),i=Math.min(5*t._distanceToTarget,1);null===e._targetStability?e._targetStability=n*i:e._targetStability*=n*i,o||(e._pointSucceeded=!1)}var i=t("./PointADOF"),r=t("../../ifr-core/SLog"),s="LOOKAT",a=function(){this._targetStability=null,this._pointSucceeded=!0},l=function(t,e){this._name=t,this._lookatDOFs=e,this._kinematicGroup=null};l.PointNodeReport=a,l.prototype.connectToGroup=function(t){this._kinematicGroup=t;for(var e=0;e<this._lookatDOFs.length;e++)this._lookatDOFs[e].connectToGroup(this._kinematicGroup)},l.prototype.getPose=function(t,e,o,a,l){e!==t&&e.setPose(t),null==a&&(a=t);var c=!1;this._kinematicGroup.setFromPose(t),this._kinematicGroup.getRoot().updateMatrixWorld(!0);for(var u=null,h=0;h<this._lookatDOFs.length;h++){l&&(u=new i.PointReport);var p=this._lookatDOFs[h].valToPointAtTarget(o,u);u&&n(u,l,null!=p),null!=p?e.set(this._lookatDOFs[h].getControlledDOFName(),p,0):(r(s,"LookatNode "+this._name+" using last value due to uncomputable value for target ("+o.x+", "+o.y+", "+o.z+")"),e.set(this._lookatDOFs[h].getControlledDOFName(),a.get(this._lookatDOFs[h].getControlledDOFName(),0),0),c=!0),h<this._lookatDOFs.length-1&&(this._kinematicGroup.setFromPose(e),this._kinematicGroup.getRoot().updateMatrixWorld(!0))}return!c},l.prototype.getDOFs=function(){for(var t=[],e=0;e<this._lookatDOFs.length;e++)t.push(this._lookatDOFs[e].getControlledDOFName());return t},l.prototype.distanceAsRatio=function(t,e){for(var o=0,n=0;n<this._lookatDOFs.length;n++){var i=this._lookatDOFs[n],r=i.getControlledDOFName(),s=t.get(r,0),a=e.get(r,0),l=i.errorRatio(s-a);l>o&&(o=l)}return o},l.prototype.getName=function(){return this._name},l.prototype.suggestForwardTarget=function(t,e){return this._kinematicGroup.setFromPose(t),this._kinematicGroup.getRoot().updateMatrixWorld(!0),this._lookatDOFs[0].suggestForwardTarget(e)},e.exports=l},{"../../ifr-core/SLog":52,"./PointADOF":99}],95:[function(t,e,o){"use strict";var n=function(){this.highestDistanceHoldToFiltered=0,this.highestDistanceHoldToOptimal=0,this.highestDistanceOptimalToFiltered=0};n.prototype.compute=function(t,e,o){this.highestDistanceHoldToFiltered=0,this.highestDistanceHoldToOptimal=0,this.highestDistanceOptimalToFiltered=0;for(var n=t.getDOFNames(),i=0;i<n.length;i++){var r=n[i],s=Math.abs(t.get(r,0)-o.get(r,0)),a=Math.abs(t.get(r,0)-e.get(r,0)),l=Math.abs(e.get(r,0)-o.get(r,0));s>this.highestDistanceHoldToFiltered&&(this.highestDistanceHoldToFiltered=s),a>this.highestDistanceHoldToOptimal&&(this.highestDistanceHoldToOptimal=a),l>this.highestDistanceOptimalToFiltered&&(this.highestDistanceOptimalToFiltered=l)}},e.exports=n},{}],96:[function(t,e,o){"use strict";var n=t("../base/Pose"),i=function(t,e){var o,i,r=[];for(this._lookatNodes=t,o=0;o<this._lookatNodes.length;o++){var s=e.getCopy(e.getModelControlGroup().getRequiredTransformNamesForDOFs(this._lookatNodes[o].getDOFs()),!0);this._lookatNodes[o].connectToGroup(s);var a=s.getDOFNames();for(i=0;i<a.length;i++)r.indexOf(a[i])<0&&r.push(a[i])}for(this._internalPose=new n("LookPose",r),this._dofToLookatNodeMap={},this._lookatNodeToDOFsMap={},o=0;o<this._lookatNodes.length;o++){var l=this._lookatNodes[o],c=this._lookatNodes[o].getDOFs();if(this._lookatNodeToDOFsMap.hasOwnProperty(l.getName()))throw new Error("Error, multiple lookat nodes named "+l.getName());for(this._lookatNodeToDOFsMap[l.getName()]=c,i=0;i<c.length;i++){var u=c[i];if(this._dofToLookatNodeMap.hasOwnProperty(u))throw new Error("Error, multiple lookat nodes use DOF "+u+": "+this._dofToLookatNodeMap[u].getName()+" and "+l.getName());this._dofToLookatNodeMap[u]=l}}};i.prototype.generatePose=function(t,e,o,n){t!==e&&e.setPose(t),this._internalPose.setPose(t);for(var i=0;i<this._lookatNodes.length;i++)this._lookatNodes[i].update(this._internalPose,this._internalPose,o,n);e.setPose(this._internalPose)},i.prototype.generatePoseIncremental=function(t,e,o,n,i){if(t!==e&&e.setPose(t),this._dofToLookatNodeMap.hasOwnProperty(i)){var r=this._dofToLookatNodeMap[i];r.update(t,e,o,n)}},i.prototype.getPose=function(t){for(var e=0;e<this._lookatNodes.length;e++)for(var o=this._lookatNodes[e],n=this._lookatNodeToDOFsMap[o.getName()],i=0;i<n.length;i++)if(null!==t.get(n[i])){o.getPose(t);break}},i.prototype.getOptimalPose=function(t,e,o){t!==e&&e.setPose(t),this._internalPose.setPose(t);for(var n=0;n<this._lookatNodes.length;n++)this._lookatNodes[n].getOptimalPose(this._internalPose,this._internalPose,o);e.setPose(this._internalPose)},i.prototype.getDistanceRemaining=function(t){var e,o,n=0;if(null==t)for(e=0;e<this._lookatNodes.length;e++)o=this._lookatNodes[e].getDistanceRemaining(),o>n&&(n=o);else{var i={};for(e=0;e<t.length;e++){var r=t[e];if(this._dofToLookatNodeMap.hasOwnProperty(r)){var s=this._dofToLookatNodeMap[r];i[s.getName()]!==!0&&(o=s.getDistanceRemaining(),o>n&&(n=o),i[s.getName()]=!0)}}}return n},i.prototype.getDOFs=function(){for(var t=[],e=0;e<this._lookatNodes.length;e++)t=t.concat(this._lookatNodes[e].getDOFs());return t},i.prototype.getStateDOFs=function(){return this._internalPose.getDOFNames()},i.prototype.reset=function(){for(var t=0;t<this._lookatNodes.length;t++)this._lookatNodes[t].reset()},e.exports=i},{"../base/Pose":73}],97:[function(t,e,o){"use strict";var n=t("../../ifr-core/SLog"),i=t("../base/Pose"),r=t("three"),s=t("./LookatNode"),a=function(t,e){var o=!1,a=new r.Vector3,l=t.getDOFs(),c=new i(t.getName()+" Last Optimal",l),u=new i(t.getName()+" Stepped Pose",l),h=new i(t.getName()+" OST Delta",l),p=new i(t.getName()+" Temp Last Pose Optimal",l),d=null;this.computeStabilizationDelta=function(n,r,p){if(o){var d=new s.PointNodeReport;if(t.getPose(n,u,a,null,d),d._pointSucceeded)null!=e&&e.refineToLocallyClosestTargetPose(c,u),i.subtract(u,c,!0,h);else for(var m=0;m<h.getDOFNames();m++)h.set(h.getDOFNames()[m],0,0)}else{h.clear();for(var f=0;f<l.length;f++)h.set(l[f],0,0)}return a.copy(p),null==r?t.getPose(n,c,p):c.setPose(r),o=!0,h},this.decomposeVelocity=function(o,r,s,a){null==a&&(a=0),null===d&&(d=new i(t.getName()+" Decomp Last Pose")),i.advanceByTime(o,!0,d,-0.02),t.getPose(o,u,s),t.getPose(d,p,s),null!=e&&e.refineToLocallyClosestTargetPose(p,u),i.subtract(u,p,!0,h);for(var l=h.getDOFNames(),c=0;c<l.length;c++){var m=l[c],f=o.get(m,1),g=h.get(m,0);0!==a&&Math.abs(g)>a&&(n.error("Clamping OST application of unfiltered offset of "+h+" to "+m+" as it is greater than "+a),g=0>g?-a:a);var y=50*g;r.set(m,f-y,1)}},this.reset=function(){o=!1}};e.exports=a},{"../../ifr-core/SLog":52,"../base/Pose":73,"./LookatNode":94,three:void 0}],98:[function(t,e,o){"use strict";var n=t("./PointADOF"),i=t("./LookatDOF"),r=function(t,e,o,n,r,s,a,l){i.call(this,t,e),this._control=null,this._forwardDir=n,this._centralTransformName=o,this._internalDistance=s,this._planeNormal=r,this._controlledTransform=null,this._centralTransform=null,this._dofMin=a,this._dofMax=l};r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.connectToGroup=function(t){i.prototype.connectToGroup.call(this,t),this._kinematicGroup?(this._control=this._kinematicGroup.getModelControlGroup().getControlForDOF(this._controlledDOFName),this._controlledTransform=this._kinematicGroup.getTransform(this._control.getTransformName()),this._centralTransform=this._kinematicGroup.getTransform(this._centralTransformName)):(this._control=null,this._controlledTransform=null,this._centralTransform=null)},r.prototype.valToPointAtTarget=function(t,e){var o=n.planeIntersectFromRear(this._centralTransform,t,null,this._forwardDir,this._planeNormal,this._internalDistance,e);return Math.max(Math.min(o,this._dofMax),this._dofMin)},r.prototype.errorRatio=function(t){return Math.abs(t/(this._dofMax-this._dofMin))},r.prototype.suggestForwardTarget=function(t){return null==this._centralTransform?null:(t.copy(this._forwardDir),t.multiplyScalar(10),this._centralTransform.localToWorld(t),t)},e.exports=r},{"./LookatDOF":92,"./PointADOF":99}],99:[function(t,e,o){"use strict";var n=t("three"),i=t("../../ifr-core/SLog"),r="LOOKAT",s=.001,a=s*s,l=null,c=function(){this._angleToAxis=null,this._distanceToTarget=null},u={name:"PointADOF"};u.PointReport=c,u.setVisHelper=function(t){l=t};var h=function(t){return t=Math.abs(t%Math.PI),t=Math.abs(Math.PI/2-t),t=Math.PI/2-t},p=function(t,e){var o=(new n.Vector3).copy(t),a=o.angleTo(e),l=o.multiplyScalar(-1).angleTo(e);return l>=a?a>.1&&h(t.w)>s?(i(r,"Error, computed axis ("+o.x+", "+o.y+", "+o.z+") not so close ("+a+") to references axis ("+e.x+", "+e.y+", "+e.z+"), angle = "+t.w),null):t.w:l>.1&&h(t.w)>s?(i(r,"Error, computed axis ("+o.x+", "+o.y+", "+o.z+") not so close ("+a+") to references axis ("+e.x+", "+e.y+", "+e.z+"), angle = "+t.w),null):-t.w};u.getRelativeAngle=function(t,e,o,s,c,u){null==o&&(o=new n.Vector3(0,0,0));var d=t.worldToLocal((new n.Vector3).copy(e)),m=(new n.Vector3).copy(d).sub(o);u&&(u._angleToAxis=h(m.angleTo(c)),u._distanceToTarget=m.length());var f=(new n.Vector3).copy(s).projectOnPlane(c),g=(new n.Vector3).copy(m).projectOnPlane(c);if(f.lengthSq()<a)return i(r,"Error getting relative angle, forward too close to plane normal ("+c.x+", "+c.y+", "+c.z+") too close to axis ("+c.x+", "+c.y+", "+c.z+")"),null;if(g.lengthSq()<a)return i(r,"Error getting relative angle, target dir too close to plane normal ("+c.x+", "+c.y+", "+c.z+") too close to axis ("+g.x+", "+g.y+", "+g.z+")"),null;g.normalize(),f.normalize();var y=(new n.Quaternion).setFromUnitVectors(f,g),_=(new n.Vector4).setAxisAngleFromQuaternion(y),v=p(_,c);return null!==l&&l.shouldDraw(this)&&(l.drawRayLocal(this,"RelativeAngle:Forward",t,o,s,new n.Color(1,0,0)),l.drawLineLocal(this,"RelativeAngle:Target",t,o,(new n.Vector3).copy(o).add(m),new n.Color(.6,.6,0)),l.drawLineLocal(this,"RelativeAngle:FlatTarget",t,o,(new n.Vector3).copy(o).add(g),new n.Color(0,1,1)),l.drawRayLocal(this,"RelativeAngle:AxisOfRotation",t,o,c,new n.Color(.5,1,0)),l.drawPlaneLocal(this,"RelativeAngle:PlaneOfRotation",t,o,c,new n.Color(1,0,1))),v},u.planeIntersectFromRear=function(t,e,o,s,a,c,h){null==o&&(o=new n.Vector3(0,0,0));var p=(new n.Vector3).copy(s).normalize().multiplyScalar(-c).add(o),d=u.getRelativeAngle(t,e,p,s,a,h);if(null!=d){var m;if(m=d>=Math.PI/2?Number.POSITIVE_INFINITY:d<=-Math.PI/2?Number.NEGATIVE_INFINITY:Math.tan(d)*c,null!==l&&l.shouldDraw(this)){var f=t.worldToLocal((new n.Vector3).copy(e));l.drawLineLocal(this,"PlaneIntersectFromRear:InternalToTarget",t,p,f,new n.Color(1,1,0))}return m}return i(r,"Plane intersect error, could not get angle"),null},u.pointDOF=function(t,e,o,s,c){var u=e.worldToLocal((new n.Vector3).copy(s)),d=(new n.Quaternion).copy(e.quaternion);u.applyQuaternion(d);var m=t.getInitialRotation(new n.Quaternion),f=t.getRotationalAxis(new n.Vector3);f.applyQuaternion(m);var g=(new n.Vector3).copy(o).applyQuaternion(m);c&&(c._angleToAxis=h(u.angleTo(f)),c._distanceToTarget=u.length());var y=(new n.Vector3).copy(g).projectOnPlane(f),_=(new n.Vector3).copy(u).projectOnPlane(f);if(y.lengthSq()<a||_.lengthSq()<a)return i(r,"Error pointing DOF, Forward length:"+y.length()+" local length:"+_.length()),null;y.normalize(),_.normalize();var v=(new n.Quaternion).setFromUnitVectors(y,_),T=(new n.Vector4).setAxisAngleFromQuaternion(v),O=p(T,f);if(null!==l&&l.shouldDraw(this)){l.drawRayLocal(this,"PointAt:CurForwardDir",e,null,o,new n.Color(1,0,0));var L=t.getRotationalAxis(new n.Vector3);l.drawRayLocal(this,"PointAt:AxisOfRotation",e,null,L,new n.Color(1,1,0)),l.drawPlaneLocal(this,"PointAt:PlaneOfRotation",e,null,L,new n.Color(1,0,1));var b=(new n.Vector3).copy(o);b.applyQuaternion(m),b.applyQuaternion((new n.Quaternion).copy(d).inverse()),l.drawRayLocal(this,"PointAt:InitForwardDir",e,null,b,new n.Color(0,1,1));var S=(new n.Quaternion).setFromAxisAngle(f,O),w=(new n.Vector3).copy(g).applyQuaternion(S);w.applyQuaternion((new n.Quaternion).copy(d).inverse()),l.drawRayLocal(this,"PointAt:FlatTargetVec",e,null,w,new n.Color(0,1,1))}return O},u.pointDOFToIntersectConeWithPoint=function(t,e,o,a,c,u,d,m){var f=e.worldToLocal((new n.Vector3).copy(c)),g=(new n.Quaternion).copy(e.quaternion);f.applyQuaternion(g);var y=t.getInitialRotation(new n.Quaternion),_=t.getRotationalAxis(new n.Vector3),v=(new n.Vector3).copy(_).applyQuaternion(y);if(o.angleTo(_)>Math.PI/2&&(o=(new n.Vector3).copy(o).multiplyScalar(-1)),0!==a){var T=(new n.Vector3).copy(v);T.multiplyScalar(a/T.length()),f.sub(T)}if(0!==u){var O=(new n.Vector3).crossVectors(v,f).normalize();f.applyAxisAngle(O,u)}if(null!==l&&l.shouldDraw(this)){var L=(new n.Vector3).copy(_).setLength(a);l.drawRayLocal(this,"Plane:Normal",e,L,o,new n.Color(1,1,1));var b=(new n.Vector3).copy(_).setLength(a);l.drawConeLocal(this,"Plane:Surface",e,b,o,u,new n.Color(1,0,1))}var S=(new n.Vector3).copy(o).applyQuaternion(y),w=v.angleTo(S);if(s>w)return i(r,"Error, plane normal ("+o.x+", "+o.y+", "+o.z+") too close to axis ("+_.x+", "+_.y+", "+_.z+")"),null;var D=Math.PI/2-v.angleTo(f),C=Math.tan(D),F=Math.tan(w),k=null;if(k=d?Math.PI/2*Math.max(-1,Math.min(1,C/F)):Math.asin(Math.max(-1,Math.min(1,C/F))),m&&(m._angleToAxis=h(f.angleTo(v)),m._distanceToTarget=f.length()),h(f.angleTo(v))<s)return i(r,"Error, Lookat Target local:("+f.x+", "+f.y+", "+f.z+"), world:("+c.x+", "+c.y+", "+c.z+") too close to rotated axis ("+v.x+", "+v.y+", "+v.z+")"),null;var P=(new n.Vector3).crossVectors(v,f).normalize(),E=(new n.Vector3).copy(S).projectOnPlane(v).normalize(),N=(new n.Quaternion).setFromUnitVectors(E,P),R=(new n.Vector4).setAxisAngleFromQuaternion(N),M=p(R,v),x=-(k- -Math.PI/2)+-Math.PI/2,A=M+k,I=M+x;return[A,I]},e.exports=u},{"../../ifr-core/SLog":52,three:void 0}],100:[function(t,e,o){"use strict";var n=t("../../ifr-core/SLog"),i=t("../base/AccelPlanner"),r=t("../base/Pose"),s="LOOKAT",a=function(t){var e=new r("POF Target",t),o=new r("POF Filtered",t),a=new i,l=.5,c=0,u=1e-5;this.updateByTime=function(t){var i,r,c,h,p,d,m=o.getDOFNames(),f=0;for(i=0;i<m.length;i++){r=m[i],c=o.get(r,0),h=o.get(r,1),p=e.get(r,0),d=a.computeWithFixedAccel(h,0,p-c,l);var g;d&&d.isConsistent()?g=d.getTotalTime():(n(s,"PoseOffsetFilter(tt) for "+r+" got invalid plan, using backup time of 10! (currentVel:"+h+", target:"+p+", currentPos:"+c+", acceLimit:"+l+")"),g=10),g>f&&(f=g)}for(i=0;i<m.length;i++)if(r=m[i],c=o.get(r,0),h=o.get(r,1),p=e.get(r,0),f>u)if(d=a.computeWithFixedTime(h,0,p-c,f),d&&d.isConsistent()){var y=d.displacementAtTime(t),_=d.velocityAtTime(t);o.set(r,[c+y,_])}else n(s,"PoseOffsetFilter(dp) for "+r+" got invalid plan, using backup filter! (currentVel:"+h+", target:"+p+", currentPos:"+c+", transitionTime:"+f+")"),o.set(r,[.99*c+.01*p,.96*h])},this.resetToTarget=function(){o.setPose(e)},this.resetToPose=function(t){o.setPose(t),e.setPose(t)},this.setTarget=function(t){e.setPose(t)},this.getTarget=function(t){t.setPose(e)},this.getValue=function(t){for(var e=o.getDOFNames(),n=0;n<e.length;n++){var i=e[n];t.set(i,o.get(i,0),0)}},this.getPreOffsetVelocities=function(t){for(var e=o.getDOFNames(),n=0;n<e.length;n++){var i=e[n];t.set(i,o.get(i,1),1)}},this.setRejectDeltaThreshold=function(t){c=t},this.getRejectDeltaThreshold=function(){return c},this.setAcceleration=function(t){l=t},this.applyUnfilteredOffset=function(t){for(var e=t.getDOFNames(),i=0;i<e.length;i++){var r=e[i],a=t.get(r,0);0!==c&&Math.abs(a)>c&&(n(s,"Clamping application of unfiltered offset of "+a+" to "+r+" as it is greater than "+c),a=0>a?-c:c);var l=o.get(r,0);null!==l&&(l+=a),o.set(r,l,0)}}};e.exports=a},{"../../ifr-core/SLog":52,"../base/AccelPlanner":62,"../base/Pose":73}],101:[function(t,e,o){"use strict";var n=t("three"),i=t("./PointADOF"),r=t("./LookatDOF"),s=function(t,e,o){r.call(this,t,e),this._control=null,this._forwardDir=o,this._transform=null,this._axis=null};s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.connectToGroup=function(t){r.prototype.connectToGroup.call(this,t),this._kinematicGroup?(this._control=this._kinematicGroup.getModelControlGroup().getControlForDOF(this._controlledDOFName),this._transform=this._kinematicGroup.getTransform(this._control.getTransformName()),this._axis=new n.Vector3,this._control.getRotationalAxis(this._axis)):(this._transform=null,this._control=null,this._axis=null)},s.prototype.valToPointAtTarget=function(t,e){return i.pointDOF(this._control,this._transform,this._forwardDir,t,e)},s.prototype.errorRatio=function(t){return this._control.isCyclic()?Math.abs(t/(2*Math.PI)):Math.abs(t/(this._control.getMax()-this._control.getMin()))},s.prototype.suggestForwardTarget=function(t){return null==this._transform?null:(t.copy(this._forwardDir),t.multiplyScalar(10),this._transform.localToWorld(t),t)},e.exports=s},{"./LookatDOF":92,"./PointADOF":99,three:void 0}],102:[function(t,e,o){"use strict";var n=t("three"),i=t("./PointADOF"),r=t("./LookatDOF"),s=t("../../ifr-geometry/ExtraMath"),a=function(t,e,o,n,i){r.call(this,t,e),this._control=null,this._planeNormal=o,this._distanceAlongDOFAxisToPlane=n,this._angleAbovePlane=i,this._transform=null};a.prototype=Object.create(r.prototype),a.prototype.constructor=a,a.prototype.connectToGroup=function(t){r.prototype.connectToGroup.call(this,t),t?(this._control=this._kinematicGroup.getModelControlGroup().getControlForDOF(this._controlledDOFName),this._transform=this._kinematicGroup.getTransform(this._control.getTransformName())):(this._transform=null,this._control=null)},a.prototype.valToPointAtTarget=function(t,e){var o=i.pointDOFToIntersectConeWithPoint(this._control,this._transform,this._planeNormal,this._distanceAlongDOFAxisToPlane,t,this._angleAbovePlane,!0,e);return o&&o.length>0?o[0]:void 0},a.prototype.errorRatio=function(t){return this._control.isCyclic()?Math.abs(t/(2*Math.PI)):Math.abs(t/(this._control.getMax()-this._control.getMin()))},a.prototype.suggestForwardTarget=function(t){if(null==this._transform)return null;var e=new n.Vector3;this._control.getRotationalAxis(e);var o=new n.Vector3;s.findOrthogonal(this._planeNormal,o);var i=new n.Vector3;i.crossVectors(o,this._planeNormal);var r=new n.Quaternion;return s.quatFromAxisAngle(i,this._angleAbovePlane,r),o.applyQuaternion(r),e.setLength(this._distanceAlongDOFAxisToPlane),o.setLength(10),t.copy(o),t.add(e),this._transform.localToWorld(o),t},e.exports=a},{"../../ifr-geometry/ExtraMath":57,"./LookatDOF":92,"./PointADOF":99,three:void 0}],103:[function(t,e,o){"use strict";var n=t("./TrackPolicyTrigger"),i={TRACK:"TRACK",TRACK_SACCADE:"TRACK_SACCADE",HOLD:"HOLD",DELAY:"DELAY"},r=function(t){this._currentMode=i.HOLD,this._checkers=t,this._lastTime=null};r.TrackMode=i,r.prototype.computeMode=function(t,e){var o,r=!1,s=0;if(null!==this._lastTime&&(s=e.subtract(this._lastTime)),this._lastTime=e,this._currentMode===i.HOLD){var a=!1;for(o=0;o<this._checkers.length;o++){var l=this._checkers[o],c=l.shouldStartTracking(t,s);c===n.StartStatus.YES&&(a=!0),c===n.StartStatus.LATER&&(r=!0)}a&&this._start(e)}else if(this._currentMode===i.TRACK){var u=!1;for(o=0;o<this._checkers.length;o++){var h=this._checkers[o],p=h.shouldStopTracking(t,s);p===!1&&(u=!0)}u||this._stop(e)}return this._currentMode===i.HOLD&&r?i.DELAY:this._currentMode},r.prototype.reset=function(){for(var t=0;t<this._checkers.length;t++)this._checkers[t].reset();this._lastTime=null},r.prototype._start=function(t){this._currentMode=i.TRACK,this.reset()},r.prototype._stop=function(t){this._currentMode=i.HOLD,this.reset()},e.exports=r},{"./TrackPolicyTrigger":104}],104:[function(t,e,o){"use strict";var n={YES:"YES",NO:"NO",LATER:"LATER"},i=function(){};i.StartStatus=n,i.prototype.shouldStartTracking=function(t,e){return null},i.prototype.shouldStopTracking=function(t,e){return null},i.prototype.reset=function(){},e.exports=i},{}],105:[function(t,e,o){"use strict";var n=t("./TrackPolicyTrigger"),i=function(){n.call(this)};i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.shouldStartTracking=function(t,e){return n.StartStatus.YES},i.prototype.shouldStopTracking=function(t,e){return!1},e.exports=i},{"./TrackPolicyTrigger":104}],106:[function(t,e,o){"use strict";var n=t("./TrackPolicyTrigger"),i=function(t,e,o,i,r){n.call(this),this._limitInner=t,this._limitOuter=e,this._accumValueInner=o,this._accumValueOuter=i,this._moveImmediatelyPastOuter=r,this._accumValueCurrent=0};i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.shouldStartTracking=function(t,e){var o=null,i=t.highestDistanceHoldToOptimal;if(i<this._limitInner)this._accumValueCurrent=0,o=n.StartStatus.NO;else if(i>=this._limitOuter&&this._moveImmediatelyPastOuter)this._accumValueCurrent=1,o=n.StartStatus.YES;else if(this._limitOuter>this._limitInner){i=Math.max(this._limitInner,Math.min(this._limitOuter,i));var r=(i-this._limitInner)/(this._limitOuter-this._limitInner),s=(1-r)*this._accumValueInner+r*this._accumValueOuter;this._accumValueCurrent+=s*e,o=this._accumValueCurrent>1?n.StartStatus.YES:n.StartStatus.LATER}return o},i.prototype.reset=function(){this._accumValueCurrent=0},e.exports=i},{"./TrackPolicyTrigger":104}],107:[function(t,e,o){"use strict";var n=t("./TrackPolicyTrigger"),i=function(t,e){n.call(this),this._deadZone=t,this._deadTime=e,this._deadTimeAccumulated=0};i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.shouldStopTracking=function(t,e){var o=t.highestDistanceOptimalToFiltered;return o<=this._deadZone?this._deadTimeAccumulated+=e:this._deadTimeAccumulated=0,this._deadTimeAccumulated>this._deadTime},i.prototype.reset=function(){this._deadTimeAccumulated=0},e.exports=i},{"./TrackPolicyTrigger":104}],108:[function(t,e,o){"use strict";var n=t("three"),i=t("./GLLinePool"),r=function(t){this._groundPlaneNormal=t,this._target=null,this._linePool=null,this._renderCallback=null,this._lineWidth=1,this._brightness=1,this._baseColor=new n.Color(1,0,1)};r.prototype.setPosition=function(t){null===this._target&&null!==t?this._target=new n.Vector3(t.x,t.y,t.z):null==t?this._target=null:this._target.copy(t)},r.prototype.installRendererIntoScene=function(t){if(null!=this._linePool||null!=this._renderCallback)throw new Error("Remove VTP renderer from existing scene before installing in another!");this._linePool=new i(t,10);var e=this;this._renderCallback=function(){if(null!=e._target){var t=e._target,o=e._brightness,i=e._baseColor;e._linePool.setLineWidth(e._lineWidth);var r=.05;e._linePool.drawOnce((new n.Vector3).copy(t).add(new n.Vector3(r,0,0)),(new n.Vector3).copy(t).sub(new n.Vector3(r,0,0)),new n.Color(1*o,0,0)),e._linePool.drawOnce((new n.Vector3).copy(t).add(new n.Vector3(0,r,0)),(new n.Vector3).copy(t).sub(new n.Vector3(0,r,0)),new n.Color(0,1*o,0)),e._linePool.drawOnce((new n.Vector3).copy(t).add(new n.Vector3(0,0,r)),(new n.Vector3).copy(t).sub(new n.Vector3(0,0,r)),new n.Color(.2*o,.2*o,1*o));var s=(new n.Vector3).copy(t).projectOnPlane(e._groundPlaneNormal);e._linePool.drawOnce((new n.Vector3).copy(s).add(new n.Vector3(r,r,0)),(new n.Vector3).copy(s).sub(new n.Vector3(r,r,0)),new n.Color(i.r*o,i.g*o,i.b*o)),e._linePool.drawOnce((new n.Vector3).copy(s).add(new n.Vector3(r,-r,0)),(new n.Vector3).copy(s).sub(new n.Vector3(r,-r,0)),new n.Color(i.r*o,i.g*o,i.b*o)),e._linePool.drawOnce(s,t,new n.Color(i.r*o,i.g*o,i.b*o))}},t.addRenderCallback(this._renderCallback)},r.prototype.removeRendererFromScene=function(t){null!=this._linePool&&this._linePool.removeFromScene(t),null!=this._renderCallback&&t.removeRenderCallback(this._renderCallback),this._linePool=null,this._renderCallback=null},r.prototype.setLineWidth=function(t){this._lineWidth=t},r.prototype.setBrightness=function(t){this._brightness=t},r.prototype.setBaseColor=function(t){this._baseColor.set(t)},e.exports=r},{"./GLLinePool":110,three:void 0}],109:[function(t,e,o){"use strict";var n=t("./TrackballControls"),i=t("three"),r=t("stats-js"),s=function(t,e,o,n){if(this._container=void 0!==t?t:null,this._container){var r=this._container.getBoundingClientRect();this._width=r.width,this._height=r.height}else this._width=100,this._height=100;this._workaroundElementReadyRace=!0,this._camera=new i.PerspectiveCamera(60,this._width/this._height,.1,1e3),this._camera.position.z=20,this._scene=new i.Scene,this._ambientLight=new i.AmbientLight(4210752),this._scene.add(this._ambientLight),this._directionalLight=new i.DirectionalLight(16777215,.5),this._directionalLight.position.set(-1,1,1),this._scene.add(this._directionalLight),this._renderer=new i.WebGLRenderer({antialias:!0}),this._renderer.setSize(this._width,this._height),n&&this._renderer.setClearColor(n),this._renderOnlyWhenDirty=!1,this._dirty=!0,this._renderEveryNFRames=1,this._frameSkipCounter=0;var s=this;this._container&&(this._container.appendChild(this._renderer.domElement),this._workaroundElementReadyRace&&setInterval(function(){s.markDirty()},200)),this._renderCallbacks=[],this._postRenderCallbacks=[],this._controls=null,e&&this.installTrackballControls(),this._stats=null,o&&this.installStats(),this._doPlay=function(){s.play()}};s.prototype.installTrackballControls=function(){null===this._controls&&(this._dirty=!0,this._controls=new n(this._camera,this._container),this._controls.rotateSpeed=1,this._controls.zoomSpeed=1.2,this._controls.panSpeed=1,this._controls.noZoom=!1,this._controls.noPan=!1,this._controls.staticMoving=!0,this._controls.dynamicDampingFactor=.3,this._controls.keys=[65,83,68])},s.prototype.removeTrackballControls=function(){null!==this._controls&&(this._dirty=!0,this._controls.dispose(),this._controls=null)},s.prototype.installStats=function(){this._dirty=!0,this._stats=new r,this._stats.domElement.style.position="absolute",this._stats.domElement.style.top="0px",this._stats.domElement.style.zIndex=100,this._container&&this._container.appendChild(this._stats.domElement)},s.prototype.setRenderOnlyWhenDirty=function(t){this._renderOnlyWhenDirty=t},s.prototype.setRenderEveryNFrames=function(t){this._renderEveryNFRames=t},s.prototype.markDirty=function(){this._dirty=!0},s.prototype.handleResize=function(){if(!this._container)return!1;var t=this._container.getBoundingClientRect();return t.width!==this._width||t.height!==this._height?(this._width=t.width,this._height=t.height,this._camera.aspect=this._width/this._height,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._width,this._height),null!==this._controls&&this._controls.handleResize(),!0):!1},s.prototype.detachFromContainer=function(){this.stop(),this._container&&(this._container.removeChild(this._renderer.domElement),this._controls&&this._controls.detachFromContainer(),this._stats&&this._container.removeChild(this._stats.domElement),this._container=null)},s.prototype.attachToContainer=function(t){if(this._dirty=!0,this._container&&this.detachFromContainer(),this._container=void 0!==t?t:null,this._container){var e=this._container.getBoundingClientRect();if(this._width=e.width,this._height=e.height,this._camera.aspect=this._width/this._height,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._width,this._height),this._renderer.domElement=document.adoptNode(this._renderer.domElement),this._container.appendChild(this._renderer.domElement),this._workaroundElementReadyRace){var o=this;setInterval(function(){o.markDirty()},200)}this._controls&&this._controls.attachToContainer(this._container),this._stats&&(this._stats.domElement=document.adoptNode(this._stats.domElement),this._container.appendChild(this._stats.domElement));
}},s.prototype.dispose=function(){this.detachFromContainer(),this._camera=null,this._scene=null,this._ambientLight=null,this._directionalLight=null,this._renderer=null,this._renderCallbacks=null,this._postRenderCallbacks=null,this._controls=null,this._stats=null},s.prototype.getContainer=function(){return this._container},s.prototype.getCamera=function(){return this._camera},s.prototype.getScene=function(){return this._scene},s.prototype.getAmbientLight=function(){return this._ambientLight},s.prototype.getDirectionalLight=function(){return this._directionalLight},s.prototype.getRenderer=function(){return this._renderer},s.prototype.getTrackballControls=function(){return this._controls},s.prototype.getStats=function(){return this._stats},s.prototype.addRenderCallback=function(t){this._dirty=!0,this._renderCallbacks.push(t)},s.prototype.removeRenderCallback=function(t){this._dirty=!0;var e=this._renderCallbacks.indexOf(t);e>-1&&this._renderCallbacks.splice(e,1)},s.prototype.addPostRenderCallback=function(t){this._dirty=!0,this._postRenderCallbacks.push(t)},s.prototype.removePostRenderCallback=function(t){this._dirty=!0;var e=this._postRenderCallbacks.indexOf(t);e>-1&&this._postRenderCallbacks.splice(e,1)},s.prototype.render=function(){var t=this.handleResize();if(this._frameSkipCounter++,this._frameSkipCounter>=this._renderEveryNFRames&&(!this._renderOnlyWhenDirty||t||this._dirty)){null!==this._controls&&this._controls.update();for(var e=0;e<this._renderCallbacks.length;e++)this._renderCallbacks[e]();for(this._renderer.render(this._scene,this._camera),e=0;e<this._postRenderCallbacks.length;e++)this._postRenderCallbacks[e]();null!==this._stats&&this._stats.update(),this._dirty=!1,this._frameSkipCounter=0}},s.prototype.play=function(){this._requestHandle=window.requestAnimationFrame(this._doPlay),this.render()},s.prototype.stop=function(){void 0!==this._requestHandle&&window.cancelAnimationFrame(this._requestHandle)},e.exports=s},{"./TrackballControls":115,"stats-js":void 0,three:void 0}],110:[function(t,e,o){"use strict";var n=t("three"),i=function(t,e,o){this.pos1=t,this.pos2=e,this.color=o};i.prototype.setPosition=function(t,e){this.pos1=t,this.pos2=e},i.prototype.setColor=function(t){this.color=t};var r=function(t,e){(void 0===e||null===e)&&(e=100),this.maxLines=e,this.numTempLines=0,this.unusedVec=new n.Vector3(1e6,1e6,1e6),this.unusedColor=new n.Color(1,1,1),this.lineMaterial=new n.LineBasicMaterial({vertexColors:n.VertexColors}),this.lineGeometry=new n.Geometry;for(var o=0;o<this.maxLines;o++)this.lineGeometry.vertices.push((new n.Vector3).copy(this.unusedVec)),this.lineGeometry.vertices.push((new n.Vector3).copy(this.unusedVec)),this.lineGeometry.colors.push((new n.Color).copy(this.unusedColor)),this.lineGeometry.colors.push((new n.Color).copy(this.unusedColor));this.line=new n.Line(this.lineGeometry,this.lineMaterial,n.LinePieces),this.line.frustumCulled=!1,this.lineMaterial.linewidth=1,this.postRenderCallbackInstalled=null,this.renderCallbackInstalled=null,this.addedToScene=null,this.leasedLines=[],void 0!==t&&this.addToScene(t)};r.prototype.addToScene=function(t){t.getScene().add(this.line),this.postRenderCallbackInstalled=this.postRenderCleanup.bind(this),this.renderCallbackInstalled=this.prepareForRender.bind(this),this.addedToScene=t,t.addPostRenderCallback(this.postRenderCallbackInstalled),t.addRenderCallback(this.renderCallbackInstalled)},r.prototype.removeFromScene=function(){null!=this.addedToScene&&(this.addedToScene.getScene().remove(this.line),this.addedToScene.removePostRenderCallback(this.postRenderCallbackInstalled),this.addedToScene.removeRenderCallback(this.renderCallbackInstalled),this.addedToScene=null,this.postRenderCallbackInstalled=null)},r.prototype.drawOnce=function(t,e,o){this.numTempLines<this.maxLines&&(this.lineGeometry.vertices[2*this.numTempLines].copy(t),this.lineGeometry.vertices[2*this.numTempLines+1].copy(e),this.lineGeometry.verticesNeedUpdate=!0,void 0!==o&&(this.lineGeometry.colors[2*this.numTempLines].copy(o),this.lineGeometry.colors[2*this.numTempLines+1].copy(o),this.lineGeometry.colorsNeedUpdate=!0),this.numTempLines++)},r.prototype.leaseLine=function(t,e,o){var n=new i(t,e,o);return this.leasedLines.push(n),n},r.prototype.returnLeased=function(t){var e=this.leasedLines.indexOf(t);e>=0?this.leasedLines.splice(e,1):console.log("Error, cannot return line that has not been leased!("+t+")")},r.prototype.returnAllLeased=function(){this.leasedLines.length=0},r.prototype.setLineWidth=function(t){return this.lineMaterial.linewidth=t,this},r.prototype.prepareForRender=function(){for(var t=0;t<this.leasedLines.length;t++){var e=this.leasedLines[t];this.drawOnce(e.pos1,e.pos2,e.color)}},r.prototype.postRenderCleanup=function(){if(this.numTempLines>0){for(var t=0;t<this.numTempLines;t++)this.lineGeometry.vertices[2*t].copy(this.unusedVec),this.lineGeometry.vertices[2*t+1].copy(this.unusedVec),this.lineGeometry.colors[2*t].copy(this.unusedColor),this.lineGeometry.colors[2*t+1].copy(this.unusedColor);this.lineGeometry.verticesNeedUpdate=!0,this.lineGeometry.colorsNeedUpdate=!0,this.numTempLines=0}},e.exports=r},{three:void 0}],111:[function(t,e,o){"use strict";var n=t("./TextOverlayPool"),i=t("./MouseCoordinateWrangler"),r=function(t){this.textOverlay=new n(t.getContainer()),this.container=t.getContainer(),this.camera=t.getCamera(),this.addedToScene=null,this.postRenderCallbackInstalled=null,this._addToScene(t)};r.prototype._addToScene=function(t){this.postRenderCallbackInstalled=this.postRenderCleanup.bind(this),this.addedToScene=t,t.addPostRenderCallback(this.postRenderCallbackInstalled)},r.prototype.removeFromScene=function(){null!=this.addedToScene&&(this.addedToScene.removePostRenderCallback(this.postRenderCallbackInstalled),this.addedToScene=null,this.postRenderCallbackInstalled=null),this.textOverlay.postRenderCleanup(),this.textOverlay.returnAllLeased()},r.prototype.drawOnce2D=function(t,e,o,n,i){this.textOverlay.drawOnce2D(t,e,o,n,i)},r.prototype.drawOnce3D=function(t,e,o,n,r,s){var a=i.projectToScreenPixels(e,o,n,this.camera,this.container,!0);null!==a&&this.textOverlay.drawOnce2D(t,a.x,a.y,r,s)},r.prototype.lease2D=function(t,e,o,n,i){return this.textOverlay.lease2D(t,e,o,n,i)},r.prototype.lease3D=function(t,e,o,n,r,s){var a=i.projectToScreenPixels(e,o,n,this.camera,this.container,!0);null!==a?this.textOverlay.lease2D(t,a.x,a.y,r,s):this.textOverlay.lease2D(t,-1e3,-1e3,r,s)},r.prototype.returnLeased=function(t){this.textOverlay.returnLeased(t)},r.prototype.returnAllLeased=function(){this.textOverlay.returnAllLeased()},r.prototype.postRenderCleanup=function(){this.textOverlay.postRenderCleanup()},e.exports=r},{"./MouseCoordinateWrangler":112,"./TextOverlayPool":114}],112:[function(t,e,o){"use strict";var n=t("three"),i=t("../ifr-core/SLog"),r="MOUSE_COORD_WRANGLER",s={};s.getOffsetRect=function(t){var e=t.getBoundingClientRect(),o=document.body,n=document.documentElement,i=window.pageYOffset||n.scrollTop||o.scrollTop,r=window.pageXOffset||n.scrollLeft||o.scrollLeft,s=n.clientTop||o.clientTop||0,a=n.clientLeft||o.clientLeft||0,l=e.top+i-s,c=e.left+r-a;return{top:Math.round(l),left:Math.round(c),width:Math.round(e.width),height:Math.round(e.height)}},s.projectToScreenNDC=function(t,e,o,i){var r=new n.Vector3(t,e,o).project(i);return{x:r.x,y:r.y}},s.projectToScreenPixels=function(t,e,o,i,r,s){var a=new n.Vector3(t,e,o).project(i);if(a.z<0||a.z>1)return null;if(s===!0&&(Math.abs(a.x)>1||Math.abs(a.y)>1))return null;var l=r.getBoundingClientRect(),c=l.width,u=l.height;return{x:a.x*c/2+c/2,y:-a.y*u/2+u/2}},s.getLocalCoordinates=function(t,e){var o=s.getOffsetRect(e);return{x:t.pageX-o.left,y:t.pageY-o.top}},s.getLocalCoordinatesNDC=function(t,e){var o=s.getOffsetRect(e);return{x:(t.pageX-o.left)/o.width,y:1-(t.pageY-o.top)/o.height}},s.getLocalCoordinatesNDCCentered=function(t,e){var o=s.getOffsetRect(e);return{x:(t.pageX-o.left)/o.width*2-1,y:2*(1-(t.pageY-o.top)/o.height)-1}},s.unprojectScreenToPlane=function(t,e,o,s,a){var l=new n.Vector3(t,e,0),c=new n.Vector3(t,e,1);l.unproject(o),c.unproject(o);var u=c.sub(l),h=l;u.normalize();var p=(new n.Vector3).copy(s).sub(h),d=u.dot(a);if(Math.abs(d)<1e-4)return void i(r,"un-project error, no intersection");var m=p.dot(a)/u.dot(a);return 0>m?void i(r,"error, intersection behind camera"):h.add(u.multiplyScalar(m))},s.unprojectEventToPlane=function(t,e,o,i,r){var a=s.getLocalCoordinatesNDCCentered(t,e);return void 0===i&&(i=new n.Vector3(0,0,0)),void 0===r&&(r=new n.Vector3(0,1,0)),s.unprojectScreenToPlane(a.x,a.y,o,i,r)},e.exports=s},{"../ifr-core/SLog":52,three:void 0}],113:[function(t,e,o){"use strict";var n=t("three"),i=t("./MouseCoordinateWrangler"),r=t("./ViewportTargetPositioner"),s=t("../ifr-core/SLog"),a="UI_TARGET",l=function(t,e,o,l,c,u){null==o&&(o=new n.Vector3(0,0,0)),null==l&&(l=new n.Vector3(0,0,0)),null==c&&(c=new n.Vector3(0,1,0)),null==u&&(u=["default"]);var h=[],p=new Map,d=null,m=!0,f=null,g=null,y=null,_=null,v=function(e){e.preventDefault(),e.stopPropagation();var o=i.getLocalCoordinatesNDCCentered(e,t);if(null!=d){var n=p.get(d);null!=n&&(g(e)?n.moveToNDCPoint(o.x,o.y,!0):y(e)&&n.moveToNDCPoint(o.x,o.y,!1))}},T=function(t){f(t)&&v(t)},O=!0,L=function S(e){O?(document.removeEventListener("mousemove",T,m),document.removeEventListener("mouseup",S,m)):(t.removeEventListener("mousemove",T,m),t.removeEventListener("mouseup",S,m),t.removeEventListener("mouseleave",S,m))};t.addEventListener("mousedown",function(e){f(e)&&(v(e),O?(document.addEventListener("mousemove",T,m),document.addEventListener("mouseup",L,m)):(t.addEventListener("mousemove",T,m),t.addEventListener("mouseup",L,m),t.addEventListener("mouseleave",L,m)))},m),this.setMouseFilters=function(t,e,o){f=null!=t?t:function(t){return!t.altKey&&!t.metaKey&&!t.ctrlKey},g=null!=e?e:function(t){return t.shiftKey},y=null!=o?o:function(t){return!t.shiftKey}},this.addPositionChangedCallback=function(t){var e=h.indexOf(t);0>e&&h.push(t)},this.removePositionChangedCallback=function(t){var e=h.indexOf(t);e>-1&&h.splice(e,1)},this.notifyPositionChangedCallbacks=function(t,e){for(var o=0;o<h.length;o++)h[o](t,e)},this.addTargetPositioner=function(t,n){if(p.has(t))s(a,"Not adding MouseTargetPositioner target "+t+", already have target with that name");else{null==n&&(n=o);var i=new r(t,e,n,l,c);i.addPositionChangedCallback(this.notifyPositionChangedCallbacks),null!==_&&i.installRendererIntoScene(_),p.set(t,i),null===d?(d=t,i.setHighlighted(!0)):i.setHighlighted(!1)}},this.removeTargetPositioner=function(t){if(p.has(t)){var e=p.get(t);null!==_&&e.removeRendererFromScene(_),e.removePositionChangedCallback(this.notifyPositionChangedCallbacks),p["delete"](t),d===t&&(d=null)}},this.getTargetPositionerNames=function(){for(var t,e=[],o=p.keys();!(t=o.next()).done;)e.push(t.value);return e},this.selectTarget=function(t){if(null!=d){var e=p.get(d);null!=e&&e.setHighlighted(!1)}if(null!=t){var o=p.get(t);null!=o&&o.setHighlighted(!0)}d=t},this.installRendererIntoScene=function(t){if(null!==_)throw new Error("Remove MTP renderer from existing scene before installing in another!");for(var e of p.values())e.installRendererIntoScene(t);_=t},this.removeRendererFromScene=function(t){for(var e of p.values())e.removeRendererFromScene(t);_=null},this.setMouseFilters();for(var b of u)this.addTargetPositioner(b)};e.exports=l},{"../ifr-core/SLog":52,"./MouseCoordinateWrangler":112,"./ViewportTargetPositioner":116,three:void 0}],114:[function(t,e,o){"use strict";var n=0,i=function(t,e,o){this.div=document.createElement("div"),this.div.id="text-display:"+n++,this.div.style.cssText="padding:0 0 0px 0px;text-align:left;position:absolute",null!=e&&this.setColor(e),null!=o&&this.setSize(o),null!=t&&this.setText(t)};i.prototype.setPosition2D=function(t,e){this.div.style.top=e+"px",this.div.style.left=t+"px"},i.prototype.setColor=function(t){this.div.style.color=t},i.prototype.setText=function(t){this.div.innerHTML=t},i.prototype.setSize=function(t){this.div.style.fontSize=t};var r=function(t){this.onElement=t,this.drawOnceElements=[],this.leasedElements=[]};r.prototype.drawOnce2D=function(t,e,o,n,r){var s=new i(t,n,r);s.setPosition2D(e,o),this.drawOnceElements.push(s),this.onElement.appendChild(s.div)},r.prototype.lease2D=function(t,e,o,n,r){var s=new i(t,n,r);return s.setPosition2D(e,o),this.leasedElements.push(s),this.onElement.appendChild(s.div),s},r.prototype.returnLeased=function(t){var e=this.leasedElements.indexOf(t);e>=0?(this.onElement.removeChild(t.div),this.leasedElements.splice(e,1)):console.log("Error, cannot return leased text element that is not been leased!("+(null==t?"null":t.div.innerHTML)+")")},r.prototype.returnAllLeased=function(){for(;this.leasedElements.length>0;){var t=this.leasedElements.pop();this.onElement.removeChild(t.div)}},r.prototype.postRenderCleanup=function(){for(;this.drawOnceElements.length>0;){var t=this.drawOnceElements.pop();this.onElement.removeChild(t.div)}},e.exports=r},{}],115:[function(t,e,o){"use strict";var n=t("three"),i=function(t,e){function o(t){d.enabled!==!1&&(window.removeEventListener("keydown",o),_=y,y===m.NONE&&(t.keyCode!==d.keys[m.ROTATE]||d.noRotate?t.keyCode!==d.keys[m.ZOOM]||d.noZoom?t.keyCode!==d.keys[m.PAN]||d.noPan||(y=m.PAN):y=m.ZOOM:y=m.ROTATE))}function i(t){d.enabled!==!1&&(y=_,window.addEventListener("keydown",o,!1))}function r(t){d.enabled!==!1&&(t.preventDefault(),t.stopPropagation(),y===m.NONE&&(y=t.button,0===t.button&&t.shiftKey&&(y=m.PAN)),y!==m.ROTATE||d.noRotate?y!==m.ZOOM||d.noZoom?y!==m.PAN||d.noPan||(D.copy(E(t.pageX,t.pageY)),C.copy(D)):(L.copy(E(t.pageX,t.pageY)),b.copy(L)):(T.copy(N(t.pageX,t.pageY)),O.copy(T)),document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",a,!1),d.dispatchEvent(k))}function s(t){d.enabled!==!1&&(t.preventDefault(),t.stopPropagation(),y!==m.ROTATE||d.noRotate?y!==m.ZOOM||d.noZoom?y!==m.PAN||d.noPan||C.copy(E(t.pageX,t.pageY)):b.copy(E(t.pageX,t.pageY)):O.copy(N(t.pageX,t.pageY)))}function a(t){d.enabled!==!1&&(t.preventDefault(),t.stopPropagation(),y=m.NONE,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a),d.dispatchEvent(P))}function l(t){if(d.enabled!==!1){t.preventDefault(),t.stopPropagation();var e=0;t.wheelDelta?e=t.wheelDelta/40:t.detail&&(e=-t.detail/3),L.y+=.01*e,d.dispatchEvent(k),d.dispatchEvent(P)}}function c(t){if(d.enabled!==!1){switch(t.touches.length){case 1:y=m.TOUCH_ROTATE,T.copy(N(t.touches[0].pageX,t.touches[0].pageY)),O.copy(T);break;case 2:y=m.TOUCH_ZOOM_PAN;var e=t.touches[0].pageX-t.touches[1].pageX,o=t.touches[0].pageY-t.touches[1].pageY;w=S=Math.sqrt(e*e+o*o);var n=(t.touches[0].pageX+t.touches[1].pageX)/2,i=(t.touches[0].pageY+t.touches[1].pageY)/2;D.copy(E(n,i)),C.copy(D);break;default:y=m.NONE}d.dispatchEvent(k)}}function u(t){if(d.enabled!==!1)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:O.copy(N(t.touches[0].pageX,t.touches[0].pageY));break;case 2:var e=t.touches[0].pageX-t.touches[1].pageX,o=t.touches[0].pageY-t.touches[1].pageY;w=Math.sqrt(e*e+o*o);var n=(t.touches[0].pageX+t.touches[1].pageX)/2,i=(t.touches[0].pageY+t.touches[1].pageY)/2;C.copy(E(n,i));break;default:y=m.NONE}}function h(t){if(d.enabled!==!1){switch(t.touches.length){case 1:O.copy(N(t.touches[0].pageX,t.touches[0].pageY)),T.copy(O);break;case 2:S=w=0;var e=(t.touches[0].pageX+t.touches[1].pageX)/2,o=(t.touches[0].pageY+t.touches[1].pageY)/2;C.copy(E(e,o)),D.copy(C)}y=m.NONE,d.dispatchEvent(P)}}function p(t){t.preventDefault()}var d=this,m={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=t,this.domElement=null,this.enabled=!1,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new n.Vector3;var f=1e-6,g=new n.Vector3,y=m.NONE,_=m.NONE,v=new n.Vector3,T=new n.Vector3,O=new n.Vector3,L=new n.Vector2,b=new n.Vector2,S=0,w=0,D=new n.Vector2,C=new n.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var F={type:"change"},k={type:"start"},P={type:"end"};this.handleResize=function(){if(d.enabled!==!1)if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}},this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)};var E=function(){var t=new n.Vector2;return function(e,o){return t.set((e-d.screen.left)/d.screen.width,(o-d.screen.top)/d.screen.height),t}}(),N=function(){var t=new n.Vector3,e=new n.Vector3,o=new n.Vector3;return function(n,i){o.set((n-.5*d.screen.width-d.screen.left)/(.5*d.screen.width),(.5*d.screen.height+d.screen.top-i)/(.5*d.screen.height),0);var r=o.length();return d.noRoll?r<Math.SQRT1_2?o.z=Math.sqrt(1-r*r):o.z=.5/r:r>1?o.normalize():o.z=Math.sqrt(1-r*r),v.copy(d.object.position).sub(d.target),t.copy(d.object.up).setLength(o.y),t.add(e.copy(d.object.up).cross(v).setLength(o.x)),t.add(v.setLength(o.z)),t}}();this.rotateCamera=function(){var t=new n.Vector3,e=new n.Quaternion;return function(){var o=Math.acos(T.dot(O)/T.length()/O.length());o&&(t.crossVectors(T,O).normalize(),o*=d.rotateSpeed,e.setFromAxisAngle(t,-o),v.applyQuaternion(e),d.object.up.applyQuaternion(e),O.applyQuaternion(e),d.staticMoving?T.copy(O):(e.setFromAxisAngle(t,o*(d.dynamicDampingFactor-1)),T.applyQuaternion(e)))}}(),this.zoomCamera=function(){var t;y===m.TOUCH_ZOOM_PAN?(t=S/w,S=w,v.multiplyScalar(t)):(t=1+(b.y-L.y)*d.zoomSpeed,1!==t&&t>0&&(v.multiplyScalar(t),d.staticMoving?L.copy(b):L.y+=(b.y-L.y)*this.dynamicDampingFactor))},this.panCamera=function(){var t=new n.Vector2,e=new n.Vector3,o=new n.Vector3;return function(){t.copy(C).sub(D),t.lengthSq()&&(t.multiplyScalar(v.length()*d.panSpeed),o.copy(v).cross(d.object.up).setLength(t.x),o.add(e.copy(d.object.up).setLength(t.y)),d.object.position.add(o),d.target.add(o),d.staticMoving?D.copy(C):D.add(t.subVectors(C,D).multiplyScalar(d.dynamicDampingFactor)))}}(),this.checkDistances=function(){d.noZoom&&d.noPan||(v.lengthSq()>d.maxDistance*d.maxDistance&&d.object.position.addVectors(d.target,v.setLength(d.maxDistance)),v.lengthSq()<d.minDistance*d.minDistance&&d.object.position.addVectors(d.target,v.setLength(d.minDistance)))},this.update=function(){v.subVectors(d.object.position,d.target),d.noRotate||d.rotateCamera(),d.noZoom||d.zoomCamera(),d.noPan||d.panCamera(),d.object.position.addVectors(d.target,v),d.checkDistances(),d.object.lookAt(d.target),g.distanceToSquared(d.object.position)>f&&(d.dispatchEvent(F),g.copy(d.object.position))},this.reset=function(){y=m.NONE,_=m.NONE,d.target.copy(d.target0),d.object.position.copy(d.position0),d.object.up.copy(d.up0),v.subVectors(d.object.position,d.target),d.object.lookAt(d.target),d.dispatchEvent(F),g.copy(d.object.position)},this.detachFromContainer=function(){d.domElement&&(d.domElement.removeEventListener("contextmenu",p,!1),d.domElement.removeEventListener("mousedown",r,!1),d.domElement.removeEventListener("mousewheel",l,!1),d.domElement.removeEventListener("DOMMouseScroll",l,!1),d.domElement.removeEventListener("touchstart",c,!1),d.domElement.removeEventListener("touchend",h,!1),d.domElement.removeEventListener("touchmove",u,!1)),window.removeEventListener("keydown",o,!1),window.removeEventListener("keyup",i,!1),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a),y=m.NONE,d.enabled=!1,d.domElement=null},this.dispose=function(){d.detachFromContainer()},this.destroy=function(){d.dispose()},this.attachToContainer=function(t){d.domElement&&d.detachFromContainer(),d.domElement=void 0!==t?t:document,d.domElement&&(d.domElement.addEventListener("contextmenu",p,!1),d.domElement.addEventListener("mousedown",r,!1),d.domElement.addEventListener("mousewheel",l,!1),d.domElement.addEventListener("DOMMouseScroll",l,!1),d.domElement.addEventListener("touchstart",c,!1),d.domElement.addEventListener("touchend",h,!1),d.domElement.addEventListener("touchmove",u,!1),window.addEventListener("keydown",o,!1),window.addEventListener("keyup",i,!1),d.enabled=!0,d.handleResize(),d.update())},this.attachToContainer(e)};i.prototype=Object.create(n.EventDispatcher.prototype),e.exports=i},{three:void 0}],116:[function(t,e,o){"use strict";var n=t("three"),i=t("./MouseCoordinateWrangler"),r=t("./AnchoredTargetVisualizer"),s=t("../ifr-core/SLog"),a="UI_TARGET",l=function(t,e,o,i,s){this._name=t,this._camera=e,this._initialPosition=o,null==this._initialPosition&&(this._initialPosition=new n.Vector3(0,0,0)),this._pointOnGroundPlane=i,null==this._pointOnGroundPlane&&(this._pointOnGroundPlane=new n.Vector3(0,0,0)),this._groundPlaneNormal=s,null==this._groundPlaneNormal&&(this._groundPlaneNormal=new n.Vector3(0,1,0)),this._lastPosition=(new n.Vector3).copy(this._initialPosition),this._positionChangedListeners=[],this._anchoredTargetVis=new r(this._groundPlaneNormal),null!=this._lastPosition&&this._anchoredTargetVis.setPosition(this._lastPosition)};l.prototype.moveToNDCPoint=function(t,e,o){var r;if(o){var l=i.unprojectScreenToPlane(t,e,this._camera,this._pointOnGroundPlane,this._groundPlaneNormal);null!=l?r=(new n.Vector3).copy(this._lastPosition).projectOnVector(this._groundPlaneNormal).add(l):s(a,"ViewportTargetPositioner: ground point not computed, not moving target point")}else{var c=new n.Vector3(0,0,-1),u=c.applyMatrix4(this._camera.matrixWorld),h=u.sub(this._camera.position);h.projectOnPlane(this._groundPlaneNormal);var p=this._lastPosition;h.lengthSq()<.001?(s(a,"ViewportTargetPositioner: degenerate angle, not moving target point"),r=void 0):(h.normalize(),r=i.unprojectScreenToPlane(t,e,this._camera,p,h))}void 0!==r&&(this._lastPosition.copy(r),this._notifyPositionChangedCallbacks(r)),this._anchoredTargetVis.setPosition(this._lastPosition)},l.prototype.installRendererIntoScene=function(t){this._anchoredTargetVis.installRendererIntoScene(t)},l.prototype.removeRendererFromScene=function(t){this._anchoredTargetVis.removeRendererFromScene(t)},l.prototype.getPosition=function(t){return null==t&&(t=new n.Vector3),t.copy(this._lastPosition),t},l.prototype.addPositionChangedCallback=function(t){var e=this._positionChangedListeners.indexOf(t);0>e&&this._positionChangedListeners.push(t)},l.prototype.removePositionChangedCallback=function(t){var e=this._positionChangedListeners.indexOf(t);e>-1&&this._positionChangedListeners.splice(e,1)},l.prototype._notifyPositionChangedCallbacks=function(t){for(var e=0;e<this._positionChangedListeners.length;e++)this._positionChangedListeners[e](t,this._name)},l.prototype.setHighlighted=function(t){t?(this._anchoredTargetVis.setLineWidth(2),this._anchoredTargetVis.setBrightness(1)):(this._anchoredTargetVis.setLineWidth(.5),this._anchoredTargetVis.setBrightness(.5))},l.prototype.getName=function(){return this._name},e.exports=l},{"../ifr-core/SLog":52,"./AnchoredTargetVisualizer":108,"./MouseCoordinateWrangler":112,three:void 0}],117:[function(t,e,o){"use strict";global._animationutilities_singleton?e.exports=global._animationutilities_singleton:(e.exports.JiboConfig=t("./geometry-info/JiboConfig"),e.exports.RobotInfo=t("./geometry-info/RobotInfo"),e.exports.EyeKinematicsHelper=t("./geometry-info/EyeKinematicsHelper"),e.exports.animate=t("./animation-animate/AnimateImpl"),e.exports.visualize=t("./animation-visualize/VisualizeImpl"),e.exports.TimelineBuilder=t("./animation-macros/TimelineBuilder"),e.exports.Time=t("./ifr-core/Time"),e.exports.Clock=t("./ifr-core/Clock"),e.exports.slog=t("./ifr-core/SLog"),e.exports.MotionInterface=t("./animation-body/MotionInterface"),e.exports.body={BodyVelocityOutput:t("./animation-body/BodyVelocityOutput"),BodyTrajectoryOutput:t("./animation-body/BodyTrajectoryOutput"),BodyPositionOutput:t("./animation-body/BodyPositionOutput"),BodyPosVelOutput:t("./animation-body/BodyPosVelOutput"),BodyPosVelComboOutput:t("./animation-body/BodyPosVelComboOutput"),MotionServiceOutput:t("./animation-body/MotionServiceOutput"),MotionLog:t("./animation-body/MotionLog")},e.exports.ui={Bakery:t("./ifr-core/Bakery"),JSONBaker:t("./ifr-core/JSONBaker")},e.exports.protos={SampleCombiner:t("./animation-animate/timeline/SampleCombiner"),RenderPlugin:t("./animation-visualize/RenderPlugin")},e.exports.graphics={AnchoredTargetVisualizer:t("./ifr-visualizer/AnchoredTargetVisualizer"),GLTextOverlayPool:t("./ifr-visualizer/GLTextOverlayPool"),GLLinePool:t("./ifr-visualizer/GLLinePool")},e.exports.LEDOutput=t("./animation-body/LEDOutput"),e.exports.AuxOutput=t("./animation-animate/timeline/AuxOutput"),e.exports.MouseCoordinateWrangler=t("./ifr-visualizer/MouseCoordinateWrangler"),e.exports.MouseTargetPositioner=t("./ifr-visualizer/MouseTargetPositioner"),e.exports.TrajectoryControllerSim=t("./ifr-motion/feedback/TrajectoryControllerSim"),e.exports.PosVelControllerSim=t("./ifr-motion/feedback/PosVelControllerSim"),e.exports.THREE=t("three"),e.exports.slog.setPrintChannels(["ERROR","ACCEL_PLANNER","CALIBRATION","MODEL_LOADING","RENDER_PLUGIN"]),global._animationutilities_singleton=e.exports)},{"./animation-animate/AnimateImpl":2,"./animation-animate/timeline/AuxOutput":7,"./animation-animate/timeline/SampleCombiner":17,"./animation-body/BodyPosVelComboOutput":24,"./animation-body/BodyPosVelOutput":25,"./animation-body/BodyPositionOutput":26,"./animation-body/BodyTrajectoryOutput":27,"./animation-body/BodyVelocityOutput":28,"./animation-body/LEDOutput":30,"./animation-body/MotionInterface":31,"./animation-body/MotionLog":32,"./animation-body/MotionServiceOutput":33,"./animation-macros/TimelineBuilder":34,"./animation-visualize/RenderPlugin":38,"./animation-visualize/VisualizeImpl":40,"./geometry-info/EyeKinematicsHelper":42,"./geometry-info/JiboConfig":44,"./geometry-info/RobotInfo":46,"./ifr-core/Bakery":48,"./ifr-core/Clock":49,"./ifr-core/JSONBaker":51,"./ifr-core/SLog":52,"./ifr-core/Time":53,"./ifr-motion/feedback/PosVelControllerSim":87,"./ifr-motion/feedback/TrajectoryControllerSim":88,"./ifr-visualizer/AnchoredTargetVisualizer":108,"./ifr-visualizer/GLLinePool":110,"./ifr-visualizer/GLTextOverlayPool":111,"./ifr-visualizer/MouseCoordinateWrangler":112,"./ifr-visualizer/MouseTargetPositioner":113,three:void 0}]},{},[117])(117)});
var assert = require("assert"),
    search = require("../../lib/keyframe-search.js");

/**
 * Generate a keyframe like array (given an array of times) and then search for a time
 * and check if it the expected start and end indexes were returned
 */
function testSearch(keyframeTimes, keyframeTime ,expectedStart){
    var keyframes = [];

    keyframeTimes.forEach( function(time){
        keyframes.push({
            time: time
        });
    });

    var results = search.keyframeSearch(keyframes, keyframeTime);

    assert.equal(expectedStart, results.start, "Incorrect start index. Expected " + expectedStart + ", was: " + results.start);
    assert.equal(expectedStart+1, results.end, "Incorrect end index. Expected " + (expectedStart+1) + ", was: " + results.end);
}

describe('keyframesSearch', function(){
    it('should find the right start/end keyframe based on a given time', function(){

        testSearch([0, 3, 5, 7], 0, 0);
        testSearch([0, 3, 5, 7], 2, 0);
        testSearch([0, 3, 5, 7], 4, 1);
        testSearch([0, 3, 5, 7], 6, 2);

        // Test a large array
        var times = [],
            keyframeTime = 150,
            start;
        for(var i = 0; i<100; i++){
            times.push(i*2);
        }

        for(var i = 0; i<times.length;i++){
            if( times[i] <= keyframeTime && times[i+1] > keyframeTime ){
                start = i;
                break;
            }
        }
        testSearch(times, 150, start);
    });
});
